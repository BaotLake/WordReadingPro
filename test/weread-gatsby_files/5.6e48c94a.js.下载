(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{294:function(e,t,n){"use strict";n.r(t);var r=n(816),o=n(567);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(772);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},517:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(62)),o=i(n(192));function i(e){return e&&e.__esModule?e:{default:e}}var a=n(22),s=n(9);t.default={isMemberShipValid:function(e){return 0!==(0,r.default)(e).length&&(0===a.get(e,"expired",1)&&0<a.get(e,"expiredTime",0)&&(new Date).getTime()<1e3*a.get(e,"expiredTime",0))},canReceiveMemberCard:function(e){return s.inDevelopment()&&console.log(e),!1},canBookFreeReading:function(e){var t=e.bookInfo,n=e.memberCardSummary;return this.isMemberShipValid(n)&&(o.default.isSupportMemberShip(t)||-1<a.get(n,"freeBookIds",[]).indexOf(t.bookId))},discountToChinese:function(e){var t=["零","一","二","三","四","五","六","七","八","九"],n=100-e;return n<=0?"":n<10?t[0]+t[n]+"折":n<100?n%10==0?t[n/10]+"折":t[n/10]+t[n%10]+"折":""}}},525:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(192)),i=r(n(517));function r(e){return e&&e.__esModule?e:{default:e}}t.default={isChapterNeedPay:function(e){var t=e.bookInfo,n=e.memberCardSummary,r=e.chapter;return(!n||!i.default.canBookFreeReading({bookInfo:t,memberCardSummary:n}))&&(!o.default.isFree(t)&&(!o.default.isLimitFree(t)&&(0===t.paid&&(!(t.maxFreeChapter>=r.chapterIdx)&&(!o.default.isBuyUnitChapter(t)||0<r.price&&0===r.paid)))))},formatChapterUids:function(e){if(0===e.length)return"";var t=[],n=-1,r=-1,o=-1;return e.forEach(function(e){-1===n?n=e:o+1===e?r=e:(t.push(-1===r?n.toString():n+"-"+r),r=-1,n=e),o=e}),-1!==n&&t.push(-1===r?n.toString():n+"-"+r),t.join(",")},getChapterTitle:function(e,t){var n=e.title;return t?n:["第"+e.chapterIdx+"章",n].filter(function(e){return 0<e.length}).join(" ")}}},567:function(e,t,n){"use strict";n.r(t);var r=n(568),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},568:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=ae(n(132)),k=ae(n(279)),S=ae(n(291)),o=ae(n(133)),c=ae(n(65)),u=ae(n(62)),d=ae(n(709)),h=ae(n(519)),f=ae(n(676)),i=ae(n(136)),v=ie(n(35)),m=ie(n(61)),a=n(36),l=ae(n(192)),s=ae(n(517)),_=ae(n(43)),p=ae(n(525)),g=ae(n(720)),C=ae(n(721)),b=ae(n(724)),E=ae(n(726)),R=ae(n(732)),T=ae(n(734)),w=ae(n(736)),y=ae(n(283)),I=n(64),A=ae(I),D=ae(n(135)),N=ae(n(738)),L=ae(n(740)),O=ae(n(742)),B=ae(n(280)),P=ae(n(744)),x=ae(n(747)),M=ae(n(683)),H=ae(n(756)),U=ae(n(759)),$=ae(n(762)),F=ae(n(45)),W=ae(n(46)),j=ae(n(47)),G=ae(n(48)),q=ae(n(764)),z=ae(n(63)),K=ae(n(193)),V=ae(n(199)),Y=n(685),Q=ie(n(766)),X=ae(n(767)),J=ae(n(769)),Z=n(571),ee=ae(n(677)),te=ae(n(686)),ne=ie(n(569)),re=ie(n(570)),oe=ae(n(139));function ie(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function ae(e){return e&&e.__esModule?e:{default:e}}var se=n(9),ce=n(22),le=n(138),ue=n(682),de="reader",he="book",fe="bookReview",pe=0,ge=[],ve=[],me=[],_e=!1,Ce=null,be=[],Ee=0,Re=null,Te=!1,ke=[],Se=[],we=!1;t.default={name:de,components:{ReaderNotePanel:J.default,ReaderLoginGuide:O.default,ReaderBottomSettingPanel:w.default,ReaderBottomBar:T.default,ReaderMemberCardTips:$.default,PayChapterDialog:L.default,ReaderTopReviews:X.default,PayWholeBookDialog:N.default,Loading:D.default,BackgroundMask:y.default,ReaderTopBar:R.default,ReaderCatalog:E.default,ReaderBookInfo:b.default,ReaderControls:C.default,CustomStyle:g.default},asyncData:function(e){var t=e.store,n=e.user,r=e.envConfig;t.registerModule(de,(0,d.default)()),t.registerModule(he,(0,h.default)()),t.registerModule(fe,(0,f.default)());var o=t.state.route.params.infoId,i=le.parseReaderInfoId(o),a=i.bookId;t.commit(m.UPDATE_INIT_BOOK_ID,a);var s=i.chapterUid,c=s?parseInt(s):0,l=se.hasLogin(n);return t.dispatch(v.FETCH_READER_INIT_DATA,{initChapterUid:c,envConfig:r,isLogin:l}).then(function(){var e=t.state[de].bookInfo;0<(0,u.default)(e).length&&(t.commit(m.UPDATE_PAGE_TITLE,e.title+"-"+e.author+"-微信读书"),2===e.ispub?t.commit(m.UPDATE_PAGE_KEYWORDS,[e.title,e.author,e.category,e.title+"免费小说",e.title+"更新","免费小说","小说下载"].join(",")):t.commit(m.UPDATE_PAGE_KEYWORDS,[e.title,e.author,e.category,"免费小说",e.publisher].join(",")),t.commit(m.UPDATE_PAGE_DESCRIPTION,e.intro)),t.commit(m.UPDATE_READER_PAGE_SERVER_TIMESTAMP,parseInt((new Date).getTime()/1e3))})},created:function(){if(se.isEnvClient){var r=this;this.$store.registerModule(de,(0,d.default)(),{preserveState:!0}),this.$store.registerModule(he,(0,h.default)(),{preserveState:!0}),this.$store.registerModule(fe,(0,f.default)(),{preserveState:!0}),this.$store.commit(m.UPDATE_READER_PAGE_CLIENT_TIMESTAMP,parseInt((new Date).getTime()/1e3)),this.restoreFontSizeLevel(),(0,B.default)(),(0,P.default)(),(0,x.default)(),(0,M.default)(),(0,H.default)(),(0,U.default)(),["contextmenu","dragstart","selectstart","select","copy","beforecopy"].forEach(function(e){document.addEventListener(e,function(e){var t=(e=e||window.event).target.nodeName.toLowerCase();return!(!we&&"textarea"!==t&&"input"!==t)||(e.preventDefault?e.preventDefault():e.returnValue=!1,!1)},!1)});var o=ce.throttle(this.handleClickPrevChapterIndex,500),i=ce.throttle(this.handleClickNextChapterIndex,500),a=67,s=85,c=37,l=39;document.addEventListener("keydown",function(e){var t=(e=e||window.event).target.nodeName.toLowerCase();if("textarea"!==t&&"input"!==t){var n=e.ctrlKey||e.metaKey;switch(e.keyCode){case a:n&&r.canCopy(ke)&&(r.copyObjsText(ke),r.clearSelection());break;case s:n&&r.hasLogin&&r.hasSelection()&&(r.underlineObjs(ke),r.clearSelection());break;case c:o();break;case l:i()}}})}},mounted:function(){var p=this;if(se.isEnvClient){var e=this.$router.currentRoute.query;if(e&&e.packetId&&this.$store.dispatch(v.FETCH_ENCOURAGE_MONEY,{packetId:e.packetId}),e&&e.inviteCode&&this.hasLogin&&this.$store.dispatch(v.FETCH_INVITE_CODE,{inviteCode:e.inviteCode}),this.logOnClientMounted(),!l.default.isSupportedBookType(this.bookInfo.type))return;var g=this;_.default.handleElementScrollEvent(window,null,function(e){var t=e.clientHeight,n=e.scrollTop,r=e.scrollHeight;if(g.$footerNote.hide(),g.tryToHideMenu(),g.$refs.readerCatalog&&g.$refs.readerCatalog.isShowing()||g.tryUpdateBottomBarClassList({clientHeight:t,scrollTop:n,scrollHeight:r}),g.isShowBottomSettingPanel&&(g.isShowBottomSettingPanel=!1),0<me.length){for(var o=null,i=0,a=me.length;i<a;i++){var s=me[i];if(!(s.offsetTop<n))break;o=s}g.currentChapterAnchor=o?o.anchor:""}});var t=document.documentElement;t&&(t.addEventListener("mousedown",this.onContentMouseDown),t.addEventListener("mousemove",this.onContentMouseMove),t.addEventListener("mouseup",this.onContentMouseUp),t.addEventListener("click",function(e){var t=(e=e||window.event).target,n=t.nodeName.toLowerCase(),r=e.target.classList,o=!0;"a"!==n&&"1"!==t.getAttribute("data-ignore-toolbar-update-hidden")&&!r.contains("reader_footer_note")||(o=!1),o&&(p.tryToHideMenu(),p.tryUpdateBottomBarClassList(),g.isShowBottomSettingPanel&&(g.isShowBottomSettingPanel=!1));var i=g.$refs.readerControls;if(i&&i.isFontSizePanelShowing()){for(var a=document.querySelector(".readerControls_fontSize"),s=!0,c=t;a&&c&&c!==document.body;){if(a&&a===c){s=!1;break}c=c.parentNode}s&&i.hideFontSizePanel()}if(g.$isReviewDetailPanelShowing()){for(var l=document.getElementById("readerReviewDetailPanel"),u=!0,d=t;l&&d&&d!==document.body;){if(l&&l===d){u=!1;break}d=d.parentNode}u&&g.hideReviewDetailPanel()}var h=(new Date).getTime()-Ee<500;if(h){var f=p.clientXY2RenderAreaXY({x:e.clientX,y:e.clientY});h=Math.pow(Math.pow(Math.abs(f.x-Re.x),2)+Math.pow(Math.abs(f.y-Re.y),2),.5)<10}h&&p.clearSelection()}));var n=ce.throttle(g.resizeToReCollect,1e3);window.onresize=ce.debounce(function(){var e=g.$refs.renderTargetContainerSibling;if(e){var t=e.offsetWidth;pe!==t&&n(t)}},200),this.loadTopReviews(),this.isNeedShowMyNote&&this.syncMyNote({bookmark:"sync",review:"sync"});var i=e&&"1"===e.autoscroll&&this.isCurrentChapterTheFirst;this.$store.dispatch(v.FETCH_READER_CHAPTER_CONTENT).then(this.layout).then(function(e){if(e&&e.success){var t=p.currentChapter,n=p.progress,r=ce.get(n,"book.chapterUid",0);if(t&&t.chapterUid===r&&!p.isFromWeReadApp){var o=ce.get(n,"book.chapterOffset",0);p.scrollTo({chapterOffset:o,ignoreWhenScrollToTop:!i})}else i&&p.handleClickStartReading();p.hasLogin&&p.$store.dispatch(v.UPDATE_READER_LOCAL_LAST_CHAPTER),p.setupProgressReportOnDomReady(),p.requestMemberCardPriceIfNeeded(),p.checkIfShowMemberCardFreeReadingTips(),p.handleLoginPendingActions(),p.checkIfNeedRequestLoginQRCode()}}).catch(function(e){e&&e.isCustomError?e.reason:console.error("Error in FETCH_READER_CHAPTER_CONTENT",e)}),this.autoSearchOnClientMounted()}},beforeDestroy:function(){Ce&&clearTimeout(Ce)},destroyed:function(){this.$store.unregisterModule(de),this.$store.unregisterModule(he),this.$store.unregisterModule(fe)},data:function(){return{fontSizeLevel:2,fontSizeLevelCount:5,isShowPayWholeDialog:!1,isShowPayChapterDialog:!1,isShowBottomSettingPanel:!1,isPhoneBottomBarActive:!1,chapterContentHighLightBgHtml:"",chapterContentSelectionHtml:"",currentChapterAnchor:"",renderContentsVersion:-1,hasFetchMemberCardPrice:!1,buyMemberCardButtonLine1:"无限卡 19元/月 · 全场书籍免费读",buyMemberCardButtonLine2:"",loginGuideQRCodeImg:"",isLoginGetUidError:!1,isLoginGetInfoError:!1,isLoginQRCodeLoading:!1,autoLoadLoginQRCodeCount:1,isBalanceNeedAuth:!1}},methods:{tryToHideMenu:function(){var e=this.$refs.reader_top_bar;e&&e.isMenuShowing&&e.handleHideMenu()},tryUpdateBottomBarClassList:function(e){if(se.isEnvClient){if(this.isFromWeReadApp)return;if(document.querySelector(".readerBottomBar")){if(e){var t=e.clientHeight||0,n=e.scrollTop||0,r=e.scrollHeight||0;return void(this.isPhoneBottomBarActive=r-50<=t+n)}this.isPhoneBottomBarActive=!this.isPhoneBottomBarActive}}},handleTopWriteReviewClickEvent:function(e){var a=this,t=e.score;this.hasLogin?(this.reportClientBusiness({itemName:"Web_Reader_WriteBookReview"}),this.$showWriteReviewDialog({vid:this.user.vid||0,bookId:this.bookId,score:t},function(){a.$toast("发表中...",-1)},function(e){var t=e.bookId,n=e.content,r=e.star,o=e.isPrivate,i=e.friendship;a.$writeReviewDialog.getIsSending()||(a.$writeReviewDialog.setIsSending(!0),a.$writeReviewDialog.setIsSendedSucc(!0),a.$store.dispatch(v.FETCH_BOOK_REVIEW_ADD,{bookId:t,content:n,star:r,isPrivate:o,friendship:i}).then(function(e){console.log("[zhoonlog] res = "+(0,c.default)(e.data));var t=ce.get(e,"data.reviewId","");t&&0<t.length?(a.$hideToast(),a.$toast("发表成功"),a.$writeReviewDialog.closeDialog(),a.syncMyNote({bookmark:"",review:"append"})):(a.$hideToast(),a.$toast("发表失败，请重试")),a.$writeReviewDialog.setIsSending(!1),a.reportClientBusiness({itemName:"Web_WriteBookReview_Succ"})}).catch(function(e){a.$hideToast(),a.$toast("发表失败，请重试"),a.$writeReviewDialog.setIsSending(!1),console.log("[zhoonlog] err = "+e)}))})):this.$showLoginDialog({bottomTitle:"扫码登录微信读书",bottomSubTitle:"登录后可以点评此书"})},onClickLogout:function(){return this.$store.dispatch(v.FETCH_LOGOUT).then(function(e){e&&1===e.success&&window.location.reload()})},handleClickTopBarItem:function(e){switch(e){case"login":return this.$showLoginDialog();case"logout":return this.onClickLogout();case"gotoShelf":return this.onClickShelf();case"addShelf":return this.reportClientBusiness({itemName:"Web_Reader_TopAddClk"}),this.handleClickShelfButton();case"firstChapter":return this.handleClickFirstChapter()}},onClickShelf:function(){this.saveReportInfo("Nav_Shelf"),(0,i.default)("/web/shelf")},layout:function(){return"PRERENDER"!==this.chapterContentState?o.default.reject({isCustomError:!0,reason:"ignoreLayoutWithWrongState"}):this.waitForPreRender().then(this.collectPreRenderInfos).then(function(){return{success:!0}})},waitForPreRender:function(){var E=this;return new o.default(function(b){function n(){var e=E.$refs.renderTargetContainerSibling,t=E.$refs.preRenderContainer;if(!e||!t)return console.error("waitForPreRender-wait: dom is not exist: target="+!!e+",prerender="+!!t+",state="+E.chapterContentState),void b();var n=t.getElementsByTagName("img"),r=n.length;if(0<r){for(var o=+new Date,i=0;i<r;i++){var a=n[i],s=a.outerHTML,c=Math.min(e.offsetWidth,a.parentNode.offsetWidth);if(-1!==s.indexOf("data-w")&&-1!==s.indexOf("data-ratio")){var l=new RegExp('data-w="(.*?)px"',"ig");s.match(l);var u=RegExp.$1,d=u&&0<u.length?parseInt(u):0;l=new RegExp('data-ratio="(.*?)"',"ig"),s.match(l);var h=RegExp.$1,f=h&&0<h.length?parseFloat(h):0;if(0!==d&&0!==f){var p=a.getBoundingClientRect(),g=d/f,v=g;if((l=new RegExp("width[0-9]{2,3}","ig")).test(s)){l=new RegExp("width([0-9]{2,3})","ig"),s.match(l);var m=RegExp.$1,_=m&&0<m.length?parseInt(m):0;0<_&&_<=100&&(d*=(v=c*_/100)/g)}else-1!==s.indexOf("qqreader-fullimg")||-1!==s.indexOf("bleed-pic")||a.parentNode.classList.contains("bleed-pic")?d*=(v=c)/g:0<p.height&&p.height<d?v=(d=p.height)/f:0<p.width&&p.width<v&&(d*=(v=p.width)/g);c<v&&(d*=c/v,v=c),a.style.width=v+"px",a.style.height=d+"px"}else console.log("[img-style] img no height or ratio, height = "+d+" ratio = "+f),se.inDevelopment()&&alert("找 zhoon 看看 - img no height or ratio")}else console.log("[img-style] img no height or ratio"),se.inDevelopment()&&alert("找 zhoon 看看 - img no height or ratio")}var C=+new Date;se.inDevelopment()&&console.log("[reader-layout] 处理图片 size 耗费的时间 = ",C-o,"毫秒 ","图片个数 =",r),b()}else b()}function r(){var e=E.$refs.renderTargetContainerSibling,t=E.$refs.preRenderContainer;if(e&&t){var n=e.offsetWidth;pe=n,t.style.width=n+"px"}}E.$nextTick(function(){var e=E.$refs.renderTargetContainerSibling,t=E.$refs.preRenderContainer;e&&t?(r(),E.$nextTick(function(){n()})):(console.error("waitForPreRender-nextTick: dom is not exist: target="+!!e+",prerender="+!!t+",state="+E.chapterContentState),E.$nextTick(function(){r(),E.$nextTick(function(){n()})}))})})},collectPreRenderInfos:function(){var v=this;return new o.default(function(o){var e=window.devicePixelRatio,t=v.$refs.preRenderContainer,n=[];v.currentChapter&&v.currentChapter.anchors&&(n=v.currentChapter.anchors.map(function(e){return e.anchor}));var i=q.default.collect(t,{canvasMaxHeight:4e3/e,canvasMaxCount:2},n);me=i.anchorsTop;for(var r=i.randomHtml.join(""),a=i.decoration.map(function(e){return e.html}).join(""),s="<style>"+i.customStyle.join(" ")+"</style>"+r+a,c="",l=t.offsetWidth,u=i.canvasPositions||[],d=[],h=0,f=u.length;h<f;h++){var p=u[h];if(p){d.push(p);var g=p.bottom-p.top;c+='<canvas style="position:absolute;left:0;top:'+p.top+"px;width:"+l+"px;height:"+g+'px;" width='+l*e+" height="+g*e+"></canvas>"}}v.$store.commit(m.UPDATE_READER_CHAPTER_CANVAS_TARGET_HTML,c),ve=i.content||[],ge=d,v.renderContentsVersion++,v.$store.commit(m.UPDATE_READER_CHAPTER_CONTENT_TARGET_HTML,s),v.$store.commit(m.UPDATE_READER_CONTENT_STATE,"DONE"),v.$nextTick(function(){var e=i.rootHeight;e<=0&&console.log("render rootHeight error !!!");var t=v.$refs.renderTargetContent;t.style.height=e+"px";var n=t.offsetWidth,r=v.$refs.renderTargetCanvasContainer;r.style.width=n+"px",r.style.height=e+"px",v.drawSomeTexts(),v.bindVideoEvent(),v.bindFooterNoteEvent(),o()})})},clearDrawTexts:function(){var e=this.$refs.renderTargetCanvasContainer;if(e)for(var t=e.getElementsByTagName("canvas"),n=0,r=t.length;n<r;n++){var o=t[n],i=o.ctx;(i=i||o.getContext("2d"))&&i.clearRect(0,0,o.width,o.height)}},drawSomeTexts:function(){var e=+new Date,t=this.$refs.renderTargetCanvasContainer;if(t){for(var n=window.devicePixelRatio,r=ge,o=t.getElementsByTagName("canvas"),i=o?o.length:0,a=new Array(i),s=0,c=0;c<i;c++){var l=o[c],u=r[c],d=l.getContext("2d");d&&(d.save(),d.scale(n,n),d.translate(0,-u.top),d.textAlign="left",d.textBaseline="middle"),a[c]=d,s+=Math.max(s,u.bottom)}for(var h=ve,f=this.isWhiteTheme,p=null,g=-1,v=0,m=h.length,_=0;v<m;v++){var C=h[v],b=C.rect;if(b.y>s)break;if(C.type===Y.ObjType.canvas){b.y>r[_].bottom&&_+1<r.length&&_++;var E=a[_];E?(g===_&&p&&p.font===C.font||(E.font=C.font),g===_&&p&&p.isHighLight()===C.isHighLight()&&p.colors.colorOnWhite===C.colors.colorOnWhite&&p.colors.colorOnBlack===C.colors.colorOnBlack||(E.fillStyle=C.isHighLight()?f?"#1B88EE":"#0097FF":C.colors[f?"colorOnWhite":"colorOnBlack"]),E.fillText(C.text,b.x,b.centerY),p=C,g=_):console.error("Cannot get canvas.context, objIdx="+v+" ,canvasIdx="+_)}}for(var R=0,T=a.length;R<T;R++){var k=a[R];k&&k.restore()}if(se.inDevelopment()){var S=+new Date;console.log("[reader-layout] Reader-drawSomeTexts","时间 =",S-e,"毫秒")}}},resizeToReCollect:function(e){var t=this,n=this;"DONE"===this.chapterContentState&&(this.clearSelection(),this.clearHighLightDom(),this.$store.commit(m.UPDATE_READER_CONTENT_STATE,"PRERENDER"),this.$nextTick(function(){return pe=e,t.$refs.preRenderContainer.style.width=e+"px",n.layout()}))},bindVideoEvent:function(){var n=document.querySelectorAll("video");if(0<n.length)for(var e=function(e){var t=n[e];t.addEventListener("click",function(){0<t.currentTime&&!t.paused&&!t.ended&&2<t.readyState?t.pause():(t.parentNode&&t.parentNode.classList.add("wr_video_playing"),t.play())}),t.onended=function(){t.parentNode&&t.parentNode.classList.remove("wr_video_playing")},t.onpause=function(){t.parentNode&&t.parentNode.classList.remove("wr_video_playing")}},t=0;t<n.length;t++)e(t)},bindFooterNoteEvent:function(){var n=this,r=document.querySelectorAll(".js_readerFooterNote");if(0<r.length)for(var e=function(e){var t=r[e];t.addEventListener("click",function(){var e=t.getAttribute("data-wr-footernote");e&&0<e.length&&n.$showFooterNote({text:e,node:t})})},t=0;t<r.length;t++)e(t)},handleClickStartReading:function(){"DONE"===this.chapterContentState&&ue.scrollTo(".readerChapterContent",300,{container:document.body,x:!1,y:!0,offset:-72})},handleClickShelfButtonInBookInfo:function(){return this.reportClientBusiness({itemName:"Web_Reader_FirstPage_AddClk"}),this.handleClickShelfButton()},handleClickRatingButton:function(){this.saveReportInfo("Reader_Click_Rating_Button"),(0,i.default)(this.bookReviewURL(this.bookId))},handleClickShelfButton:function(){if(this.hasLogin){if(!this.isInShelf)return this.$store.dispatch(v.FETCH_READER_ADD_SHELF)}else this.$showLoginDialog({bottomTitle:"扫码登录微信读书",bottomSubTitle:"在书架随时阅读本书"})},handleClickReceiveMemberCardButton:function(){this.isPhone?this.downloadApp():this.receiveMemberCard()},handleClickNextChapterIndex:function(){var c=this;return new o.default(function(e){var t=!1;if(c.currentChapter&&c.currentChapter.anchors&&0<c.currentChapter.anchors.length){var n=c.currentChapter.anchors,r=null,o=c.currentChapterAnchor;if(o)for(var i=0,a=n.length;i<a;i++){if(n[i].anchor===o&&i<a-1){r=n[i+1];break}}else r=n[0];if(r){var s=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;c.scrollTo({anchor:r.anchor}),t=!0,(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)===s&&(t=!1)}}e(t)}).then(function(e){if(!e)return c.handleClickNextChapter()})},handleClickPrevChapterIndex:function(){var s=this;return new o.default(function(e){var t=!1;if(s.currentChapter&&s.currentChapter.anchors&&0<s.currentChapter.anchors.length){var n=s.currentChapter.anchors,r=null,o=s.currentChapterAnchor;if(o){for(var i=0,a=n.length;i<a;i++){if(n[i].anchor===o&&0<i){r=n[i-1];break}}r||0<ve.length&&(s.scrollTo({chapterOffset:ve[0].getOffset()}),t=!0)}r&&(s.scrollTo({anchor:r.anchor}),t=!0)}e(t)}).then(function(e){if(!e)return s.handleClickPrevChapter()}).then(function(e){if(e&&e.success){var t=s.currentChapter.anchors;0<t.length&&s.scrollTo({anchor:t[t.length-1].anchor})}})},handleClickNextChapter:function(){var e=this.getChapterWithIdxOffset(1);if(e)return this.changeChapter({chapterUid:e.chapterUid})},handleClickPrevChapter:function(){var e=this.getChapterWithIdxOffset(-1);if(e)return this.changeChapter({chapterUid:e.chapterUid})},handleClickFirstChapter:function(){var e=this.chapterInfos;if(e&&0<e.length){var t=e[0];return this.hideCatalog(),this.changeChapter({chapterUid:t.chapterUid})}},handleClickChapter:function(e){if(e&&e.chapterUid){var t={chapterUid:e.chapterUid};return e.anchor&&(t.scrollTo={anchor:e.anchor}),this.hideCatalog(),this.changeChapter(t)}},handleClickNoteItem:function(e){var t=this;if(e.chapterUid)return this.hideNotePanel(),this.changeChapter({chapterUid:e.chapterUid,scrollTo:{chapterOffset:e.range.start}}).then(function(){t.reportClientBusiness({itemName:"Web_Reader_Note_ItemClk"}),e.noteType===Z.NoteTypeReview&&setTimeout(function(){t.showReviewDetailPanel([e])})})},handleClickUnderline:function(e){var t=e.notes;if(t[0].noteType===Z.NoteTypeBookmark){var n=e.range,r=this.findObjsInOffsetRange(ve,n.start,n.end),o=this.getRectsByContentObjs(r);this.showSelectionToolBar({objs:r,rects:o,existBookmark:t[0]})}else this.showReviewDetailPanel(t)},changeChapter:function(t){var n=this;if(l.default.isSupportedBookType(this.bookInfo.type))return this.loadTopReviews(),this.$store.dispatch(v.CHANGE_READER_CHAPTER,{chapterUid:t.chapterUid}).then(function(){return n.clearSelection(),n.clearHighLightDom(),n.layout()}).catch(function(e){if(e&&e.isCustomError){switch(e.reason){case"currentChapter":n.clearSelection(),n.clearHighLightDom(),t.searchItem?n.highLightDomsAndScrollTo(t.searchItem):t.scrollTo&&n.scrollTo(t.scrollTo);break;case"forceReload":window.location.reload();break;case"sessionTimeout":n.handleSessionTimeout()}return e}console.error("changeChapter-UnexpectedError0:",e)}).then(function(e){return e&&e.success&&(t.searchItem?n.highLightDomsAndScrollTo(t.searchItem):t.scrollTo&&n.scrollTo(t.scrollTo),n.checkIfShowMemberCardFreeReadingTips(),n.checkIfNeedRequestLoginQRCode(),n.reportReadingProgress({computeSummary:!0,computeProgress:!1})),e})},reloadCurrentChapter:function(){var t=this;return this.$store.dispatch(v.RELOAD_READER_CURRENT_CHAPTER).then(this.layout).catch(function(e){if(e&&e.isCustomError)switch(e.reason){case"forceReload":window.location.reload();break;case"sessionTimeout":t.handleSessionTimeout()}else console.error("reloadCurrentChapter-UnexpectedError:",e);return e})},onAfterLoginToGetMemberCard:function(){this.saveReportInfo("Login_Has_Login"),A.default.setSessionStorage(I.KEY_READER_LOGIN_PENDING_ACTION,(0,c.default)({toFreeRead:1})),window.location.reload()},showCatalog:function(){this.$refs.readerCatalog.show(),this.isShowAutoSearchHint&&this.$store.commit(m.UPDATE_READER_IS_SHOW_AUTO_SEARCH_HINT,!1)},hideCatalog:function(){this.$refs.readerCatalog.close()},toggleCatalog:function(){this.$refs.readerCatalog.toggle()},handleClickControls:function(e){switch(e){case"catalog":return this.reportClientBusiness({itemName:"Web_Reader_ContentClk"}),this.showCatalog();case"note":return this.reportClientBusiness({itemName:"Web_Reader_NoteClk"}),this.hasLogin?this.toggleNotePanel():this.$showLoginDialog({bottomTitle:"扫码登录微信读书",bottomSubTitle:"查看我的笔记"});case"theme":return this.isWhiteTheme?this.$store.dispatch(v.TOGGLE_THEME,{isWhite:!1}):(this.reportClientBusiness({itemName:"Web_Reader_LightClk"}),this.$store.dispatch(v.TOGGLE_THEME,{isWhite:!0}));case"download":return this.downloadAppToRead()}},showNotePanel:function(){this.$refs.readerNotePanel.show()},hideNotePanel:function(){this.$refs.readerNotePanel.close()},toggleNotePanel:function(){this.$refs.readerNotePanel.isShowing()?this.hideNotePanel():this.showNotePanel()},toggleBottomSettingPanel:function(){this.isShowBottomSettingPanel=!this.isShowBottomSettingPanel},handleClickBottomBarItem:function(e){switch(e){case"shelf":return this.handleClickShelfButton();case"catalog":return this.isShowBottomSettingPanel&&(this.isShowBottomSettingPanel=!1),this.toggleCatalog();case"setting":return this.$refs.readerCatalog&&this.$refs.readerCatalog.isShowing()&&this.hideCatalog(),this.toggleBottomSettingPanel()}},handleClickBottomSettingPanelItem:function(e){switch(e){case"white":return this.reportClientBusiness({itemName:"Web_Reader_LightClk"}),this.$store.dispatch(v.TOGGLE_THEME,{isWhite:!0});case"dark":return this.$store.dispatch(v.TOGGLE_THEME,{isWhite:!1});case"download":(0,F.default)(function(e){e?(0,j.default)({openUrl:(0,G.default)("",{})}):(0,W.default)()})}},doSearch:function(e){return e.isLoadMore||this.reportClientBusiness({itemName:"Web_Reader_Search"}),this.$store.dispatch(v.FETCH_READER_SEARCH,e)},enterSearch:function(){return this.$store.commit(m.UPDATE_READER_IS_IN_SEARCH,!0)},exitSearch:function(){this.$store.commit(m.CLEAR_READER_SEARCH_RESULT),this.$store.commit(m.UPDATE_READER_IS_IN_SEARCH,!1)},handleClickSearchItem:function(e){return this.hideCatalog(),this.reportClientBusiness({itemName:"Web_Reader_Search_ResultClk"}),this.changeChapter({chapterUid:e.chapterUid,searchItem:e})},highLightObjs:function(e){var t=this.getRectsByContentObjs(e);if(0<t.length){var n="";t.forEach(function(e){n+='<div class="wr_highlight_bg" style="'+e.toCSSPositionString()+'"></div>'}),this.chapterContentHighLightBgHtml=n}else this.chapterContentHighLightBgHtml=""},clearHighLight:function(){this.chapterContentHighLightBgHtml=""},clearHighLightDom:function(){this.clearHighLight(),(0,S.default)(document.querySelectorAll(".wr_highlight_char")).forEach(function(e){e.classList.remove("wr_highlight_char")})},highLightDomsAndScrollTo:function(e){var t=this;if(e){var n=e.absStart,r=e.absEnd,o=e.keywordStart,i=e.keyword||[];if(e.abstract&&!(r<=n||o<n||r<o)){var a=this.findObjsInOffsetRange(ve,n,r),s=a.length,c=[];if(0<s)for(var l=0,u=null,d=0,h=[];l<s;){var f=a[l];if(f.getOffset()<o)l++;else{var p=f.isTextOrCanvasType()&&f.text;if(p&&0!==p.length){if(u)u.indexOf(p)===d?(d+=p.length,h.push(f)):(u=null,d=0,h=[]);else for(var g=0;g<i.length;g++){var v=i[g];if(0===v.indexOf(p)){u=v,d=p.length,h.push(f);break}}u&&0<u.length&&u.length===d&&(c.push.apply(c,(0,k.default)(h)),h=[]),l++}else l++}}this.highLightObjs(a),(0,S.default)(document.querySelectorAll(".wr_highlight_char")).forEach(function(e){e.classList.remove("wr_highlight_char")});for(var m=be,_=0,C=m.length;_<C;_++)m[_].setHighLight(!1);for(var b=0,E=(be=c).length;b<E;b++){var R=c[b];if(R.setHighLight(!0),R.type===Y.ObjType.txt){var T=document.querySelector("[data-wr-id="+R.id+"]");T&&T.classList.add("wr_highlight_char")}}this.clearDrawTexts(),this.drawSomeTexts(),this.$nextTick(function(){0<a.length&&t.scrollTo({chapterOffset:n})})}}},scrollTo:function(e){if(e&&0!==ve.length){var t=e.chapterOffset;if("number"==typeof t&&0<=t){if(!0===e.ignoreWhenScrollToTop){var n=ve[0].getOffset();if(0===t||t<=n)return}var r=this.findObjsInOffsetRange(ve,t,t+1);r&&0<r.length&&this.scrollToObj(r[0])}else if("string"==typeof e.anchor&&0<e.anchor.length)for(var o=0,i=me.length;o<i;o++){var a=me[o];if(a.anchor===e.anchor){var s=a.offsetTop;0<s&&this.scrollToOffsetTop(s);break}}}},scrollToOffsetTop:function(e){var t=0,n=this.$refs.renderTargetContainer;n&&(t=e-20-72+n.offsetTop),0<t&&window.scrollTo(0,t)},scrollToObj:function(e){this.scrollToOffsetTop(e.rect.y)},findFirstObjIndexContainingText:function(e){for(var t=0;t<e.length;){var n=e[t];if(n.isTextOrCanvasType()&&n.text&&0<n.text.length)return t;t++}return-1},binaryFindObjIndex:function(e,t,n){var r=!(2<arguments.length&&void 0!==n)||n,o=e.length;if(0===o)return-1;if(1===o)return t(e[0])?0:-1;for(var i=0,a=o-1;i<a;){if(i===a-1)return r?t(e[i])?i:t(e[a])?a:-1:t(e[a])?a:t(e[i])?i:-1;var s=Math.floor((i+a)/2),c=t(e[s]);if(r)if(c){if(!(0!==s))return s;if(!t(e[s-1]))return s;a=s}else i=s;else if(c){if(!(s!==o-1))return s;if(!t(e[s+1]))return s;i=s}else a=s}return-1},getContentStringFromObjIdx:function(e,t,n){for(var r="";t<e.length&&r.length<n;){r+=e[t].text||"",t++}return r},findObjsInOffsetRange:function(e,t,n){if(n<=t||t<0||n<0)return[];var r=this.binaryFindObjIndex(e,function(e){return e.getOffset()>=t}),o=this.binaryFindObjIndex(e,function(e){return e.getOffset()<n},!1);return-1<r&&-1<o&&r<=o?e.slice(r,o+1):[]},getRectsByContentObjs:function(e){var r=[],o=void 0;return e.forEach(function(e){var t=e.rect;if(o)if((te.default.isVerticalContain(o,t)||te.default.isVerticalOverLap(o,t))&&o.isLeftOn(t)){var n=te.default.union(o,t);o.set(n)}else o=t.clone(),r.push(o);else o=t.clone(),r.push(o)}),r},reportEnterReading:function(){var t=this;if(this.needReportReadingProgress){var e="",n=0,r=ve,o=this.findFirstObjIndexContainingText(r);return-1!==o&&(n=r[o].getOffset(),e=this.getContentStringFromObjIdx(r,o,20)),this.$store.dispatch(v.FETCH_READER_ENTER_BOOK_READ,{firstDomOffset:n,firstDomSummaryText:e}).then(function(e){e&&1===e.sessionTimeout&&t.handleSessionTimeout()})}},reportReadingProgress:function(e){var t=this;if(this.needReportReadingProgress)return this.$store.dispatch(v.FETCH_READER_BOOK_READ,{retryCount:1,progressData:this.computeProgressData(e)}).then(function(e){e&&1===e.sessionTimeout?t.handleSessionTimeout():t.startReportTimer()}).catch(function(e){console.error("[chantlog] Reader.vue-reportReadingProgress","err",e),t.startReportTimer()})},clearReportTimer:function(){Ce&&clearTimeout(Ce)},startReportTimer:function(){this.clearReportTimer(),Ce=setTimeout(this.reportReadingProgress,3e4)},computeProgressData:function(e){var t=0<arguments.length&&void 0!==e?e:{computeSummary:!0,computeProgress:!0},n=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;if(void 0===n||n<0)return null;var r=this.$refs.renderTargetContainer;if(!r)return console.log("Reader-computeProgressData","renderTargetContainer is undefined"),null;var o=n+72-r.offsetTop,i=ve,a=this.binaryFindObjIndex(i,function(e){return e.rect.y>=o});if(-1===a)return console.log("Reader-computeProgressData","obj idx === -1"),null;var s=i[a].getOffset(),c=t.computeSummary?this.getContentStringFromObjIdx(i,a,20):"",l=ce.get(this.progress,"book.progress",0);if(t.computeProgress&&!this.isNeedPay){var u=this.bookInfo.totalWords||0;if(0<u){var d=this.computePrevChaptersWordCount(),h=0<i.length?a/i.length:0,f=parseInt(h*this.currentChapter.wordCount),p=(d+f)/u;p<=100?l=Math.max(0,parseInt(100*p)):console.error("Reader-computeProgressData progress>100:","bookId=",this.bookId,"chapter=",this.currentChapter.chapterUid,"prev1=",d,"per=",h,"prev2=",f,"total=",u)}}return{offset:s,content:c,progress:l}},computePrevChaptersWordCount:function(){for(var e=this.chapterInfos,t=this.currentChapter,n=0,r=0,o=e.length;r<o;r++){var i=e[r];if(i.chapterIdx>=t.chapterIdx)break;n+=i.wordCount}return n},showConfirmAuthDialog:function(){var e=this;this.$showConfirmAuthDialog({requireVid:this.user.vid},function(){e.isBalanceNeedAuth=!1,e.$store.dispatch(v.FETCH_READER_BALANCE)})},showPayDialog:function(){var n=this;this.hasLogin?(this.$store.dispatch(v.FETCH_READER_BALANCE).then(function(e){var t=(0,V.default)(e);return t&&-12013===t.errCode&&(n.isBalanceNeedAuth=!0,n.showConfirmAuthDialog()),e}),l.default.isBuyUnitWholeBook(this.bookInfo)?(this.isShowPayWholeDialog=!0,this.$nextTick(function(){n.$refs.payWholeBookDialog.showDialog()})):(this.isShowPayChapterDialog=!0,this.$nextTick(function(){n.$refs.payChapterDialog.showDialog(n.currentChapter.chapterUid)}))):this.isPhone&&this.downloadApp()},hidePayDialog:function(){l.default.isBuyUnitWholeBook(this.bookInfo)?this.$refs.payWholeBookDialog.closeDialog():this.$refs.payChapterDialog.closeDialog()},payWholeBook:function(){var n=this;if(l.default.isBuyUnitWholeBook(this.bookInfo)){if(this.isBalanceNeedAuth)return void this.showConfirmAuthDialog();var e=this.balance.iOS>this.balance.Android?"ios":"android",t=ce.get(this.bookInfo,"price",0);if(this.hasMemberCardDiscount)t=t*(100-ce.get(this.bookInfo,"mcardDiscount",0))/100;if(t<=(this.balance.iOS>this.balance.Android?this.balance.iOS:this.balance.Android))return this.$store.dispatch(v.FETCH_READER_BUY_BOOK,{pf:e,price:t,isMCard:this.hasMemberCard}).then(function(e){var t=ce.get(e,"errCode",0);-12013===t?n.showConfirmAuthDialog():-2010===t||-2012===t||-2013===t?n.handleSessionTimeout():-2281===t?(void 0!==ce.get(e,"info.price")&&n.$store.commit(m.UPDATE_READER_BOOK_INFO_PRICE,ce.get(e,"info.price")),void 0!==ce.get(e,"info.payType")&&n.$store.commit(m.UPDATE_READER_BOOK_INFO_PAY_TYPE,ce.get(e,"info.payType")),n.$toast("书籍价格已更新，请重新购买")):1===ce.get(e,"succ",0)?(n.$toast("购买成功"),n.hidePayDialog(),n.$store.dispatch(v.FETCH_READER_ADD_SHELF),n.$store.dispatch(v.FETCH_READER_BOOK_INFO,{envConfig:{},isLogin:!0}),n.$store.dispatch(v.RELOAD_READER_CHAPTER_INFOS,{isLogin:!0}),n.reloadCurrentChapter()):n.$toast("购买失败，请重试")});this.hidePayDialog(),this.downloadAppToAccount()}},payChapter:function(e){var n=this,r=e.chapterIds,t=e.totalPrice,o=e.isAutoPay;if(!l.default.isBuyUnitWholeBook(this.bookInfo)){var i=p.default.formatChapterUids(r);if(0===i.length)return;if(this.isBalanceNeedAuth)return void this.showConfirmAuthDialog();var a=this.balance.iOS>this.balance.Android?"ios":"android";if(t<=(this.balance.iOS>this.balance.Android?this.balance.iOS:this.balance.Android))return this.$store.dispatch(v.FETCH_READER_BUY_CHAPTERS,{pf:a,chapterIds:i,totalPrice:t,isAutoPay:o,isMCard:this.hasMemberCard}).then(function(e){var t=ce.get(e,"errCode",0);-12013===t?n.showConfirmAuthDialog():-2010===t||-2012===t||-2013===t?n.handleSessionTimeout():-2281===t?n.$toast("书籍价格已更新，请刷新后重试"):1===ce.get(e,"succ",0)?(n.$toast("购买成功"),n.hidePayDialog(),n.$store.dispatch(v.FETCH_READER_ADD_SHELF),n.$store.dispatch(v.RELOAD_READER_CHAPTER_INFOS,{isLogin:!0}).then(function(){if(-1!==r.indexOf(ce.get(n.currentChapter,"chapterUid")))return n.reloadCurrentChapter()})):n.$toast("购买失败，请重试")});this.hidePayDialog(),this.downloadAppToAccount()}},showMemberCardTips:function(e){this.$refs.readerMemberCardTips.show(e)},checkIfShowMemberCardFreeReadingTips:function(){if(se.isEnvClient&&(this.hasLogin&&!this.isNeedPay&&this.isNeedPayWithoutMemberCard)){var e=ce.get(this.user,"vid"),t=A.default.getReaderMemberCardTipsBookIdsOperator(e);t.isBookExist(this.bookId)||(this.showMemberCardTips("你正在使用无限卡阅读付费部分"),t.addBook(this.bookId),t.save())}},checkIfSyncReadingProgress:function(){var n=this;return this.$store.dispatch(v.FETCH_READER_PROGRESS,{compareWithLocal:!0}).then(function(e){if(e&&e.book){var t=e.book;return n.$toast("正在跳转到最新进度"),n.changeChapter({chapterUid:t.chapterUid,scrollTo:{chapterOffset:t.chapterOffset}}).then(function(){return!0})}return!1})},checkIfNeedRequestLoginQRCode:function(){this.isNeedShowLoginGuide&&(this.loginGuideQRCodeImg&&!this.isLoginGetInfoError&&!this.isLoginGetUidError||this.requestLoginUid())},requestLoginUid:function(){var t=this;this.isLoginQRCodeLoading=!0,(0,z.default)("/web/login/getuid",{},function(e){e&&e.data&&e.data.uid?(t.isLoginQRCodeLoading=!1,t.isLoginGetUidError=!1,t.isLoginGetInfoError=!1,t.generateLoginGuideQRCode(e.data.uid),t.requestLoginInfo(e.data.uid)):(t.isLoginQRCodeLoading=!1,t.isLoginGetUidError=!0,t.isLoginGetInfoError=!1)},function(e){console.error("Reader-requestLoginUid error",e),t.isLoginQRCodeLoading=!1,t.isLoginGetUidError=!0,t.isLoginGetInfoError=!1})},generateLoginGuideQRCode:function(e){this.loginGuideQRCodeImg=n(66).getQrBase64("https://weread.qq.com/web/confirm?uid="+e,{padding:6,width:144,height:144,correctLevel:QRErrorCorrectLevel.H,background:"#FFF",foreground:"#000"})},requestLoginInfo:function(e){var t=this;(0,z.default)("/web/login/getinfo",{uid:e},function(e){e&&e.data&&e.data.vid&&e.data.skey&&e.data.code?t.requestLogin(e.data):(t.isLoginGetInfoError=!0,0<t.autoLoadLoginQRCodeCount&&(t.autoLoadLoginQRCodeCount--,t.checkIfNeedRequestLoginQRCode()))},function(e){console.error("Reader-requestLoginInfo error",e),t.isLoginGetInfoError=!0,0<t.autoLoadLoginQRCodeCount&&(t.autoLoadLoginQRCodeCount--,t.checkIfNeedRequestLoginQRCode())})},requestLogin:function(e){var t=this,n=e.pf;(0,z.default)("/web/login/weblogin",{vid:e.vid,skey:e.skey,code:e.code},function(e){e&&e.data&&e.data.vid&&e.data.accessToken&&e.data.refreshToken&&(e.data.pf=n,t.handleLoginResult(e.data))},function(e){console.error("Reader-requestLogin error",e)})},handleLoginResult:function(e){var t=this;(0,z.default)("/web/login/session/init",{vid:e.vid,skey:e.accessToken,rt:e.refreshToken,pf:e.pf},function(){t.onAfterLoginToGetMemberCard()},function(e){console.error("Reader-handleLoginResult error",e),t.onAfterLoginToGetMemberCard()})},receiveMemberCard:function(){},downloadApp:function(){this.isPhone&&this.reportClientBusiness({itemName:"Web_Phone_Reader_DownloadClk"}),this.$showDownloadAppDialog(),this.$downloadAppComponent.beginToLoadQrCode({subTitle:"全场书籍免费读"})},downloadAppToRead:function(){this.reportClientBusiness({itemName:"Web_Download_ReaderToolExp"}),this.$showDownloadAppDialog();var e=void 0;e=l.default.isMPBookType(this.bookInfo.type)?{schemeName:"book",bId:this.bookId,type:this.bookInfo.type}:l.default.isComicType(this.bookInfo.type)?{schemeName:"comicReader",bId:this.bookId}:{schemeName:"reading",bId:this.bookId,type:this.bookInfo.type,chapterUid:ce.get(this.currentChapter,"chapterUid",0)},e=ce.merge(e,{subTitle:"在手机上继续阅读本书",from:"ReaderControl"}),this.$downloadAppComponent.beginToLoadQrCode(e)},downloadAppToMemberCard:function(){this.$showDownloadAppDialog(),this.$downloadAppComponent.beginToLoadQrCode({schemeName:"memCard",from:"ReaderMemberCard",memCardExpand:1,title:"扫码去微信读书 App 续期无限卡",subTitle:"全场书籍免费读"}),this.reportClientBusiness({itemName:"Web_Download_ReaderCardExp"})},downloadAppToAccount:function(){this.$showDownloadAppDialog(),this.$downloadAppComponent.beginToLoadQrCode({schemeName:"account",from:"ReaderRecharge",title:"扫码去微信读书 App 充值",subTitle:""}),this.reportClientBusiness({itemName:"Web_Download_ReaderRechargeExp"})},logOnClientMounted:function(){if(se.isEnvClient){this.haveReportInfo("Index_Recommend")&&this.reportClientBusiness({itemName:"Web_Home_GuessClk"},"Index_Recommend"),this.haveReportInfo("Index_Shelf_Book")&&this.reportClientBusiness({itemName:"Web_Home_ShelfBookClk"},"Index_Shelf_Book"),this.haveReportInfo("Shelf_Enter_Reader")&&this.reportClientBusiness({itemName:"Web_Shelf_BookClk"},"Shelf_Enter_Reader"),this.haveReportInfo("Search_HotBook_Reader")&&this.reportClientBusiness({itemName:"Web_Search_HotClk"},"Search_HotBook_Reader"),this.haveReportInfo("SearchResult_Click_BookId")&&this.reportClientBusiness({itemName:"Web_Search_BookId_Clk",value:this.bookId},"SearchResult_Click_BookId"),this.haveReportInfo("SearchResult_Click_BookName")&&(this.reportClientBusiness({itemName:"Web_Search_ResultClk"},"SearchResult_Click_BookName"),this.reportClientBusiness({itemName:"Web_Search_ResultClk_Name"})),this.haveReportInfo("SearchResult_Click_Content")&&(this.reportClientBusiness({itemName:"Web_Search_ResultClk"},"SearchResult_Click_Content"),this.reportClientBusiness({itemName:"Web_Search_ResultClk_Content"}));var e=this.haveReportInfo("CategoryBook_Enter_Reader");if((e||e&&e.categoryId)&&(this.reportClientBusiness({itemName:"Web_Ranking_All_BookClk"},"CategoryBook_Enter_Reader"),e.categoryId&&this.reportClientBusiness({itemName:"Web_Ranking_Type_BookClk",value:(0,c.default)({type:e.categoryId})})),this.haveReportInfo("Index_Book_All")?this.reportClientBusiness({itemName:"Web_Home_Top200_Clk"},"Index_Book_All"):this.haveReportInfo("Index_Book_Novel")?this.reportClientBusiness({itemName:"Web_Home_TopFic_Clk"},"Index_Book_Novel"):this.haveReportInfo("Index_Book_New")?this.reportClientBusiness({itemName:"Web_Home_TopNew_Clk"},"Index_Book_New"):this.haveReportInfo("Index_Book_Rise")&&this.reportClientBusiness({itemName:"Web_Home_TopRise_Clk"},"Index_Book_Rise"),this.isShowTopBarAddShelfButton&&this.reportClientBusiness({itemName:"Web_Reader_TopAddExp"}),this.isCurrentChapterTheFirst&&(this.reportClientBusiness({itemName:"Web_Reader_FirstPage"}),this.showFirstPageAddShelfButton&&this.reportClientBusiness({itemName:"Web_Reader_FirstPage_AddExp"})),this.isPhone&&this.reportClientBusiness({itemName:"Web_Phone_Reader_DownloadExp"}),this.isWeiXin&&this.hasLogin){var t=this.$router.currentRoute.query,n=t.wtype&&"shareOneGetOne"===t.wtype,r=t.wvid&&"app"===t.wfrom,o=t.inviteCode;if((n||r||o)&&this.reportClientGlobal({itemName:"Web_Enter_Activity"}),n){this.reportClientBusiness({itemName:"Web_ShareOneGetOne_Enter_Reader"}),this.reportClientAppSharePage({itemName:"page|Web_ShareOneGetOne_Enter_Reader"}),this.reportClientAppSharePage({itemName:"page|Web_ShareOneGetOne_Enter_Reader|h5"});var i=t.senderVid,a=t.campaignId;if(!i||!a)return;var s=a.split("_")[0];s&&(this.reportClientAppSharePage({itemName:"page|Web_ShareOneGetOne_Enter_Reader_"+s}),this.reportClientAppSharePage({itemName:"page|Web_ShareOneGetOne_Enter_Reader_"+s+"|h5"})),oe.default.post("https://weread.qq.com/i/share-one-get-one/redeem",{bookId:this.bookId,campaignId:a,senderVid:i}).then(function(e){1===ce.get(e,"data.succ",0)?console.log("[zhoonlog] succ = 1"):console.log("[zhoonlog] succ != 1")}).catch(function(e){console.log("[zhoonlog] err = "+e)})}else r?(this.reportClientAppSharePage({itemName:"page|Web_AppShare_Enter_Reader"}),this.reportClientAppSharePage({itemName:"page|Web_AppShare_Enter_Reader|h5"}),this.reportClientBusiness({itemName:"Web_AppShare_Enter_Reader"}),this.reportClientBusiness({itemName:"Web_AppShare_Enter_ReaderSelf",vid:t.wvid})):o&&(this.reportClientBusiness({itemName:"Web_InviteCode_Enter_Reader"}),this.reportClientAppSharePage({itemName:"page|Web_InviteCode_Enter_Reader"}),this.reportClientAppSharePage({itemName:"page|Web_InviteCode_Enter_Reader|h5"}))}}},autoSearchOnClientMounted:function(){var e=A.default.getSessionStorage(I.KEY_READER_AUTO_SEARCH);if(e){var t=JSON.parse(e);t.keyword&&(this.$store.dispatch(v.FETCH_READER_SEARCH_AUTO,{keyword:t.keyword}),this.$refs.readerCatalog.setSearchKeyword(t.keyword)),A.default.setSessionStorage(I.KEY_READER_AUTO_SEARCH)}},setupProgressReportOnDomReady:function(){if(this.needReportReadingProgress&&!_e){_e=!0;var r=this;this.reportEnterReading(),this.$store.commit(m.UPDATE_READER_START_READING_TIME),this.startReportTimer();var e=n(771).ifvisible;e.setIdleDuration(120),e.on("statusChanged",function(e){switch(e.status){case"hidden":case"idle":r.$store.dispatch(v.READER_MARK_PAUSE),r.clearReportTimer();break;case"active":o.default.all([r.$store.dispatch(v.READER_MARK_ACTIVE),r.checkIfSyncReadingProgress()]).then(function(e){var t=e[0],n=e[1];if(t&&!n)return r.$store.dispatch(v.FETCH_READER_BOOK_READ,{retryCount:1,progressData:r.computeProgressData()})}),r.startReportTimer()}})}},handleLoginPendingActions:function(){if(se.isEnvClient){var e=A.default.getSessionStorage(I.KEY_READER_LOGIN_PENDING_ACTION);if(e)if(A.default.setSessionStorage(I.KEY_READER_LOGIN_PENDING_ACTION),this.hasLogin)if(1===ce.get(JSON.parse(e),"toFreeRead",0))if(this.isNeedPayWithoutMemberCard)if(!this.isNeedPay&&this.isNeedPayWithoutMemberCard);else if(this.hasMemberCard);else{if(this.isBlackUser&&2===ce.get(this.bookInfo,"ispub"));else{if(this.canReceiveMemberCard)return this.receiveMemberCard();this.$toast("你已领取过该福利")}}else;}},requestMemberCardPriceIfNeeded:function(){var i=this;this.isShowBuyMemberCardButton&&!this.hasFetchMemberCardPrice&&(0,K.default)("/web/pay/memberprice",{vid:ce.get(this.user,"vid"),pf:ce.get(this.user,"pf",0)},function(e){i.hasFetchMemberCardPrice=!0;var t=e.data,n=ce.get(t,"promoPrice",0),r=ce.get(t,"promoLabel","");if(0<n&&0<r.length)i.buyMemberCardButtonLine1="无限卡 "+r+Math.round(n)/100+"元 · 全场书籍免费读";else if(0<ce.get(t,"price",0)){var o=ce.get(t,"price",0);i.buyMemberCardButtonLine1="无限卡 "+Math.round(o)/100+"元/月 · 全场书籍免费读"}else i.buyMemberCardButtonLine1="无限卡 19元/月 · 全场书籍免费读"},function(){})},handleSessionTimeout:function(){this.isWeiXin||this.$toast("登录过期，请重新登录"),setTimeout(function(){window.location.reload()},3e3)},clientXY2RenderAreaXY:function(e){var t=this.$refs.renderTargetContainer;if(t){var n=t.offsetLeft,r=t.offsetTop,o=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;return e.x=e.x-n+o,e.y=e.y-r+i,e}return e},findObjsWithPoints:function(e,t){var n,r,o=ve,i=o.length,a=[e,t].sort(function(e,t){return e.y!==t.y?e.y-t.y:e.x-t.x}),s=this.binaryFindObjIndex(o,function(e){return e.rect.bottom>=a[0].y});if(-1!==s){for(;s<i&&(n=o[s],void 0,!((r=n.rect).centerX>=a[0].x||r.y>=a[0].y));)s++;s===i&&(s=-1)}var c,l,u=this.binaryFindObjIndex(o,function(e){return e.rect.y<a[1].y},!1);if(-1!==u)for(;0<=u&&(c=o[u],void 0,!((l=c.rect).centerX<=a[1].x||l.bottom<=a[1].y));)u--;var d=[],h=[];return-1!==s&&-1!==u&&(h=s<=u?[s,u+1]:[u+=1,(s-=1)+1],d=o.slice(h[0],h[1])),d},getRangeFromObjs:function(e){for(var t=new ee.default(e[0].getOffset(),e[0].getOffset()),n=1,r=e.length;n<r;n++){var o=e[n].getOffset();t.start>o&&(t.start=o),t.end<o&&(t.end=o)}return t.end++,t},hasSelection:function(){return 0<ke.length},clearSelection:function(){this.chapterContentSelectionHtml="",Se=[],ke=[],this.$hideSelectionToolBar()},onContentMouseDown:function(e){if("DONE"===this.chapterContentState){var t=(e=e||window.event).target,n=!1;if(t===this.$refs.appContent||t===document.documentElement||t===document.getElementById("routerView"))n=!0;else for(var r=t,o=this.$refs.readerChapterContent;o&&r&&r!==document.body;){if(o&&o===r){n=!0;break}r=r.parentNode}n&&(Te=!0,ke=[],Se=[],Re=this.clientXY2RenderAreaXY({x:e.clientX,y:e.clientY}),Ee=(new Date).getTime())}},onContentMouseMove:function(e){if("DONE"===this.chapterContentState&&Te&&null!==Re)if(1===(e=e||window.event).which){var t=this.clientXY2RenderAreaXY({x:e.clientX,y:e.clientY}),n=this.findObjsWithPoints(Re,t);if(500<n.length){var r=!1;if(0<ke.length?n[0]===ke[0]?(n=n.slice(0,500),r=!0):n[n.length-1]===ke[ke.length-1]&&(n=n.slice(n.length-500),r=!0):(n=n.slice(0,500),r=!0),!r)return}var o=this.getRectsByContentObjs(n);if(0<o.length){var i="";o.forEach(function(e){i+='<div class="wr_selection" style="'+e.toCSSPositionString()+'"></div>'}),this.chapterContentSelectionHtml=i}else this.chapterContentSelectionHtml="";ke=n,Se=o}else Te=!1},onContentMouseUp:function(){if("DONE"===this.chapterContentState&&(Te=!1,0<Se.length)){for(var e=this.getRangeFromObjs(ke),t=null,n=this.notesListInCurrentChapter,r=0,o=n.length;r<o;r++){var i=n[r];if(i.noteType===Z.NoteTypeBookmark&&ee.default.isContain(i.range,e)){t=i;break}}this.showSelectionToolBar({objs:ke,rects:Se,existBookmark:t})}},showSelectionToolBar:function(e){var t=this,n=e.objs,r=e.rects,o=e.existBookmark,i=this.$refs.renderTargetContainer,a=this.$refs.appContent,s=window.innerHeight||Math.min(document.documentElement.clientHeight,document.body.clientHeight),c=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,l=i.offsetTop,u=_.default.getDomsRelativeOffset(i,a);this.$showSelectionToolBar({parentNode:i,toolbarBoundsLimit:{left:-u.left,right:a.offsetWidth-u.left,top:c-l+72,bottom:c-l+s},canCopy:this.canCopy(n),rects:r,existBookmark:o,onClickToolBarItem:function(e){if(!t.hasLogin&&!0===e.requireLogin)return t.$showLoginDialog({bottomTitle:"扫码登录微信读书",bottomSubTitle:e.requireLoginText||""});switch(e.type){case"copy":t.copyObjsText(n),t.reportClientBusiness({itemName:"Web_SelectionTool_Copy"});break;case"underline":o?t.updateBookmark(o,e.styleId):t.underlineObjs(n,e.styleId),t.reportClientBusiness({itemName:"Web_SelectionTool_Underline"});break;case"removeUnderline":t.removeBookmark([o.bookmarkId]),t.reportClientBusiness({itemName:"Web_SelectionTool_RemoveUnderline"});break;case"review":t.showWriteReviewPanel(n),t.reportClientBusiness({itemName:"Web_SelectionTool_Review"});break;default:t.$toast("功能开发中",1500)}t.clearSelection()}}),this.reportClientBusiness({itemName:"Web_SelectionTool_Exp"})},underlineObjs:function(e,t){for(var n=this.getRangeFromObjs(e),r=this.notesListInCurrentChapter,o=[],i=0,a=r.length;i<a;i++){var s=r[i];s.noteType===Z.NoteTypeBookmark&&ee.default.isIntersection(n,s.range)&&(o.push(s.bookmarkId),n=ee.default.union(n,s.range))}if(this.removeBookmark(o),void 0===t){var c=A.default.getLocalSettingOperator().getValueWithType(I.LOCAL_SETTING_OBJ_KEYS.UNDERLINE_STYLE,"number");t=null===c?1:c}this.addBookmark(n,t)},removeBookmark:function(e){var t=this;e.forEach(function(e){t.$store.dispatch(v.REMOVE_BOOKMARK,{bookmarkId:e})})},updateBookmark:function(e,t){var n=this;return this.$store.dispatch(v.UPDATE_BOOKMARK,{bookmarkId:e.bookmarkId,style:t}).then(function(e){1===e.succ&&n.saveLastBookmarkStyle(t)})},addBookmark:function(e,t){var n=this,r=this.findObjsInOffsetRange(ve,e.start,e.end);return this.$store.dispatch(v.ADD_BOOKMARK,{bookId:this.bookId,chapterUid:this.currentChapter.chapterUid,chapterIdx:this.currentChapter.chapterIdx,bookVersion:this.bookInfo.version,type:1,style:t,range:e.toString(),markText:this.getTextFromObjs(r)}).then(function(e){1===e.succ?n.saveLastBookmarkStyle(t):n.$toast("划线失败，请重试")})},saveLastBookmarkStyle:function(e){var t=A.default.getLocalSettingOperator();t.value[I.LOCAL_SETTING_OBJ_KEYS.UNDERLINE_STYLE]=e,t.save()},canCopy:function(e){for(var t=0,n=e.length;t<n;t++){if(e[t].isTextOrCanvasType())return!0}return!1},copyObjsText:function(e){if(this.canCopy(e)){var t=this.getTextFromObjs(e,{limitLength:500});0!==t.length&&this.copyText(t)&&this.$toast("已复制到剪贴板")}},getTextFromObjs:function(e,t){for(var n=(1<arguments.length&&void 0!==t?t:{}).limitLength||-1,r="",o=0,i=e.length;o<i&&!(0<n&&n<=o);o++)r+=e[o].text;return r},copyText:function(e){we=!0;var t=document.createElement("input");t.setAttribute("type","text"),t.setAttribute("readonly","readonly"),t.setAttribute("value",e),document.body.appendChild(t),t.select();var n=document.execCommand("copy");return document.body.removeChild(t),we=!1,n},loadTopReviews:function(){this.topReviewList&&0<this.topReviewList.length||(this.$store.dispatch(v.FETCH_BOOK_REVIEW_LIST,{bookId:this.bookId,count:3,listType:ne.ReviewListTypeBookTop}),this.hasLogin&&this.$store.dispatch(v.FETCH_BOOK_REVIEW_LIST,{bookId:this.bookId,count:3,listType:ne.ReviewListTypeBookFriendTop}))},syncMyNote:function(e){if(this.isNeedShowMyNote&&("sync"===e.bookmark&&this.$store.dispatch(v.FETCH_BOOK_BOOKMARK_LIST,{bookId:this.bookId,type:Q.BookMarkTypeUnderline}),"sync"===e.review||"append"===e.review)){var t={bookId:this.bookId,listType:ne.ReviewListTypeNote,userVid:this.user.vid,mine:1,count:0};"append"===e.review&&(t=ce.merge(t,{synckey:this.notes.reviewSynckey,append:!0})),this.$store.dispatch(v.FETCH_BOOK_REVIEW_LIST,t)}},changeFontSize:function(t){var n=this;if(!(t<1||5<t)&&"DONE"===this.chapterContentState){this.clearSelection(),this.clearHighLightDom();var r=this.computeProgressData({computeSummary:!1,computeProgress:!1});return this.$store.commit(m.UPDATE_READER_CONTENT_STATE,"PRERENDER"),this.fontSizeLevel=t,new o.default(function(e){setTimeout(e,0)}).then(this.layout).then(function(e){e&&e.success&&(r&&n.scrollTo({chapterOffset:r.offset,ignoreWhenScrollToTop:!0}),n.saveLocalFontSizeLevel(t),n.reportClientBusiness({itemName:"Web_Reader_FontChange"}))}).catch(function(e){console.error("changeFontSize-UnexpectedError:",e)})}},saveLocalFontSizeLevel:function(e){var t=A.default.getLocalSettingOperator();t.value[I.LOCAL_SETTING_OBJ_KEYS.FONT_SIZE_LEVEL]=e,t.save()},restoreFontSizeLevel:function(){var e=A.default.getLocalSettingOperator().getValueWithType(I.LOCAL_SETTING_OBJ_KEYS.FONT_SIZE_LEVEL,"number");null!=e&&1<=e&&e<=5&&(this.fontSizeLevel=e)},showReviewDetailPanel:function(e){var n=this,t=ee.default.union.apply(ee.default,(0,k.default)(e.map(function(e){return e.range}))),r=this.findObjsInOffsetRange(ve,t.start,t.end);this.highLightObjs(r),this.$showReviewDetailPanel({parentNode:this.$refs.appContent,reviewNotes:e,onHide:function(){n.clearHighLight()},onClickItem:function(e,t){switch(e){case"delete":return n.$store.dispatch(v.FETCH_BOOK_REVIEW_DELETE,{reviewId:t.reviewId}).then(function(e){e&&e.data&&1===e.data.succ?(n.$toast("删除成功"),n.hideReviewDetailPanel(),n.syncMyNote({bookmark:"",review:"append"})):n.$toast("删除失败，请重试")})}}})},hideReviewDetailPanel:function(){this.$hideReviewDetailPanel()},showWriteReviewPanel:function(r){var o=this;this.hasLogin&&(this.highLightObjs(r),this.$showReaderWriteReviewPanel({parentNode:this.$refs.appContent,curUser:this.user,bookInfo:this.bookInfo,beforeSubmitCallback:function(){o.$toast("发表中...",36e4)},submitCallback:function(e){var t=e.content,n=e.isPrivate;o.$readerWriteReviewPanel.getIsSending()||(o.$readerWriteReviewPanel.setIsSending(!0),o.$readerWriteReviewPanel.setIsSendedSucc(!0),o.$store.dispatch(v.FETCH_BOOK_REVIEW_ADD,{type:re.ReviewTypeDiscuss,bookId:o.bookId,chapterUid:o.currentChapter.chapterUid,range:o.getRangeFromObjs(r).toString(),content:t,abstract:o.getTextFromObjs(r),isPrivate:n}).then(function(e){var t=ce.get(e,"data.reviewId","");t&&0<t.length?(o.$hideToast(),o.$toast("发表成功"),o.$readerWriteReviewPanel.hide(),o.$readerWriteReviewPanel.setIsSending(!1),o.syncMyNote({bookmark:"",review:"append"}),o.reportClientBusiness({itemName:"Web_WriteReview_Succ"})):(o.$hideToast(),o.$toast("发表失败，请重试"))}).catch(function(e){o.$hideToast(),o.$toast("发表失败，请重试"),o.$readerWriteReviewPanel.setIsSending(!1),console.log("[zhoonlog] err = "+e)}))},onHide:function(){o.clearHighLight()}}))}},watch:{isInShelf:function(e){this.hasLogin&&e&&this.$store.dispatch(v.UPDATE_READER_LOCAL_LAST_CHAPTER)},currentChapter:function(){se.isEnvClient&&(this.requestMemberCardPriceIfNeeded(),this.isCurrentChapterTheFirst&&(this.reportClientBusiness({itemName:"Web_Reader_FirstPage"}),this.showFirstPageAddShelfButton&&this.reportClientBusiness({itemName:"Web_Reader_FirstPage_AddExp"})))},isShowAutoSearchHint:function(e){se.isEnvClient&&(e?this.reportClientBusiness({itemName:"Web_Search_ReaderContentExp"}):this.reportClientBusiness({itemName:"Web_Search_ReaderContentClk"}))},memberCardSummary:function(){se.isEnvClient&&this.checkIfShowMemberCardFreeReadingTips()},isWhiteTheme:function(){this.clearDrawTexts(),this.drawSomeTexts()}},computed:(0,r.default)({displayTopTotalReviewList:function(){var e=this.topFriendReviewList.concat(this.topReviewList);return e&&3<e.length?e.slice(0,3):e}},(0,a.mapState)({bookId:function(e){return e[de].bookId},isBookInfoError:function(e){return e[de].isBookInfoError},bookInfo:function(e){return e[de].bookInfo},isInShelf:function(e){return e[de].isInShelf},memberCardSummary:function(e){return e[de].memberCardSummary},infiniteInfo:function(e){return e[de].infiniteInfo},readingStat:function(e){return e[de].readingStat},chapterInfos:function(e){return e[de].chapterInfos},progress:function(e){return e[de].progress},currentChapter:function(e){return e[de].currentChapter},chapterContentHtml:function(e){return e[de].chapterContentHtml},chapterContentStyles:function(e){return e[de].chapterContentStyles},chapterContentTargetHtml:function(e){return e[de].chapterContentTargetHtml},chapterContentTargetCanvasHtml:function(e){return e[de].chapterContentTargetCanvasHtml},chapterContentState:function(e){return e[de].chapterContentState},isChapterContentDirty:function(e){return e[de].isChapterContentDirty},isInSearchMode:function(e){return e[de].isInSearchMode},isShowAutoSearchHint:function(e){return e[de].isShowAutoSearchHint},isSearchLoading:function(e){return e[de].isSearchLoading},searchResult:function(e){return e[de].searchResult},balance:function(e){return e[de].balance},topReviewList:function(e){return e[fe].topReviews.reviewList},topFriendReviewList:function(e){return e[fe].topFriendReviews.reviewList},bookmarks:function(e){return e[fe].bookmarks}}),(0,a.mapGetters)(["getChapterWithIdxOffset","hasPrevChapter","hasNextChapter","isCurrentChapterTheFirst","chapterTitleText","isBlackUser","isNeedPay","isNeedPayWithoutMemberCard","notes"]),{isShowBuyMemberCardButton:function(){return this.hasLogin&&this.isNeedPay&&!this.isPhone&&!this.canReceiveMemberCard&&!this.isBlackUser&&!this.hasMemberCard&&!this.isSoldOut},isShowLoading:function(){var e=this.chapterContentState;return"LOADING"===e||"PRERENDER"===e},isShowPreRender:function(){return"PRERENDER"===this.chapterContentState},isShowRenderTarget:function(){return"DONE"===this.chapterContentState},isShowError:function(){return"ERROR"===this.chapterContentState},chapterContentForEPub:function(){return this.chapterContentHtml},isShowReaderTopBar:function(){return!this.isCurrentChapterTheFirst},isEpub:function(){return l.default.isEPub(this.bookInfo)},isSoldOut:function(){return l.default.isSoldOut(this.bookInfo)},isSoldOutForbiddenRead:function(){if(this.isSoldOut){if(this.hasLogin){if(l.default.isBuyUnitWholeBook(this.bookInfo))return!(1===this.bookInfo.paid);for(var e=!1,t=0,n=this.chapterInfos.length;t<n;t++){if(1===this.chapterInfos[t].paid){e=!0;break}}return!e}return!0}return!1},isShowTopBarAddShelfButton:function(){return!this.hasLogin||!this.isInShelf},showFirstPageAddShelfButton:function(){return!this.hasLogin||!this.isInShelf},showBottomBarAddShelfButton:function(){return!this.hasLogin||!this.isInShelf},hasCurrentChapter:function(){return this.currentChapter&&0<(0,u.default)(this.currentChapter).length},needReportReadingProgress:function(){return se.isEnvClient&&this.hasLogin},hasMemberCard:function(){return s.default.isMemberShipValid(this.memberCardSummary)},hasMemberCardDiscount:function(){return this.hasMemberCard&&0<ce.get(this.bookInfo,"mcardDiscount",0)},canReceiveMemberCard:function(){return s.default.canReceiveMemberCard(this.infiniteInfo)},payButtonDisplayInfos:function(){var e=!1,t=[];if(l.default.isBuyUnitWholeBook(this.bookInfo))if(l.default.isLimitFree(this.bookInfo)){var n=ce.get(this.bookInfo,"price",0);t.push('限时免费 <span class="lineThrough">'+n.toFixed(2)+"</span>")}else if(l.default.isFree(this.bookInfo))t.push("免费获取");else if(this.hasMemberCardDiscount){var r=ce.get(this.bookInfo,"price",0),o=r*(100-ce.get(this.bookInfo,"mcardDiscount",0))/100;t.push("无限卡 · 购买本书 "+o.toFixed(2)),t.push(' 原价 <span class="lineThrough">'+r.toFixed(2)+"</span>"),e=!0}else{var i=ce.get(this.bookInfo,"price",0);t.push("购买本书 "+i.toFixed(2))}else if(this.hasMemberCardDiscount){var a=ce.get(this.currentChapter,"price",0),s=a*(100-ce.get(this.bookInfo,"mcardDiscount",0))/100;t.push("无限卡 · 购买本章 "+s.toFixed(2)),t.push(' 原价 <span class="lineThrough">'+a.toFixed(2)+"</span>"),e=!0}else{var c=ce.get(this.currentChapter,"price",0);t.push("购买本章 "+c.toFixed(2))}return{isMCard:e,lines:t}},endingTexts:function(){var e=this.bookInfo;if(1===e.finished)return["全书完"];var t=["未完待续"];if(l.default.isBuyUnitChapter(e)){var n=e.updateTime;if(n){var r=new Date(1e3*n),o=_.default.formatTime(r);t.push("已阅读至最新章节 · 最近更新于 "+o)}}return t},isNeedShowLoginGuide:function(){return this.isNeedPay&&!this.hasLogin&&!this.isPhone},isNeedShowPhoneDownloadGuide:function(){return this.isPhone},isNeedShowMyNote:function(){return this.hasLogin},notesListInCurrentChapter:function(){var e=this.currentChapter;if(!e)return[];var t=this.notes;if(t.isFetching||0===t.noteList.length)return[];var n=e.chapterUid,r=t.noteList,o=[];return r.forEach(function(e){e.chapterUid===n&&o.push(e)}),o},underlineRenderDatas:function(){var n=this;if(-1===this.renderContentsVersion)return[];if(!this.isNeedShowMyNote||0===ve.length)return[];var i=[],e=this.notesListInCurrentChapter,t=[],r=[];e.forEach(function(o){if(o.noteType!==Z.NoteTypeReview){if(o.noteType===Z.NoteTypeBookmark&&o.type===Q.BookMarkTypeUnderline){r.push(o);var e=n.findObjsInOffsetRange(ve,o.range.start,o.range.end);n.getRectsByContentObjs(e).forEach(function(e,t){var n={key:o.key+"_"+t,notes:[o],range:o.range,rect:e,classNames:["wr_underline","s"+o.style]};if(1===o.style){var r=parseInt(e.y)%3;n.classNames.push("bg"+r)}i.push(n)})}}else t.push(o)});var a=[];return t.forEach(function(e){for(var t=e.range,n=null,r=0,o=a.length;r<o;r++){var i=a[r];if(ee.default.isIntersection(i.mergedRange,t)){n=i;break}}n?(n.mergedRange=ee.default.union(n.mergedRange,t),n.notes.push(e)):a.push({mergedRange:t,notes:[e]})}),a.forEach(function(o){var e=[o.mergedRange];r.forEach(function(n){var r=[];e.forEach(function(e){var t=e.splitBy(n.range);r=r.concat(t)}),e=r}),e.forEach(function(e,r){var t=n.findObjsInOffsetRange(ve,e.start,e.end);n.getRectsByContentObjs(t).forEach(function(e,t){var n={key:o.notes[0].key+"_"+r+"_"+t,notes:o.notes,range:o.mergedRange,rect:e,classNames:["wr_myNote"]};i.push(n)})})}),i}})}},572:function(e,t,n){"use strict";n.r(t);var r=n(573),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},573:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"CustomStyle.vue"}},574:function(e,t,n){"use strict";n.r(t);var r=n(575),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},575:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(722),i=(r=o)&&r.__esModule?r:{default:r};t.default={name:"ReaderControls",components:{VueSlider:i.default},props:{disableChapterLink:{type:Boolean,required:!1,default:!1},isShowSearchHint:{type:Boolean,required:!1,default:!1},searchHintTotalCount:{type:Number,required:!1,default:0},disableFontSizeSlider:{type:Boolean,required:!1,default:!1},fontSizeLevelCount:{type:Number,required:!0},initFontSizeLevel:{type:Number,required:!0}},data:function(){return{isFontSizeExpand:!1,fontSizeLevels:function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=n+1;return t}(this.fontSizeLevelCount),fontSizeLevel:this.initFontSizeLevel}},computed:{searchHint:function(){return this.isShowSearchHint?["搜索结果",this.searchHintTotalCount?"共"+this.searchHintTotalCount+"条":""].filter(function(e){return e}).join(" · "):""}},methods:{emitClick:function(e){if("catalog"===e&&this.disableChapterLink)return!1;this.$emit("onClickItem",e)},emitFontSizeLevelChange:function(){var e=this,t=this.$refs.fontSizeSlider.getValue();setTimeout(function(){e.$emit("fontSizeLevelChange",t)},0)},toggleFontSizeExpand:function(){this.isFontSizeExpand=!this.isFontSizeExpand},hideFontSizePanel:function(){this.isFontSizeExpand&&(this.isFontSizeExpand=!1)},isFontSizePanelShowing:function(){return this.isFontSizeExpand}}}},576:function(e,t,n){},577:function(e,t,n){"use strict";n.r(t);var r=n(578),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},578:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=s(n(516)),r=s(n(62)),o=s(n(278)),i=s(n(522)),u=s(n(43)),a=s(n(44)),d=s(n(192));function s(e){return e&&e.__esModule?e:{default:e}}var h=n(22);t.default={name:"ReaderBookInfo",components:{Dialog:a.default,BookCover:o.default,RankBar:i.default},props:{bookInfo:{type:Object,required:!0},chapterInfos:{type:Array,required:!0},readingStat:{type:Object,required:!0},showAddShelfButton:{type:Boolean,required:!1,default:!1}},computed:{isEmptyBookInfo:function(){return!this.bookInfo||0===(0,r.default)(this.bookInfo).length},isSupportBook:function(){return d.default.isSupportedBookType(this.bookInfo.type)},canShowDownloadButton:function(){return!d.default.isSupportedBookType(this.bookInfo.type)||this.isPhone&&this.isFromWeReadApp},needShowRankListImg:function(){return 0<this.rankListCategoryId.length&&0<this.rankListCategoryClassName.length},rankListCategoryId:function(){return h.get(this.bookInfo,"ranklist.categoryId","")},rankListCategoryClassName:function(){var e=this.rankListCategoryId;return-1!==["all","rising","newbook","novel","novel_male","novel_female"].indexOf(e)?"rankList_"+(h.startsWith(e,"novel")?"novel":e):""},introParaArray:function(){var e=this.bookInfo.lPushName||"",t=this.bookInfo.intro||"";return[e.trim(),t.trim()].filter(function(e){return 0<e.length})},moreChildCount:function(){var e=0;return this.showRating&&e++,this.readingCount&&e++,++e},showRating:function(){return 0<this.bookInfo.ratingCount&&0<this.starScore},ratingCountString:function(){var e=this.bookInfo.ratingCount||0,t=u.default.formatNumber(e);return t.number+t.unit},starScore:function(){return this.bookInfo.star||0},starString:function(){return(this.starScore/10).toFixed(1)},readingCount:function(){return this.readingStat.readingCount||0},readingCountStrings:function(){if(0<this.readingCount){var e=this.readingStat.readingUsers||[],t=u.default.formatNumber(this.readingCount),n='<span class="bookInfo_more_line1_number">'+t.number+"</span>"+t.unit+(0<e.length?"人阅读":"人"),r=null;if(0<e.length){for(var o=0;o<e.length;o++){var i=e[o].name||"";if(9<(r=null===r?i:r+"、"+i).length){r=r.slice(0,10);break}}0<r.length&&(r+="等好友在读")}else r="阅读此书";return[n,r]}return["",""]},chaptersToPreview:function(){var i=this,e=this.chapterInfos;if(!e||0===e.length)return[];var t=d.default.isBuyUnitChapter(this.bookInfo)&&2===h.get(this.bookInfo,"ispub");if(!t)return[];function a(e){return"第"+e.chapterIdx+"章"}function s(e){return(e.title||"").substr(0,10)}if(t){var n=Math.max(0,e.length-3),r=n+3,o=e.slice(n,r).reverse(),c=!0;return o.map(function(e){var t=1e3*h.get(e,"updateTime",0),n=(new Date).getTime()-2592e6<t,r={line1:"",line2:"",isLine2Blue:!1,isLine2Title:!1,link:i.readerURL(i.bookInfo.bookId,{chapterUid:e.chapterUid})};if(n){if(r.line1=a(e)+" "+s(e),r.line2=u.default.formatTime(new Date(t),{useYearMonthDateChar:!0,showTimeWhenShowDate:!1})+" · 已更新",c){var o=new Date;o.setHours(0,0,0,0),r.isLine2Blue=t>=o.getTime()}r.isLine2Blue||(c=!1)}else r.line1=a(e),r.line2=s(e),r.isLine2Title=!0;return r})}},publishInfos:function(){var e=[];if(this.bookInfo.publisher&&e.push({title:"出版社",content:this.bookInfo.publisher,needConsiderLong:!0}),this.bookInfo.publishTime)try{var t=this.bookInfo.publishTime.split(" "),n=new Date(t[0]);e.push({title:"出版时间",content:n.getFullYear()+"年"+(n.getMonth()+1)+"月",needConsiderLong:!1})}catch(e){}return this.bookInfo.ISBN&&e.push({title:"ISBN",content:this.bookInfo.ISBN,needConsiderLong:!1}),this.bookInfo.totalWords&&e.push({title:"字数",content:this.bookInfo.totalWords.toLocaleString("en-US"),needConsiderLong:!1}),this.bookInfo.category&&e.push({title:"分类",content:this.bookInfo.category,needConsiderLong:!0}),e},isPublishInfoLong:function(){var e=this.publishInfos,t=!0,n=!1,r=void 0;try{for(var o,i=(0,l.default)(e);!(t=(o=i.next()).done);t=!0){var a=o.value,s=a.needConsiderLong,c=a.content;if(s&&11<c.length)return!0}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}return!1}},mounted:function(){var e=this.$refs.introDom;e&&(e.scrollHeight>e.offsetHeight?e.classList.add("hasMore"):e.classList.remove("hasMore"))},methods:{emitClickAddShelf:function(){this.$emit("clickAddShelf")},showIntroDialog:function(){this.$refs.introDialog.showDialog()},emitClickShowCatalog:function(){this.$emit("clickShowCatalog")},emitDownloadApp:function(){this.$emit("clickDownloadApp")},emitClickRatingButton:function(){this.$emit("clickRatingButton")},emitClickStartReading:function(){this.$emit("clickStartReading")}}}},579:function(e,t,n){},580:function(e,t,n){"use strict";n.r(t);var r=n(581),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},581:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=p(n(132)),r=p(n(192)),o=p(n(525)),i=p(n(278)),a=p(n(678)),c=p(n(283)),l=p(n(679)),u=p(n(9)),d=p(n(43)),h=p(n(680)),f=p(n(681));function p(e){return e&&e.__esModule?e:{default:e}}var g=n(284),v=n(682),m=n(22);t.default={name:"ReaderCatalog",components:{ReaderPanelListLoadingView:f.default,ReaderPanelListEmptyView:h.default,ReaderPanelSectionListItem:l.default,BackgroundMask:c.default,ReaderCatalogBookInfo:a.default,BookCover:i.default},props:{bookInfo:{type:Object,required:!0},memberCardSummary:{type:Object,required:!1},chapterInfos:{type:Array,required:!0},currentChapter:{type:Object,required:!0},currentChapterAnchor:{type:String,required:!1,default:""},isSearchLoading:{type:Boolean,required:!1,default:!1},isInSearchMode:{type:Boolean,required:!1,default:!1},searchResult:{type:Object,required:!1}},data:function(){return{isShow:!1,isScrollToBottom:!0,searchKeyword:"",searchXSS:void 0}},watch:{isInSearchMode:function(e){var t=this;if(e&&u.default.isEnvClient){var n=this;this.$nextTick(function(){var e=t.$refs.searchResultDom;e&&!e.addedScrollEvent&&(e.addedScrollEvent=1,d.default.handleElementScrollEvent(e,function(){n.emitSearchLoadMore()}))})}}},computed:{chapterIndexes:function(){var i=this,a=[],t=this.currentChapter?this.currentChapter.chapterUid:-1;return this.chapterInfos.forEach(function(n){var e=(0,s.default)({},n,{isCurrent:!1});a.push(e);var r=t===n.chapterUid,o=!1;n.anchors&&0<n.anchors.length&&n.anchors.forEach(function(e){var t=(0,s.default)({},n,{anchors:[]},e);r&&t.anchor===i.currentChapterAnchor&&(t.isCurrent=!0,o=!0),a.push(t)}),r&&!o&&(e.isCurrent=!0)}),a},isEpub:function(){return r.default.isEPub(this.bookInfo)},needShowScroller:function(){return this.chapterIndexes&&50<this.chapterIndexes.length},isSearchResultHasMore:function(){return m.get(this.searchResult,"hasMore",!1)}},created:function(){this.debouncedDoSearch=m.debounce(this.emitSearch,500)},methods:{setSearchKeyword:function(e){this.searchKeyword=e},show:function(){this.$refs.mask.showMask(),this.isShow=!0},close:function(){this.$refs.mask.closeMask(),this.isShow=!1},isShowing:function(){return this.isShow},toggle:function(){this.isShow?this.close():this.show()},getChapterTitle:function(e){return o.default.getChapterTitle(e,this.isEpub)},isLock:function(e){return o.default.isChapterNeedPay({bookInfo:this.bookInfo,memberCardSummary:this.memberCardSummary,chapter:e})},onShow:function(){this.scrollToCurrent(),this.searchResult.isNeedAutoSearchWhenShow&&this.emitAutoSearch()},scrollToCurrent:function(){var e=this.$refs.catalogListDom;if(e){var t=e.querySelector(".chapterItem_current");if(t){var n=t.parentNode;e.scrollTop=t.offsetTop-n.offsetTop}}},scrollToBottom:function(){var e=this.$refs.catalogListDom;if(e){var t=e.lastChild;t&&v.scrollTo(t,300,{container:e,x:!1,y:!0,offset:0})}},scrollToTop:function(){var e=this.$refs.catalogListDom;if(e){var t=e.firstChild;t&&v.scrollTo(t,300,{container:e,x:!1,y:!0,offset:0})}},handleClickScroller:function(){this.isScrollToBottom?this.scrollToBottom():this.scrollToTop(),this.isScrollToBottom=!this.isScrollToBottom},handleClickBookInfo:function(){this.$emit("clickBookInfo")},handleClickChapter:function(e){this.$emit("clickChapter",e)},getSearchResultChapterTitle:function(e){for(var t=this.chapterInfos,n=e.chapterUid,r=void 0,o=0,i=t.length;o<i;o++)if(t[o].chapterUid===n){r=t[o];break}var a="";return r&&(a=this.getChapterTitle(r)),a.trim()},getSearchResultChapterContent:function(e){var t=e.abstract||"",n=m.get(e,"keyword",[]);if(0<n.length){var r=new RegExp(n.map(function(e){return e.replace(d.default.getRegExpKeyWordReExp(),"\\$&")}).join("|"),"gi");t=t.replace(r,'<span class="highLight">$&</span>')}return t=t.trim(),this.getSearchXSS().process(t)},getSearchXSS:function(){return this.searchXSS||(this.searchXSS=new g.FilterXSS({whiteList:{span:["class"]}})),this.searchXSS},emitSearch:function(){this.searchKeyword.length<=0||0<m.get(this.searchResult,"resultList",[]).length&&this.searchResult.keyword===this.searchKeyword||this.$emit("search",{keyword:this.searchKeyword})},emitSearchLoadMore:function(){if(this.isSearchResultHasMore&&!this.isSearchLoading){var e=this.searchResult.keyword;if(!(e<=0)){var t=0,n=m.get(this.searchResult,"resultList",[]);0<n.length&&(t=m.get(m.last(n),"searchIdx",0)),this.$emit("search",{keyword:e,maxIdx:t,isLoadMore:!0})}}},emitAutoSearch:function(){this.searchKeyword.length<=0||this.$emit("search",{keyword:this.searchKeyword})},emitClickSearchItem:function(e){this.$emit("clickSearchItem",e)},handleInputFocused:function(){this.$emit("enterSearch")},exitSearch:function(){this.searchKeyword="",this.$emit("exitSearch")}}}},582:function(e,t,n){"use strict";n.r(t);var r=n(583),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},583:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(43)),o=a(n(192)),i=a(n(278));function a(e){return e&&e.__esModule?e:{default:e}}t.default={name:"ReaderCatalogBookInfo",components:{BookCover:i.default},props:{bookInfo:{type:Object,required:!0}},computed:{needShowUpdateTime:function(){return o.default.isBuyUnitChapter(this.bookInfo)},updateTimeString:function(){if(!this.needShowUpdateTime)return"";if(this.bookInfo.finished)return"已完结";if(this.bookInfo.updateTime){var e=this.bookInfo.updateTime,t=new Date(1e3*e);return"更新于 "+r.default.formatTime(t)}return""}},methods:{emitClickBookInfo:function(){this.$emit("clickBookInfo")}}}},584:function(e,t,n){},585:function(e,t,n){"use strict";n.r(t);var r=n(586),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},586:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"ReaderPanelSectionListItem",props:{showSectionTitle:{type:Boolean,default:!1},sectionTitle:{type:String,default:""},dividerLeftIndent:{type:Boolean,default:!1},customContentClass:{type:String,default:""}},methods:{emitClickItem:function(){this.$emit("clickItem")}}}},587:function(e,t,n){},588:function(e,t,n){"use strict";n.r(t);var r=n(589),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},589:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"ReaderPanelListEmptyView"}},590:function(e,t,n){},591:function(e,t,n){"use strict";n.r(t);var r=n(592),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},592:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(135),i=(r=o)&&r.__esModule?r:{default:r};t.default={name:"ReaderPanelListLoadingView",components:{Loading:i.default}}},593:function(e,t,n){},594:function(e,t,n){},595:function(e,t,n){"use strict";n.r(t);var r=n(596),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},596:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(281)),o=i(n(282)),s=i(n(192));function i(e){return e&&e.__esModule?e:{default:e}}var c=n(22);t.default={name:"ReaderTopBar",components:{Avatar:r.default,Menu:o.default},props:{bookInfo:{type:Object,required:!0},currentChapter:{type:Object,required:!0},currentChapterAnchor:{type:String,required:!1,default:""},isShowAddShelf:{type:Boolean,required:!0},shelfBookCount:{type:Number,default:0}},computed:{bookTitleString:function(){return c.get(this.bookInfo,"title","")+" "},chapterTitleString:function(){var e=this.currentChapter,t=this.currentChapterAnchor;if(""!==t)for(var n=e.anchors,r=0,o=n.length;r<o;r++){var i=n[r];if(i.anchor===t)return i.title}var a=c.get(e,"title","");return[s.default.isEPub(this.bookInfo)?"":"第"+c.get(e,"chapterIdx","")+"章",a].join(" ")},avatarOptionList:function(){return this.isWeiXin?["我的书架"+(this.shelfBookCount?" · "+this.shelfBookCount:"")]:["我的书架"+(this.shelfBookCount?" · "+this.shelfBookCount:""),"退出登录"]},canShowLogin:function(){return!this.hasLogin&&!this.isPhone}},methods:{handleHideMenu:function(){var e=this.$refs.topBar_avatarMenu;e&&e.hideMenu()},isMenuShowing:function(){var e=this.$refs.topBar_avatarMenu;return!!e&&e.menuShowing},emitClickItem:function(e){this.$emit("onClickItem",e)},handleClickAvatarMenuOption:function(e){switch(e.index){case 0:this.emitClickItem("gotoShelf");break;case 1:this.emitClickItem("logout")}},handleClickAvatar:function(){this.$refs.topBar_avatarMenu.showMenu()}}}},597:function(e,t,n){},598:function(e,t,n){"use strict";n.r(t);var r=n(599),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},599:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"ReaderBottomBar",props:{showShadow:{type:Boolean,required:!1,default:!0},showAddShelfButton:{type:Boolean,required:!1,default:!1}},methods:{emitClick:function(e){this.$emit("onClickItem",e)}}}},600:function(e,t,n){},601:function(e,t,n){"use strict";n.r(t);var r=n(602),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},602:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(20),i=(r=o)&&r.__esModule?r:{default:r};t.default={name:"ReaderBottomSettingPanel",props:{},computed:{canShowDownload:function(){return(new i.default).isPhone()}},methods:{emitClick:function(e){this.$emit("onClickItem",e)}}}},603:function(e,t,n){},604:function(e,t,n){"use strict";n.r(t);var r=n(605),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},605:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(192)),a=o(n(517)),r=o(n(44));function o(e){return e&&e.__esModule?e:{default:e}}var s=n(22);t.default={name:"PayWholeBookDialog",components:{Dialog:r.default},props:{bookInfo:{type:Object,required:!0},memberCardSummary:{type:Object,required:!1},balance:{type:Object,required:!1}},data:function(){return{}},computed:{payInfos:function(){var e={dialogPriceText:"",dialogAccountBalance:"",dialogBuyButtonText:"",isNeedDeposit:!1},t=this.balance,n=t.iOS>t.Android?t.iOS:t.Android;if(t.hasFetched?e.dialogAccountBalance="余额 "+Math.max(0,n).toFixed(2):e.dialogAccountBalance=" ",i.default.isLimitFree(this.bookInfo))e.dialogPriceText="限时免费",e.dialogBuyButtonText="获 取";else if(i.default.isFree(this.bookInfo))e.dialogPriceText="免费",e.dialogBuyButtonText="获 取";else if(a.default.isMemberShipValid(this.memberCardSummary)&&0<s.get(this.bookInfo,"mcardDiscount",0)){var r=(i.default.isBuyUnitWholeBook(this.bookInfo)?s.get(this.bookInfo,"price",0):s.get(this.currentChapter,"price",0))*(100-s.get(this.bookInfo,"mcardDiscount",0))/100;e.dialogPriceText=r.toFixed(2),e.isNeedDeposit=n<r,e.dialogBuyButtonText=e.isNeedDeposit?"去微信读书 App 充值":"购 买"}else{var o=i.default.isBuyUnitWholeBook(this.bookInfo)?s.get(this.bookInfo,"price",0):s.get(this.currentChapter,"price",0);e.dialogPriceText=o.toFixed(2),e.isNeedDeposit=n<o,e.dialogBuyButtonText=e.isNeedDeposit?"去微信读书 App 充值":"购 买"}return e}},methods:{showDialog:function(){this.$refs.dialog.showDialog()},closeDialog:function(){this.$refs.dialog.closeDialog()},emitDoPay:function(){this.$emit("doPay")}}}},606:function(e,t,n){},607:function(e,t,n){"use strict";n.r(t);var r=n(608),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},608:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(279)),o=a(n(517)),i=a(n(44));function a(e){return e&&e.__esModule?e:{default:e}}var s=n(22);t.default={name:"PayChapterDialog",components:{Dialog:i.default},props:{bookInfo:{type:Object,required:!0},chapters:{type:Array,required:!0},memberCardSummary:{type:Object,required:!1},balance:{type:Object,required:!1}},data:function(){return{initSelectedChapterUid:-1,isAutoPay:1===s.get(this.bookInfo,"isAutoPay",0),sections:this.splitChaptersToSection(this.chapters)}},computed:{accountBalance:function(){var e=this.balance.iOS>this.balance.Android?this.balance.iOS:this.balance.Android;return Math.max(0,e)},isSelectedAll:function(){var t=this;return this.sections.every(function(e){return t.isSectionSelectedAll(e)})},selectedChaptersSize:function(){return s.sumBy(this.sections,function(e){return e.selected.length})},selectedChaptersPrice:function(){var n=0;return this.sections.forEach(function(e){var t=e.selected;e.chapters.forEach(function(e){-1!==t.indexOf(e.chapterUid)&&(n+=e.price)})}),n},selectedChaptersPriceWithDiscount:function(){var e=this.selectedChaptersPrice;this.hasMCardDiscount&&(e=e*(100-s.get(this.bookInfo,"mcardDiscount",0))/100);return e},hasMCardDiscount:function(){return o.default.isMemberShipValid(this.memberCardSummary)&&0<s.get(this.bookInfo,"mcardDiscount",0)},priceTitleWithMCardDiscount:function(){if(this.hasMCardDiscount){var e=s.get(this.bookInfo,"mcardDiscount",0);return"总价 · 无限卡"+o.default.discountToChinese(e)}return"总价"},isValid:function(){for(var e=0;e<this.sections.length;e++){if(0<this.sections[e].selected.length)return!0}return!1},isNeedDeposit:function(){return this.balance.hasFetched&&this.accountBalance<this.selectedChaptersPriceWithDiscount}},watch:{chapters:function(e){this.sections=this.splitChaptersToSection(e)}},methods:{showDialog:function(e){var n=this;this.initSelectedChapterUid=e,this.sections.forEach(function(t){t.selected.length=0,t.isExpand=!1,t.chapters.forEach(function(e){n.initSelectedChapterUid===e.chapterUid&&0<e.price&&1!==e.paid&&(t.selected.push(e.chapterUid),t.isExpand=!0)})}),this.$refs.dialog.showDialog()},closeDialog:function(){this.$refs.dialog.closeDialog()},onShow:function(){var e=this;this.$nextTick(function(){e.scrollToCurrent()})},scrollToCurrent:function(){var e=this.$refs.scrollDom;if(e){var t=document.getElementById("pcd_chapter_current");t&&(e.scrollTop=t.offsetTop)}},emitDoPay:function(){var e=Math.round(100*this.selectedChaptersPriceWithDiscount)/100,t={chapterIds:this.sortedSelectedChapterIds(),totalPrice:e,isAutoPay:this.isAutoPay};this.$emit("doPay",t)},splitChaptersToSection:function(c){for(var l=this,u=[],e=function(e,t){var n=c.slice(e,e+20),r=0,o=0,i=!0,a=[];n.forEach(function(e){r+=e.price,o+=1===e.paid?0:e.price,0<e.price&&1!==e.paid&&(i=!1),l.initSelectedChapterUid===e.chapterUid&&0<e.price&&1!==e.paid&&a.push(e.chapterUid)});var s=0<a.length;n.length&&u.push({key:n[0].chapterIdx,chapters:n,title:"第"+n[0].chapterIdx+"-"+n[n.length-1].chapterIdx+"章",isAllPaid:i,unpaidPrice:o,totalPrice:r,isExpand:s,selected:a})},t=0,n=c.length;t<n;t+=20)e(t);return u},sortedSelectedChapterIds:function(){var t=[];return this.sections.forEach(function(e){0<e.selected.length&&t.push.apply(t,(0,r.default)(e.selected))}),t.sort(),t},toggleSectionExpand:function(e){e.isExpand=!e.isExpand},changeTitleChecked:function(e,t){var n=t.target.checked;this.selectSection(e,n)},selectSection:function(t,e){var n=this;e?t.chapters.forEach(function(e){n.canChapterSelect(e)&&-1===t.selected.indexOf(e.chapterUid)&&t.selected.push(e.chapterUid)}):t.selected=[]},canChapterSelect:function(e){return 0<e.price&&1!==e.paid},isTitleChecked:function(e){return this.isSectionSelectedAll(e)},isSectionSelectedAll:function(t){return t.chapters.every(function(e){return 0===e.price||1===e.paid||-1!==t.selected.indexOf(e.chapterUid)})},toggleSection:function(e){var t=!this.isSectionSelectedAll(e);this.selectSection(e,t)},toggleChapter:function(e,t){if(this.canChapterSelect(t)){var n=e.selected.indexOf(t.chapterUid);-1===n?e.selected.push(t.chapterUid):e.selected.splice(n,1)}},toggleAllSelect:function(){var t=this,n=!this.isSelectedAll;this.sections.forEach(function(e){t.selectSection(e,n)})}}}},609:function(e,t,n){},610:function(e,t,n){"use strict";n.r(t);var r=n(611),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},611:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(135),i=(r=o)&&r.__esModule?r:{default:r};t.default={name:"ReaderLoginGuide",components:{Loading:i.default},props:{qrCodeImg:{type:String},getUidErr:{type:Boolean},getInfoErr:{type:Boolean},loadingQRCode:{type:Boolean}},methods:{emitReload:function(){this.$emit("reload")}}}},612:function(e,t,n){},613:function(e,t,n){"use strict";n.r(t);var r=n(614),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},614:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"FooterNote.vue",props:{text:{type:String,default:""}},data:function(){return{showing:!1,customStyle:""}},methods:{getOffset:function(e){for(var t=e.offsetTop,n=e.offsetLeft,r=e.offsetWidth,o=e.offsetHeight;e.offsetParent;)t+=(e=e.offsetParent).offsetTop,n+=e.offsetLeft;return{top:t,left:n,width:r,height:o}},show:function(e){var t=0<arguments.length&&void 0!==e?e:{};if(!this.showing){var s=this;this.showing=!0,this.text=t.text||"";var n=t.node||{},c=this.getOffset(n);this.$nextTick(function(){var e=s.$refs.footerNote_bubble,t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,n=window.innerHeight||Math.min(document.documentElement.clientHeight,document.body.clientHeight);if(c.top-t<n/2){this.$refs.footerNote_container.classList.add("reader_footerNote_container_Top");var r=c.left-e.offsetWidth/2+c.width/2,o=c.top+c.height+12;s.customStyle="left:"+r+"px;top:"+o+"px;"}else{this.$refs.footerNote_container.classList.remove("reader_footerNote_container_Top");var i=c.left-e.offsetWidth/2+c.width/2,a=c.top-e.offsetHeight-12;s.customStyle="left:"+i+"px;top:"+a+"px;"}})}},hide:function(){this.showing&&(this.showing=!1)},handleMaskClick:function(){this.hide()}}}},615:function(e,t,n){},616:function(e,t,n){"use strict";n.r(t);var r=n(617),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},617:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(44),i=(r=o)&&r.__esModule?r:{default:r};var a=n(138);t.default={name:"ReceiveMCardSuccessDialog",components:{Dialog:i.default},props:{},data:function(){return{day:0,qrCodeImg:""}},computed:{titleText:function(){return 0<this.day?"你已领取"+this.day+"天无限卡":"成功领取无限卡"}},methods:{beginToLoadQrCode:function(){this.reportClientBusiness({itemName:"Web_Download_GiftExp"});var e=a.generateDownloadAppURL({from:"ReceiveMemberCard"});this.qrCodeImg=n(66).getQrBase64(e,{padding:16,width:206,height:206,correctLevel:QRErrorCorrectLevel.H,background:"#FFF",foreground:"#000"})},showDialog:function(e){this.day=e&&e.day?e.day:0,this.$refs.dialog.showDialog()},closeDialog:function(){this.$refs.dialog.closeDialog()}}}},618:function(e,t,n){},632:function(e,t,n){"use strict";n.r(t);var r=n(633),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},633:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"ReaderSelectionToolBar",data:function(){return{isBelow:!1,showing:!1,posStyle:"",arrowStyle:"",onClickToolBarItem:null,existBookmark:null,canCopy:!1}},computed:{showItems:function(){var e=this.existBookmark,t=[];return this.canCopy&&t.push({key:"copy",classNames:["copy"],text:"复制",type:"copy",requireLogin:!1}),t.push({key:"underline1",classNames:["underlineBg",e&&1===e.style?"selected":""],text:"马克笔",type:"underline",styleId:1,requireLogin:!0,requireLoginText:"多设备同步划线"}),t.push({key:"underline2",classNames:["underlineHandWrite",e&&2===e.style?"selected":""],text:"波浪线",type:"underline",styleId:2,requireLogin:!0,requireLoginText:"多设备同步划线"}),t.push({key:"underline0",classNames:["underlineStraight",e&&0===e.style?"selected":""],text:"直线",type:"underline",styleId:0,requireLogin:!0,requireLoginText:"多设备同步划线"}),e&&t.push({key:"removeUnderline",classNames:["removeUnderline"],text:"删除划线",type:"removeUnderline",requireLogin:!0,requireLoginText:"多设备同步划线"}),t.push({key:"review",classNames:["review"],text:"写想法",type:"review",requireLogin:!0,requireLoginText:"登录后即可写想法"}),t}},methods:{show:function(e){var t=0<arguments.length&&void 0!==e?e:{};this.onClickToolBarItem=t.onClickToolBarItem,this.existBookmark=t.existBookmark,this.canCopy=t.canCopy;var m=t.toolbarBoundsLimit,_=t.rects;this.showing=!0;var C=this;this.$nextTick(function(){var e=this.$refs.toolbarContainer,t=e.offsetWidth,n=e.offsetHeight+12;function r(e){return e-n>=m.top}var o=!1,i="",a=null,s=0;if(o||r((a=_[0]).y)&&(i="above",s=a.y,o=!0),o||(a=_[_.length-1],a.y+a.h+n<=m.bottom&&(i="below",s=a.y+a.h,o=!0)),!o)for(var c=1;c<_.length;){if(r((a=_[c]).y)){i="above",s=a.y,o=!0;break}c++}if(!o){for(var l={left:Number.MAX_VALUE,top:Number.MAX_VALUE,right:Number.MIN_VALUE,bottom:Number.MIN_VALUE},u=0,d=_.length;u<d;u++){var h=_[u];l.left=Math.min(l.left,h.x),l.top=Math.min(l.top,h.y),l.right=Math.max(l.right,h.x+h.w),l.bottom=Math.max(l.bottom,h.y+h.h)}i="above",s=(l.top+l.bottom)/2,a={x:l.left,y:l.top,w:l.right-l.left,h:l.bottom-l.top}}var f=a.x+a.w/2-t/2,p=Math.max(Math.min(f,m.right-t),m.left),g=f-p-8;f=p;var v=0;switch(i){case"above":v=s-n;break;case"below":v=s+12}C.isBelow="below"===i,C.posStyle="left:"+f+"px;top:"+v+"px;",C.arrowStyle="margin-left:"+g+"px;"})},hide:function(){this.showing=!1},handleClickItem:function(e){return this.onClickToolBarItem&&this.onClickToolBarItem(e)}}}},634:function(e,t,n){},635:function(e,t,n){"use strict";n.r(t);var r=n(636),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},636:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(281),i=(r=o)&&r.__esModule?r:{default:r};t.default={name:"ReaderReviewDetailPanel",components:{Avatar:i.default},data:function(){return{showing:!1,reviewNotes:[],onHide:null,onClickItem:null}},methods:{show:function(e){var t=0<arguments.length&&void 0!==e?e:{};this.reviewNotes=t.reviewNotes||[],this.onHide=t.onHide,this.onClickItem=t.onClickItem,this.showing=!0},hide:function(){this.showing&&(this.showing=!1,this.onHide&&this.onHide())},isShowing:function(){return this.showing},emitClickItem:function(e,t){this.onClickItem&&this.onClickItem(e,t)},reviewContentParagraphs:function(e){return e.showText.split(/\n/)}}}},637:function(e,t,n){},638:function(e,t,n){"use strict";n.r(t);var r=n(639),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},639:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"ReaderMemberCardTips",props:{customSelector:{type:String,required:!1,default:""}},data:function(){return{showing:!1,text:""}},methods:{show:function(e){this.text=e,this.showing=!0},close:function(){this.showing=!1},onShow:function(){var e=this;setTimeout(function(){e.close()},5e3)}}}},640:function(e,t,n){},641:function(e,t,n){"use strict";n.r(t);var r=n(642),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},642:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(624)),o=a(n(281)),i=a(n(522));function a(e){return e&&e.__esModule?e:{default:e}}var s=n(9);t.default={name:"ReaderTopReviews",props:{bookId:{type:String,require:!0},reviewList:{type:Array,require:!0}},components:{ReviewStarControl:r.default,Avatar:o.default,RankBar:i.default},mounted:function(){s.isEnvClient&&this.$nextTick(function(){for(var e=document.querySelectorAll(".reader_topReview_item .content"),t=0;t<e.length;t++){var n=e[t];n&&(n.scrollHeight>n.offsetHeight?n.classList.add("hasMore"):n.classList.remove("hasMore"))}})},methods:{handleBookReviewClick:function(e){var t=e.score;this.$emit("emit-book-review-click",{score:t})},handleContentClick:function(e){var t=document.querySelectorAll(".reader_topReview_item .content");if(t&&0<t.length&&0<=e&&e<=t.length-1){var n=t[e];n&&n.classList.contains("hasMore")&&n.classList.remove("content_Normal")}}}}},643:function(e,t,n){},644:function(e,t,n){"use strict";n.r(t);var r=n(645),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t.default=o.a},645:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(n(192)),o=p(n(525)),i=p(n(278)),a=p(n(678)),s=p(n(283)),c=p(n(135)),l=p(n(679)),u=p(n(680)),d=p(n(681)),h=n(571),f=p(n(522));function p(e){return e&&e.__esModule?e:{default:e}}t.default={name:"ReaderNotePanel",components:{RankBar:f.default,ReaderPanelListLoadingView:d.default,ReaderPanelListEmptyView:u.default,ReaderPanelSectionListItem:l.default,BackgroundMask:s.default,ReaderCatalogBookInfo:a.default,BookCover:i.default,Loading:c.default},props:{bookInfo:{type:Object,required:!0},chapterInfos:{type:Array,required:!0},notes:{type:Object,required:!0}},data:function(){return{isShow:!1}},computed:{noteList:function(){return this.notes.noteList},isLoading:function(){return this.notes.isFetching},isEpub:function(){return r.default.isEPub(this.bookInfo)}},methods:{show:function(){this.$refs.mask.showMask(),this.isShow=!0},close:function(){this.$refs.mask.closeMask(),this.isShow=!1},isShowing:function(){return this.isShow},toggle:function(){this.isShow?this.close():this.show()},onShow:function(){},getNoteItemContentClassNames:function(e){var t="noteItem_content";return e.noteType===h.NoteTypeReview&&(t+=" noteItem_content_review"),t},getChapterTitle:function(e){return o.default.getChapterTitle(e,this.isEpub)},getNoteStar:function(e){return e.star},getNoteItemChapterTitle:function(e){if(e.chapterIdx===h.ChapterIdxRecommend)return"点评";for(var t=e.chapterUid,n=this.chapterInfos,r=void 0,o=0,i=n.length;o<i;o++)if(n[o].chapterUid===t){r=n[o];break}var a="";return r?a=this.getChapterTitle(r):t&&(a="第"+t+"章"),a.trim()},emitClickNoteItem:function(e){this.$emit("clickNoteItem",e)}}}},646:function(e,t,n){},647:function(e,t,n){},678:function(e,t,n){"use strict";n.r(t);var r=n(853),o=n(582);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(727);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},679:function(e,t,n){"use strict";n.r(t);var r=n(852),o=n(585);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(728);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},680:function(e,t,n){"use strict";n.r(t);var r=n(854),o=n(588);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(729);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},681:function(e,t,n){"use strict";n.r(t);var r=n(855),o=n(591);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(730);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},685:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjType=void 0;var r=a(n(194)),o=a(n(195)),i=a(n(686));function a(e){return e&&e.__esModule?e:{default:e}}var s=t.ObjType={txt:0,canvas:1,img:2,other:3,decoration:4},c=((0,o.default)(l,[{key:"isTextOrCanvasType",value:function(){return this.type===s.txt||this.type===s.canvas}},{key:"getOffset",value:function(){return parseInt(this._offset)}},{key:"isHighLight",value:function(){return 1==(1&this.attr)}},{key:"setHighLight",value:function(e){e?this.attr|=1:this.attr&=-2}}]),l);function l(e){(0,r.default)(this,l),this.id=0,this.type=e,this.attr=0,this._offset="0",this.text="",this.rect=new i.default(0,0,0,0),this.html="",this.className="",this.colors={colorOnWhite:"",colorOnBlack:""},this.font=""}t.default=c},686:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(194));function r(e){return e&&e.__esModule?e:{default:e}}var i=((0,r(n(195)).default)(a,[{key:"toCSSPositionString",value:function(){return"left:"+this.x+"px;top:"+this.y+"px;width:"+this.w+"px;height:"+this.h+"px;"}},{key:"isLeftOn",value:function(e){return this.x<e.x}},{key:"set",value:function(e){this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h}},{key:"clone",value:function(){return new a(this.x,this.y,this.w,this.h)}},{key:"right",get:function(){return this.x+this.w}},{key:"bottom",get:function(){return this.y+this.h}},{key:"centerX",get:function(){return this.x+this.w/2}},{key:"centerY",get:function(){return this.y+this.h/2}}],[{key:"isVerticalContain",value:function(e,t){return(e.y-t.y)*(e.bottom-t.bottom)<=0}},{key:"isVerticalOverLap",value:function(e,t){var n=Math.min(e.y,t.y),r=Math.max(e.bottom,t.bottom);return e.h+t.h-r+n>=Math.min(e.h,t.h)/2}},{key:"union",value:function(e,t){var n=Math.min(e.x,t.x),r=Math.min(e.y,t.y);return new a(n,r,Math.max(e.right,t.right)-n,Math.max(e.bottom,t.bottom)-r)}}]),a);function a(e,t,n,r){(0,o.default)(this,a),this.x=e,this.y=t,this.w=n,this.h=r}t.default=i},709:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=k(n(523)),p=k(n(68)),g=k(n(198)),v=k(n(65)),l=k(n(279)),f=k(n(133)),o=k(n(134)),u=k(n(62)),h=k(n(132)),d=k(n(710));t.default=function(){var e,t;return{state:{bookId:"",isBookInfoError:!1,bookInfo:{},isInShelf:!1,memberCardSummary:{},infiniteInfo:{},activeInfiniteInfo:{},readingStat:{},chapterInfos:[],progress:{},currentChapter:{},chapterContentHtml:"",chapterContentStyles:"",chapterContentState:"LOADING",chapterContentTargetHtml:"",chapterContentTargetCanvasHtml:"",isChapterContentDirty:!1,isSearchLoading:!1,isInSearchMode:!1,isShowAutoSearchHint:!1,searchResult:{keyword:"",resultList:[],hasMore:!1,totalCount:0,isNeedAutoSearchWhenShow:!1},startReadingTime:0,pauseTime:0,activeTime:0,token:"",balance:{hasFetched:!1,iOS:0,Android:0},psvts:0,pclts:0},getters:{getChapterWithIdxOffset:function(r){return function(e){var t=S.get(r.currentChapter,"chapterIdx",0);if(t&&0<r.chapterInfos.length){var n=t-r.chapterInfos[0].chapterIdx+e;if(-1<n&&n<r.chapterInfos.length)return r.chapterInfos[n]}return null}},getChapterWithChapterUid:function(o){return function(e){for(var t=0,n=o.chapterInfos.length;t<n;t++){var r=o.chapterInfos[t];if(r&&r.chapterUid===e)return r}return null}},hasPrevChapter:function(e,t){return null!==t.getChapterWithIdxOffset(-1)},hasNextChapter:function(e,t){return null!==t.getChapterWithIdxOffset(1)},isCurrentChapterTheFirst:function(e){return!!e.bookInfo&&(!e.currentChapter||!e.chapterInfos||0===e.chapterInfos.length||e.chapterInfos[0].chapterIdx===e.currentChapter.chapterIdx)},chapterTitleText:function(e){if(!R.default.isSupportedBookType(e.bookInfo.type))return"";var t=e.currentChapter;if(!t)return"";var n=S.get(t,"title","");return[R.default.isEPub(e.bookInfo)?"":"第"+S.get(t,"chapterIdx","")+"章",n].join(" ")},isBlackUser:function(e){return"black"===S.get(e.activeInfiniteInfo,"userType")},isNeedPay:function(e){return a.default.isChapterNeedPay({bookInfo:e.bookInfo,memberCardSummary:e.memberCardSummary,chapter:e.currentChapter})},isNeedPayWithoutMemberCard:function(e){return a.default.isChapterNeedPay({bookInfo:e.bookInfo,chapter:e.currentChapter})}},mutations:(e={},(0,o.default)(e,E.UPDATE_INIT_BOOK_ID,function(e,t){e.bookId=t||""}),(0,o.default)(e,E.UPDATE_READER_BOOK_INFO_ERROR,function(e){e.isBookInfoError=!0}),(0,o.default)(e,E.UPDATE_READER_BOOK_INFO_PRICE,function(e,t){e.bookInfo.price=t||0}),(0,o.default)(e,E.UPDATE_READER_BOOK_INFO_PAY_TYPE,function(e,t){e.bookInfo.payType=t||0}),(0,o.default)(e,E.UPDATE_READER_BOOK_INFO,function(e,t){e.bookInfo=t||{}}),(0,o.default)(e,E.UPDATE_READER_READING_STAT,function(e,t){e.readingStat=t||{}}),(0,o.default)(e,E.UPDATE_BOOK_IN_SHELF,function(e,t){e.isInShelf=t||!1}),(0,o.default)(e,E.UPDATE_READER_MEMBER_CARD_SUMMARY,function(e,t){e.memberCardSummary=t||{}}),(0,o.default)(e,E.UPDATE_READER_INFINITE_INFO,function(e,t){e.infiniteInfo=t||{}}),(0,o.default)(e,E.UPDATE_READER_ACTIVE_INFINITE_INFO,function(e,t){e.activeInfiniteInfo=t||{}}),(0,o.default)(e,E.UPDATE_READER_CHAPTER_INFOS,function(e,t){e.chapterInfos=t||[]}),(0,o.default)(e,E.UPDATE_READER_PROGRESS,function(e,t){e.progress=t||{}}),(0,o.default)(e,E.UPDATE_READER_LOCAL_PROGRESS,function(e,t){var n=t.appId,r=t.chapterUid,o=t.chapterOffset,i=t.updateTime,a=t.summary,s=t.progress,c=(0,h.default)({},e.progress.book,{appId:n,chapterUid:r,chapterOffset:o,updateTime:i,summary:a,progress:s});e.progress=(0,h.default)({},e.progress,{book:c})}),(0,o.default)(e,E.UPDATE_READER_CURRENT_CHAPTER,function(e,t){e.currentChapter=t||{}}),(0,o.default)(e,E.UPDATE_READER_CONTENT_HTML,function(e,t){var n=+new Date;if(e.chapterContentHtml=function(e,t){if(!e||e.length<=0)return"";var n=new RegExp('<img[^>]+?data-wr-co="([^"]+?)"[^>]+?alt="([^"]+?)"[^>]+?qqreader-footnote[^>]+?>',"gi");e=e.replace(n,'<span class="reader_footer_note js_readerFooterNote" data-wr-co="$1" data-wr-footernote="$2"></span>');var r=new RegExp('<img[^>]+?data-wr-co="([^"]+?)"[^>]+?qqreader-footnote[^>]+?alt="([^"]+?)"[^>]+?>',"gi");return(e=(e=(e=e.replace(r,'<span class="reader_footer_note js_readerFooterNote" data-wr-co="$1" data-wr-footernote="$2"></span>')).replace(/\.\.\/video\/(.*?\.(mp4|wmv|3gp|rm|rmvb|mov|m4v|avi))/gi,"https://res.weread.qq.com/wrepub/web/"+t+"/$1")).replace(/\.\.\/images\/(.*?\.(png|jpg|jpeg|gif))/gi,"https://res.weread.qq.com/wrepub/web/"+t+"/$1")).trim()}(t||"",e.bookId),N.inDevelopment()){var r=+new Date;console.log("[reader-layout] DOM 过滤处理时间 = ",r-n,"毫秒")}}),(0,o.default)(e,E.UPDATE_READER_CONTENT_STYLES,function(e,t){var n=+new Date;if(e.chapterContentStyles=function(e,t){if(!e||e.length<=0)return"";e=e.trim();var n=new RegExp("[^{}]*?{[\\s\\S]+?}","gi");return e.replace(/\/\*.*?\*\//gi,"").match(n).map(function(e){return".readerChapterContent "+(e=e.trim()).split("\n").map(function(e){return-1===(e=e.trim()).indexOf("{")&&-1===e.indexOf("}")&&-1===e.indexOf(";")?e+";":e}).join("")}).join("").trim().replace(/\.\.\/images\/(.*?\.(png|jpg|jpeg|gif))/gi,"https://res.weread.qq.com/wrepub/web/"+t+"/$1")}(t||"",e.bookId),N.inDevelopment()){var r=+new Date;console.log("[reader-layout] Style 过滤处理时间 = ",r-n,"毫秒")}}),(0,o.default)(e,E.UPDATE_READER_CHAPTER_CONTENT_TARGET_HTML,function(e,t){e.chapterContentTargetHtml=t||""}),(0,o.default)(e,E.UPDATE_READER_CHAPTER_CANVAS_TARGET_HTML,function(e,t){e.chapterContentTargetCanvasHtml=t||""}),(0,o.default)(e,E.UPDATE_READER_CONTENT_STATE,function(e,t){e.chapterContentState=t}),(0,o.default)(e,E.UPDATE_READER_CONTENT_IS_DIRTY,function(e,t){e.isChapterContentDirty=t||!1}),(0,o.default)(e,E.UPDATE_READER_SEARCH_RESULT,function(e,t){t.isLoadMore?e.searchResult.resultList=e.searchResult.resultList.concat(t.resultList):e.searchResult.resultList=t.resultList,e.searchResult.hasMore=t.hasMore,e.searchResult.totalCount=t.totalCount,e.searchResult.isNeedAutoSearchWhenShow=t.isNeedAutoSearchWhenShow}),(0,o.default)(e,E.CLEAR_READER_SEARCH_RESULT,function(e){e.searchResult.keyword="",e.searchResult.resultList=[],e.searchResult.hasMore=!1,e.searchResult.totalCount=0,e.isSearchLoading=!1}),(0,o.default)(e,E.UPDATE_READER_SEARCH_RESULT_KEYWORD,function(e,t){e.searchResult.keyword=t||""}),(0,o.default)(e,E.UPDATE_READER_IS_IN_SEARCH,function(e,t){e.isInSearchMode=t||!1}),(0,o.default)(e,E.UPDATE_READER_IS_SHOW_AUTO_SEARCH_HINT,function(e,t){e.isShowAutoSearchHint=t||!1}),(0,o.default)(e,E.UPDATE_READER_SEARCH_LOADING,function(e,t){e.isSearchLoading=t||!1}),(0,o.default)(e,E.UPDATE_READER_START_READING_TIME,function(e,t){e.startReadingTime=t||(new Date).getTime()}),(0,o.default)(e,E.UPDATE_READER_TOKEN,function(e,t){e.token=t||""}),(0,o.default)(e,E.UPDATE_READER_PAUSE_TIME,function(e){e.pauseTime=(new Date).getTime()}),(0,o.default)(e,E.UPDATE_READER_ACTIVE_TIME,function(e){e.activeTime=(new Date).getTime()}),(0,o.default)(e,E.UPDATE_READER_BALANCE,function(e,t){var n=S.get(t,"balance",0),r=S.get(t,"peerBalance",0);e.balance={hasFetched:!0,iOS:n,Android:r}}),(0,o.default)(e,E.UPDATE_READER_PAGE_SERVER_TIMESTAMP,function(e,t){e.psvts=y.e(t)||""}),(0,o.default)(e,E.UPDATE_READER_PAGE_CLIENT_TIMESTAMP,function(e,t){e.pclts=y.e(t)||""}),e),actions:(t={},(0,o.default)(t,b.FETCH_READER_INIT_DATA,function(e,t){var r=e.commit,n=e.dispatch,o=e.state,i=e.getters,a=t.initChapterUid,s=t.envConfig,c=t.isLogin;return f.default.all([f.default.all([n(b.FETCH_READER_BOOK_INFO,{envConfig:s,isLogin:c}),n(b.FETCH_READER_CHAPTER_INFOS,{envConfig:s,isLogin:c})].concat((0,l.default)(c?[n(b.FETCH_READER_PROGRESS,{envConfig:s,compareWithLocal:!1})]:[]))).then(function(e){var t=e[0]||{},n=e[1]||[];r(E.UPDATE_READER_CHAPTER_INFOS,O(t,n))}).then(function(){var e=function(e){var t=e.bookInfo,n=e.chapterInfos,r=e.initChapterUid,o=e.progress,i=null;if(R.default.isSupportedBookType(t.type)){var a=r;if(!r||!(0,d.default)(r)){var s=S.get(o,"book.chapterUid",0);0<s&&(a=s)}for(var c=0,l=n.length;c<l;c++){var u=n[c];if(u&&u.chapterUid===a){i=u;break}}}i&&i.chapterUid||(i=n[0]);L("chapterToShow","initChapterUid="+r,"progressChapterUid="+S.get(o,"book.chapterUid",0),"result="+(i?i.chapterUid:-1)),i||L("Error in chapterToShow. Can not find target Chapter");return i||{}}({bookInfo:o.bookInfo,chapterInfos:o.chapterInfos,initChapterUid:a,progress:o.progress});r(E.UPDATE_READER_CURRENT_CHAPTER,e),r(E.UPDATE_SHOW_NAV_BAR,i.isCurrentChapterTheFirst),r(E.UPDATE_READER_CONTENT_IS_DIRTY,!0),R.default.isSupportedBookType(o.bookInfo.type)?r(E.UPDATE_READER_CONTENT_STATE,"LOADING"):r(E.UPDATE_READER_CONTENT_STATE,"DONE")})].concat((0,l.default)(c?[n(b.FETCH_READER_BOOK_IN_SHELF,s),n(b.FETCH_READER_MEMBER_CARD_SUMMARY,s),n(b.FETCH_READER_INFINITE_INFO,s),n(b.FETCH_READER_ACTIVE_INFINITE,s),n(b.FETCH_READER_GET_CONFIG,s)]:[]),[n(b.FETCH_READER_BOOK_READING_STAT,{envConfig:s,isLogin:c})])).catch(function(e){L("Error in initData",e)})}),(0,o.default)(t,b.FETCH_READER_BOOK_INFO,function(e,t){var n=e.commit,r=e.state,o=e.dispatch,i=t.envConfig,a=t.isLogin,s=r.bookId;if(s)return o(b.FETCH_BOOK_INFO,{envConfig:i,bookId:s,isLogin:a}).then(function(e){var t=e||{};return console.log("[zhoonlog] bookinfo = "+(0,v.default)(t)),n(E.UPDATE_READER_BOOK_INFO,t),t.title&&n(E.UPDATE_PAGE_TITLE,t.title),t}).catch(function(e){n(E.UPDATE_READER_BOOK_INFO_ERROR),L("Error in loadBookInfo(bookId="+s,e)})}),(0,o.default)(t,b.FETCH_READER_CHAPTER_INFOS,function(e,t){var n=e.state,r=t.envConfig,o=t.isLogin,a=n.bookId;if(a)return o?(0,C.default)("/web/book/chapterInfos",(0,h.default)({bookIds:[a]},r)).then(function(e){for(var t=(e.data||{}).data||[],n={},r=0,o=t.length;r<o;r++){var i=t[r];if(i&&i.bookId===a){n=i;break}}return n.updated||[]}).catch(function(e){L("Error in chapterInfos",e)}):(0,C.default)("/web/book/publicchapterInfos",(0,h.default)({bookIds:[a]},r)).then(function(e){for(var t=(e.data||{}).data||[],n={},r=0,o=t.length;r<o;r++){var i=t[r];if(i&&i.bookId===a){n=i;break}}return n.updated||[]}).catch(function(e){L("Error in publicchapterInfos",e)})}),(0,o.default)(t,b.RELOAD_READER_CHAPTER_INFOS,function(e,t){var n=e.dispatch,r=e.commit,o=e.state,i=t.isLogin;return n(b.FETCH_READER_CHAPTER_INFOS,{envConfig:{},isLogin:i}).then(function(e){r(E.UPDATE_READER_CHAPTER_INFOS,O(o.bookInfo,e))})}),(0,o.default)(t,b.FETCH_READER_PROGRESS,function(e,t){var l=e.commit,u=e.state,n=t.envConfig,d=t.compareWithLocal,r=u.bookId;if(r)return(0,_.default)("/web/book/getProgress",(0,h.default)({bookId:r},n),function(e){if(d){var t=e.data,n=u.progress;if(!t||!n)return null;if(S.get(t,"book.updateTime",0)<=S.get(n,"book.updateTime",0))return null;if(S.get(t,"book.appId","")===S.get(n,"book.appId",""))return null;for(var r=S.get(t,"book.chapterUid",0),o=u.chapterInfos||[],i=!1,a=0,s=o.length;a<s;a++){var c=o[a];if(c&&c.chapterUid===r){i=!0;break}}return i?(l(E.UPDATE_READER_PROGRESS,t),t):null}l(E.UPDATE_READER_PROGRESS,e.data)},function(e){L("Error in fetchBookProgress",e)})}),(0,o.default)(t,b.FETCH_READER_BOOK_READING_STAT,function(e,t){var n=e.commit,r=e.state,o=t.envConfig,i=t.isLogin,a=r.bookId;if(a)return i?(0,_.default)("/web/book/readingStat",(0,h.default)({bookId:a,showUserNum:2},o),function(e){n(E.UPDATE_READER_READING_STAT,e.data)},function(e){L("Error in fetchReadingStat",e)}):(0,_.default)("/web/readingStat",(0,h.default)({bookId:a},o),function(e){n(E.UPDATE_READER_READING_STAT,e.data)},function(e){L("Error in fetchReadingStatNoSession",e)})}),(0,o.default)(t,b.FETCH_READER_BOOK_IN_SHELF,function(e,t){var a=e.commit,n=e.dispatch,s=e.state,r=s.bookId;if(r)return n(b.FETCH_IN_SHELF,{envConfig:t,bookIds:r}).then(function(e){for(var t={},n=0,r=e.length;n<r;n++){var o=e[n];if(o.bookId===s.bookId){t=o;break}}var i=1===t.onShelf;a(E.UPDATE_BOOK_IN_SHELF,i)}).catch(function(e){L("Error in fetchBookInShelf",e)})}),(0,o.default)(t,b.FETCH_READER_ADD_SHELF,function(e){var t=e.commit,n=e.dispatch,r=e.state.bookId;if(r)return n(b.FETCH_ADD_SHELF,{bookIds:[r]}).then(function(e){return e&&t(E.UPDATE_BOOK_IN_SHELF,!0),e}).catch(function(e){L("Error in addShelf",e)})}),(0,o.default)(t,b.FETCH_READER_ACTIVE_INFINITE,function(e,t){var n=e.commit;return(0,_.default)("/web/act/activeinfinite",(0,h.default)({},t),function(e){n(E.UPDATE_READER_ACTIVE_INFINITE_INFO,e.data)},function(e){L("Error in fetchReaderActiveInfinite",e)})}),(0,o.default)(t,b.FETCH_READER_MEMBER_CARD_SUMMARY,function(e,t){var n=e.commit;return(0,_.default)("/web/pay/memberCardSummary",(0,h.default)({},t,{pf:"ios"}),function(e){n(E.UPDATE_READER_MEMBER_CARD_SUMMARY,e.data)},function(e){L("Error in fetchMemberCardSummary",e)})}),(0,o.default)(t,b.FETCH_READER_INFINITE_INFO,function(e,t){var n=e.commit;return(0,_.default)("/web/act/sendinfinite",(0,h.default)({},t),function(e){n(E.UPDATE_READER_INFINITE_INFO,e.data)},function(e){L("Error in fetchReaderInfiniteInfo",e)})}),(0,o.default)(t,b.FETCH_READER_RECEIVE_MEMBERCARD,function(){}),(0,o.default)(t,b.FETCH_READER_CHAPTER_CONTENT,function(e){var t=e.dispatch,s=e.commit,o=e.state,c=e.getters;if(o.isChapterContentDirty){var i=o.bookId,n=o.currentChapter,a=S.get(n,"chapterUid");if(i&&a){s(E.UPDATE_READER_CONTENT_STATE,"LOADING"),s(E.UPDATE_READER_CHAPTER_CONTENT_TARGET_HTML,"");var r=function(e){var t=0<arguments.length&&void 0!==e?e:{},n={b:y.e(i),c:y.e(a),r:Math.pow(parseInt(1e4*Math.random()),2),st:0,ct:parseInt((new Date).getTime()/1e3),ps:o.psvts,pc:o.pclts};(0,g.default)(n,t);var r=x(n);return n.s=P(r),n},l=void 0;l=R.default.isEPub(o.bookInfo)?f.default.all([(0,C.default)(B("255e4h4e254e565652254f4k4d575b4h59254h4b26"),r(),function(e){var t=e.data;return t&&"string"==typeof t?I.chk(t):""},function(e){return L("Error in fetchContent",e),e}),(0,C.default)(B("255e4h4e254e565652254f4k4d575b4h59254h4b27"),r(),function(e){var t=e.data;return t&&"string"==typeof t?I.chk(t):""},function(e){return L("Error in fetchContent",e),e}),(0,C.default)(B("255e4h4e254e565652254f4k4d575b4h59254h4b28"),r({st:1}),function(e){var t=e.data;return t&&"string"==typeof t?I.chk(t):""},function(e){return L("Error in fetchContent",e),e}),(0,C.default)(B("255e4h4e254e565652254f4k4d575b4h59254h4b29"),r(),function(e){var t=e.data;return t&&"string"==typeof t?I.chk(t):""},function(e){return L("Error in fetchContent",e),e})]).then(function(e){if("string"==typeof e[0]&&0<e[0].length&&"string"==typeof e[1]&&0<e[1].length&&"string"==typeof e[2]&&0<e[2].length&&"string"==typeof e[3]&&0<e[3].length){var t=I.dS(e[2]);t=D.parse(t);var n=e[0]+e[1]+e[3];"..."===(n=I.dH(n))&&(n=c.chapterTitleText);var r=+new Date;if(n=A.parse(n,t),N.inDevelopment()){var o=+new Date;console.log("[reader-layout] DOM 预处理时间 = ",o-r,"毫秒")}s(E.UPDATE_READER_CONTENT_HTML,n),s(E.UPDATE_READER_CONTENT_STYLES,t),s(E.UPDATE_READER_CONTENT_STATE,"PRERENDER")}else{var i=null;if("object"===(0,p.default)(e[0])?i=e[0]:"object"===(0,p.default)(e[1])?i=e[1]:"object"===(0,p.default)(e[2])?i=e[2]:"object"===(0,p.default)(e[3])&&(i=e[3]),i){var a=i.errCode;if(-2012===a)return f.default.reject({isCustomError:!0,reason:"forceReload"});if(-2010===a||-2013===a)return f.default.reject({isCustomError:!0,reason:"sessionTimeout"})}s(E.UPDATE_READER_CONTENT_STATE,"ERROR")}},function(e){s(E.UPDATE_READER_CONTENT_STATE,"ERROR"),L("Error in fetchContent",e)}):f.default.all([(0,C.default)(B("255e4h4e254e565652254f4k4d575b4h59255b4b26"),r(),function(e){var t=e.data;return t&&"string"==typeof t?I.chk(t):""},function(e){return L("Error in fetchContent",e),e}),(0,C.default)(B("255e4h4e254e565652254f4k4d575b4h59255b4b27"),r(),function(e){var t=e.data;return t&&"string"==typeof t?I.chk(t):""},function(e){return L("Error in fetchContent",e),e})]).then(function(e){var t=e[0],n=e[1];if("string"==typeof t&&0<t.length&&"string"==typeof n&&0<n.length){var r=t+n;r=I.dT(r);var o=A.parseTxt(r);s(E.UPDATE_READER_CONTENT_HTML,o),s(E.UPDATE_READER_CONTENT_STATE,"PRERENDER")}else{var i=null;if("object"===(void 0===t?"undefined":(0,p.default)(t))?i=t:"object"===(void 0===n?"undefined":(0,p.default)(n))&&(i=n),i){var a=i.errCode;if(-2012===a)return f.default.reject({isCustomError:!0,reason:"forceReload"});if(-2010===a||-2013===a)return f.default.reject({isCustomError:!0,reason:"sessionTimeout"})}s(E.UPDATE_READER_CONTENT_STATE,"ERROR")}},function(e){s(E.UPDATE_READER_CONTENT_STATE,"ERROR"),L("Error in fetchContent",e)});var u=c.isNeedPay,d=T.default.isMemberShipValid(o.memberCardSummary),h=T.default.canBookFreeReading({bookInfo:o.bookInfo,memberCardSummary:o.memberCardSummary});return l.then(function(){if(s(E.UPDATE_READER_CONTENT_IS_DIRTY,!1),u&&d&&!h)return t(b.FETCH_READER_MEMBER_CARD_SUMMARY,{})})}}}),(0,o.default)(t,b.CHANGE_READER_CHAPTER,function(e,t){var n=e.dispatch,r=e.commit,o=e.state,i=e.getters,a=t.chapterUid;if("LOADING"===o.chapterContentState||"PRERENDER"===o.chapterContentState)return f.default.reject({isCustomError:!0,reason:o.chapterContentState});if(S.get(o.currentChapter,"chapterUid",0)===a)return f.default.reject({isCustomError:!0,reason:"currentChapter"});var s=void 0,c=i.getChapterWithIdxOffset(1);return c&&c.chapterUid===a&&(s=c),(s=s||i.getChapterWithChapterUid(a))?s?(r(E.UPDATE_READER_CURRENT_CHAPTER,s),r(E.UPDATE_SHOW_NAV_BAR,i.isCurrentChapterTheFirst),r(E.UPDATE_READER_CONTENT_IS_DIRTY,!0),window&&window.history.replaceState(null,null,w.readerURL(o.bookId,{chapterUid:a})),n(b.FETCH_READER_CHAPTER_CONTENT)):void 0:f.default.reject({isCustomError:!0,reason:"chapterNotExist"})}),(0,o.default)(t,b.RELOAD_READER_CURRENT_CHAPTER,function(e){var t=e.dispatch,n=e.commit,r=e.state,o=e.getters;if(r.currentChapter){n(E.UPDATE_READER_CONTENT_IS_DIRTY,!0);var i=r.currentChapter.chapterUid,a=o.getChapterWithChapterUid(i);return n(E.UPDATE_READER_CURRENT_CHAPTER,a),t(b.FETCH_READER_CHAPTER_CONTENT)}}),(0,o.default)(t,b.FETCH_READER_SEARCH_AUTO,function(e,t){var n=e.dispatch,r=e.commit,o=t.keyword;return r(E.UPDATE_READER_IS_SHOW_AUTO_SEARCH_HINT,!0),r(E.UPDATE_READER_IS_IN_SEARCH,!0),n(b.FETCH_READER_SEARCH,{keyword:o,isOnlyCount:!0})}),(0,o.default)(t,b.FETCH_READER_SEARCH,function(e,i){var a=e.commit,s=e.state;i.isLoadMore||(a(E.CLEAR_READER_SEARCH_RESULT),a(E.UPDATE_READER_SEARCH_RESULT_KEYWORD,i.keyword)),a(E.UPDATE_READER_SEARCH_LOADING,!0);var c=S.get(i,"isOnlyCount",!1);return(0,_.default)("/web/book/search",{bookId:s.bookId,keyword:i.keyword||"",maxIdx:i.maxIdx||0,count:10,fragmentSize:i.fragmentSize||150,onlyCount:c?1:0},function(e){a(E.UPDATE_READER_SEARCH_LOADING,!1);var t=e.data,n=S.get(t,"result",[]),r=1===S.get(t,"hasMore",0),o=S.get(t,"totalCount",0);a(E.UPDATE_READER_SEARCH_RESULT,{resultList:function(e,t){if(0===t.length)return t;var n=[],r=0<(e=e||[]).length?e[e.length-1].chapterUid:-1;return t.forEach(function(e){var t=(0,h.default)({},e,{firstInChapter:!1});r!==e.chapterUid&&(r=e.chapterUid,t.firstInChapter=!0),n.push(t)}),n}(s.searchResult.resultList,n),isLoadMore:i.isLoadMore,totalCount:o,hasMore:r,isNeedAutoSearchWhenShow:c})},function(e){a(E.UPDATE_READER_SEARCH_LOADING,!1),L("Error in readerSearch",e)})}),(0,o.default)(t,b.FETCH_READER_GET_CONFIG,function(e,t){var n=e.commit;return(0,_.default)("/web/getConfig",(0,h.default)({},t),function(e){var t=S.get(e.data,"token","");n(E.UPDATE_READER_TOKEN,t)},function(e){L("Error in getConfig",e)})}),(0,o.default)(t,b.FETCH_READER_ENTER_BOOK_READ,function(e,t){var n=e.state,r=e.commit,o=t.firstDomOffset,i=t.firstDomSummaryText;if(!n.isBookInfoError){var a=n.currentChapter,s={appId:M(navigator.userAgent),b:y.e(n.bookId),c:y.e(a.chapterUid),ci:a.chapterIdx,co:0,sm:"",pr:0,ct:parseInt((new Date).getTime()/1e3),ps:n.psvts,pc:n.pclts};if(R.default.isSupportReaderProgress(n.bookInfo)){var c=n.progress;S.get(c,"book.chapterUid",0)===a.chapterUid?(s.co=S.get(c,"book.chapterOffset",s.co),s.sm=S.get(c,"book.summary",s.sm)):(s.co=o,s.sm=i),s.pr=S.get(c,"book.progress",s.pr)}return s.s=P(x(s)),r(E.UPDATE_READER_LOCAL_PROGRESS,{appId:s.appId,chapterUid:a.chapterUid,chapterOffset:s.co,updateTime:parseInt((new Date).getTime()/1e3),summary:s.sm,progress:s.pr}),L("enterBookRead",new Date,"params="+(0,v.default)(s)),(0,C.default)("/web/book/read",s,function(e){return e},function(e){L("Error in enterBookRead",e);var t=S.get(e,"errCode",0);return-2010===t||-2012===t||-2013===t?{sessionTimeout:1}:e})}L("enterBookRead","return bcs of bookInfoError")}),(0,o.default)(t,b.FETCH_READER_BOOK_READ,function(e,n){var r=e.dispatch,t=e.commit,o=e.state;if(!o.isBookInfoError){var i=S.get(n,"retryCount",0),a=o.currentChapter,s=o.token,c=(new Date).getTime(),l=o.startReadingTime,u=0===l?0:Math.max(0,parseInt((c-l)/1e3)),d=parseInt(1e3*Math.random()),h={appId:M(navigator.userAgent),b:y.e(o.bookId),c:y.e(a.chapterUid),ci:a.chapterIdx,co:0,sm:"",pr:0,rt:u,ts:c,rn:d,sg:(0,m.sha256)(""+c+d+s),ct:parseInt((new Date).getTime()/1e3),ps:o.psvts,pc:o.pclts};if(R.default.isSupportReaderProgress(o.bookInfo)){var f=S.get(n,"progressData",null);null!==f&&"object"===(void 0===f?"undefined":(0,p.default)(f))&&(h.co=f.offset,h.sm=f.content.substr(0,20),h.pr=f.progress)}return h.s=P(x(h)),t(E.UPDATE_READER_LOCAL_PROGRESS,{appId:h.appId,chapterUid:a.chapterUid,chapterOffset:h.co,updateTime:parseInt(c/1e3),summary:h.sm,progress:h.pr}),L("reportTime","reportTime at",new Date,"duration="+u+"s","params="+(0,v.default)(h)),(0,C.default)("/web/book/read",h,function(e){return t(E.UPDATE_READER_START_READING_TIME),e.data},function(e){L("Error in bookRead",e);var t=S.get(e,"errCode",0);return-2010===t||-2012===t||-2013===t?{sessionTimeout:1}:0<i&&-2054===t?r(b.FETCH_READER_GET_CONFIG).then(function(){return r(b.FETCH_READER_BOOK_READ,(0,g.default)(n,{retryCount:i-1}))}):e})}L("bookRead","return bcs of bookInfoError")}),(0,o.default)(t,b.READER_MARK_PAUSE,function(e){(0,e.commit)(E.UPDATE_READER_PAUSE_TIME),L("hidden/idle at",new Date)}),(0,o.default)(t,b.READER_MARK_ACTIVE,function(e){var t=e.commit,n=e.state;t(E.UPDATE_READER_ACTIVE_TIME);var r=0;n.activeTime>n.pauseTime&&0<n.pauseTime&&0<n.startReadingTime&&(r=n.activeTime-n.pauseTime,t(E.UPDATE_READER_START_READING_TIME,n.startReadingTime+r));var o=3e4<(new Date).getTime()-n.startReadingTime;return L("active at",new Date(n.activeTime),", ignored duration="+parseInt(r/1e3)+"s",", isNeedForceReport="+o),o}),(0,o.default)(t,b.UPDATE_READER_LOCAL_LAST_CHAPTER,function(e){var t=e.state;if(t.bookId&&t.bookInfo&&0!==t.chapterInfos.length&&t.isInShelf&&R.default.isBuyUnitChapter(t.bookInfo)){var n=t.bookId,r=t.chapterInfos;if(n&&0<r.length){var o=s.default.getBookLastChaptersOperator(S.get(this.user,"vid")),i=S.get(r[r.length-1],"chapterIdx",0);o.set(n,i),o.save()}}}),(0,o.default)(t,b.FETCH_READER_BALANCE,function(e){var t=e.commit;return(0,C.default)("/web/pay/balance",{pf:"ios_html"},function(e){return t(E.UPDATE_READER_BALANCE,e.data),e},function(e){return L("Error in fetchReaderBalance",e),e})}),(0,o.default)(t,b.FETCH_READER_BUY_BOOK,function(e,t){var n=e.state,r=t.pf,o=t.price,i=t.isMCard,a={b:y.e(n.bookId),pt:n.bookInfo.payType,pf:r,pr:o,mm:i?1:0,ct:parseInt((new Date).getTime()/1e3),ps:n.psvts,pc:n.pclts};return a.s=P(x(a)),(0,C.default)("/web/pay/buyBook",a,function(e){return e.data},function(e){return L("Error in fetchReaderBuyBook",e),e})}),(0,o.default)(t,b.FETCH_READER_BUY_CHAPTERS,function(e,t){var n=e.state,r=t.pf,o=t.chapterIds,i=t.totalPrice,a=t.isMCard,s=t.isAutoPay,c={b:y.e(n.bookId),pt:n.bookInfo.payType,pf:r,ci:o,tp:i,mm:a?1:0,ap:s?"1":"0",ct:parseInt((new Date).getTime()/1e3),ps:n.psvts,pc:n.pclts};return c.s=P(x(c)),(0,C.default)("/web/pay/buyChapters",c,function(e){return e.data},function(e){return L("Error in fetchReaderBuyChapters",e),e})}),(0,o.default)(t,b.FETCH_ENCOURAGE_MONEY,function(e,t){(0,r.default)(e);var n=t.packetId||"";return(0,_.default)("/web/pay/memberCardCouponPacket",{packetId:n},function(){},function(){})}),(0,o.default)(t,b.FETCH_INVITE_CODE,function(e,t){var n=t.inviteCode;return(0,r.default)(e),(0,_.default)("/web/reader/invitecode",{cmd:"clicode",inviteCode:n},function(){},function(){})}),t)}};var m=n(714),_=k(n(193)),C=k(n(63)),b=c(n(35)),E=c(n(61)),i=k(n(43)),R=k(n(192)),a=k(n(525)),T=k(n(517)),s=k(n(64));function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function k(e){return e&&e.__esModule?e:{default:e}}var S=n(22),w=n(138),y=n(67),I=n(716),A=n(718),D=n(719),N=n(9);function L(){var e;N.isEnvServer,N.inDevelopment()&&(e=console).log.apply(e,["[readerLog]"].concat(Array.prototype.slice.call(arguments)))}function O(e,t){if(!e||!t)return[];var n=t.map(function(e){var t={chapterUid:e.chapterUid,chapterIdx:e.chapterIdx,title:i.default.replaceBlankToSpace(e.title).trim(),paid:e.paid||0,price:e.price||0,level:e.level||1,updateTime:e.updateTime,wordCount:e.wordCount||0,anchors:e.anchors||[]};return 0<t.anchors.length&&(t.anchors=t.anchors.filter(function(e){return e.title!==t.title})),t});return(R.default.isBuyUnitWholeBook(e)||R.default.isEPub(e))&&(n=n.filter(function(e){return"封面"!==e.title})),n}function B(e,t){for(var n=1<arguments.length&&void 0!==t?t:21,r="",o=0;o<e.length;o+=2)r+=String.fromCharCode(parseInt(e.slice(o,o+2),n));return r}function P(e){for(var t=352654597,n=t,r=e.length,o=r-1;0<o;o-=2)t=2147483647&(t^e.charCodeAt(o)<<(r-o)%30),n=2147483647&(n^e.charCodeAt(o-1)<<o%30);return(t+n).toString(16).toLowerCase()}function x(e,t){for(var n=1<arguments.length&&void 0!==t?t:[],r="",o=0===n.length,i=(0,u.default)(e).sort(),a=0;a<i.length;a++){var s=i[a];if(o||-1!==n.indexOf(s)){var c=e[s];r+=s+"="+encodeURIComponent(c),r+="&"}}return 0<r.length&&"&"===r.charAt(r.length-1)&&(r=r.slice(0,r.length-1)),r}function M(e){for(var t="",n=e.split(" "),r=0,o=Math.min(n.length,12);r<o;r++)t+=n[r].length%10;var i=function(e){for(var t=0,n=0,r=e.length;n<r;n++){t=131*t+e.charCodeAt(n)&2147483647}return t}(e);return 16<i.length&&(i=i.slice(0,16)),"wb"+t+"h"+i}},716:function(e,t,n){"use strict";var r=n(717).Base64,o=n(290);function i(e){if(!e||"string"!=typeof e||e.length<=1)return"";var t=e.slice(1);return t=function(u){var e=function(){var e=u.length;if(e<4)return[];if(e<11)return[0,2];for(var t=Math.min(4,Math.ceil(e/10)),n="",r=e-1;e-1-t<r;r--){var o=u.charCodeAt(r);n+=parseInt(o.toString(2),4)}for(var i=e-t-2,a=i.toString().length,s=[],c=0;s.length<10&&c+a<n.length;c+=a){var l=parseInt(n.slice(c,c+a));s.push(l%i),l=parseInt(n.slice(c+1,c+1+a)),s.push(l%i)}return s}();return function(e,t){for(var n=e.split(""),r=t.length-1;0<=r;r-=2)for(var o=1;0<=o;o--){var i=n[t[r]+o];n[t[r]+o]=n[t[r-1]+o],n[t[r-1]+o]=i}return n.join("")}(u,e)}(t),t=r.decode(t)}e.exports={chk:function(e){if(!e||e.length<=32)return e;var t=e.slice(0,32),n=e.slice(32);return t===o.createHash("md5").update(n).digest("hex").toUpperCase()?n:""},dT:function(e){return e&&0!==e.length?i(e):""},dH:function(e){return e&&0!==e.length?i(e):""},dS:function(e){return e&&0!==e.length?i(e):""}}},718:function(e,t,n){"use strict";var r,o=n(279),R=(r=o)&&r.__esModule?r:{default:r};var i=n(284),a=void 0,s=[],c=[];function _(e){for(var t=e.srcPos,n=0,r=0;r<c.length;r++){var o=c[r];if(e.srcPos>=n&&e.srcPos<n+o.contentLength){t+=o.indexInFullHtml-n;break}n+=o.contentLength}return t}function l(e){if(!e||"string"!=typeof e)return"";for(var t=e.split(/\n/),n=[],r=-1,o=0,i=t.length;o<i;o++){var a=t[o],s=a.trim();r+=1,0<s.length&&n.push({content:s,offset:r+a.indexOf(s)}),r+=a.length}for(var c="",l=0,u=n.length;l<u;l++){var d=n[l];c+='<p class="chapterContent_p" data-wr-co="'+d.offset+'">'+C(d.content,0,d.content.length,d.offset)+"</p>"}return c}function T(e,t,n){for(var r=e.slice(t,n),o=new RegExp("[0-9]+","g"),i=0,a=o.exec(r),s=[];a;){if(0<a.length){for(var c=a.index,l=a[0].length;i<c;){var u=T(e,t+i,t+c);s.push.apply(s,(0,R.default)(u)),i+=u.reduce(function(e,t){return e+t})}s.push(l),i=c+l}a=o.exec(r)}if(0<s.length)return s;for(var d=new RegExp("[A-Za-z]+","g"),h=0,f=d.exec(r),p=[];f;){if(0<f.length){var g=f[0].length,v=f.index,m=v,_=g;for(h<=v-1&&"&"===r.charAt(v-1)&&";"===r.charAt(v+g)&&(m=v-1,_=g+2);h<m;){var C=T(e,t+h,t+m);p.push.apply(p,(0,R.default)(C)),h+=C.reduce(function(e,t){return e+t})}p.push(_),h=m+_}f=d.exec(r)}if(0<p.length)return p;for(var b=new Array(n-t),E=0;E<b.length;E++)b[E]=1;return b}function C(t,n,e,r){var o=t.slice(n,e);if(function(e){return 0===(e=e.trim().replace(/&nbsp;/g,"")).length||u.test(e)}(o))return o;for(var i="",a=n;a<e;){T(t,a,e).forEach(function(e){i+='<span data-wr-id="layout" data-wr-co="%%OFFSET%%">'.replace("%%OFFSET%%",r+a-n)+t.slice(a,a+e)+"</span>",a+=e})}return i}var u=/^\s*$/;e.exports={parse:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";if(-1===e.indexOf("<body"))return l(e);a=a||function(){var e=["class","id"],t={whiteList:{body:e.concat(["class","style"]),a:e.concat(["target","href","title"]),abbr:e.concat(["title"]),address:e,area:e.concat(["shape","coords","href","alt"]),article:e,aside:e,audio:e.concat(["autoplay","controls","loop","preload","src"]),b:e,bdi:e.concat(["dir"]),bdo:e.concat(["dir"]),big:e,blockquote:e.concat(["cite"]),br:e,caption:e,center:e,cite:e,code:e,col:e.concat(["align","valign","span","width"]),colgroup:e.concat(["align","valign","span","width"]),dd:e,del:e.concat(["datetime"]),details:e.concat(["open"]),div:e,dl:e,dt:e,em:e,font:e.concat(["color","size","face"]),footer:e,h1:e,h2:e,h3:e,h4:e,h5:e,h6:e,header:e,hr:e,i:e,img:e.concat(["src","alt","title","width","height","data-w","data-ratio"]),ins:e.concat(["datetime"]),li:e,mark:e,nav:e,ol:e,p:e,pre:e,s:e,section:e,small:e,span:e,sub:e,sup:e,strong:e,table:e.concat(["width","border","align","valign"]),tbody:e.concat(["align","valign"]),td:e.concat(["width","rowspan","colspan","align","valign"]),tfoot:e.concat(["align","valign"]),th:e.concat(["width","rowspan","colspan","align","valign"]),thead:e.concat(["align","valign"]),tr:e.concat(["rowspan","align","valign"]),tt:e,u:e,ul:e,video:e.concat(["autoplay","controls","loop","preload","src","height","width"])},onTag:function(e,t,n){n.isWhite&&s.push({tag:e,srcHtml:t,isClosing:n.isClosing,pos:n.position,srcPos:n.sourcePosition})},onIgnoreTag:function(e,t,n){return n.isClosing||console.log("[chantlog] readerHtmlParser-onIgnoreTag",t),""},onIgnoreTagAttr:function(e,t,n){if("style"===t)return'style="'+n+'"'},safeAttrValue:function(e,t,n,r){var o=i.safeAttrValue(e,t,n,r);return"video"===e&&"src"===t&&""===o&&0===n.indexOf("../")?n:o}};return new i.FilterXSS(t)}();var n=function(e){var t={allContentMerged:"",contentLengthAndIndex:[]};if(!e||0===e.length)return t;for(var n=/<body[^>]*>\s*([\s\S]*?)\s*<\/body>/g,r=n.exec(e);r;){if(r&&2===r.length){var o=r[0],i=r.index;t.allContentMerged=t.allContentMerged+o,t.contentLengthAndIndex.push({contentLength:o.length,indexInFullHtml:i})}r=n.exec(e)}return t}(e);return e=n.allContentMerged,c=n.contentLengthAndIndex,s.length=0,e=function(e,t){for(var n="",r=0,o=/<body[^>]*>/g,i=/class="([^"]+)">/,a=o.exec(e);a;){if(1===a.length){var s=a[0],c=a.index,l=c+s.length,u=-1!==s.indexOf("background-image");if(!u){var d=i.exec(s);if(d&&2===d.length)for(var h=d[1].split(" "),f=0,p=h.length;f<p;f++){var g=h[f],v=t.indexOf(g);if(-1!==v){var m=t.indexOf("{",v);if(-1!==m){var _=t.indexOf("}",m);if(-1!==_)if(-1!==t.slice(m,_).indexOf("background-image")){u=!0;break}}}}}n+=e.slice(r,c),n+=u?s.replace("<body",'<div data-wr-bd="1" data-wr-inset="1"'):s.replace("<body",'<div data-wr-bd="1"'),r=l}a=o.exec(e)}return r<e.length&&(n+=e.slice(r)),n=n.replace(/<\/body>/g,"</div>")}(e=function(h,f){if(!h||0===h.length)return h;for(var p="",g=0,v=0,m=0,e=function(){var t=f[m];if(t.isClosing){v=h.indexOf(">",t.pos)+1,p+=h.slice(g,v),g=v;var e=m+1<f.length?f[m+1]:void 0;if(e){var n=e.pos,r=_(t)+t.srcHtml.length;p+=C(h,g,n,r),g=n}m++}else{var o=t.pos+1+t.tag.length;p+=h.slice(g,o);var i=_(t);p+=' data-wr-co="'+i+'"',g=o;var a=h.indexOf(">",t.pos)+1;if(p+=h.slice(g,a),g=a,"pre"===t.tag){var s=function(e,t,n){if(n>=e.length)return-1;for(var r=n;r<e.length;r++)if(t(e[r]))return r;return-1}(f,function(e){return e.tag===t.tag&&e.isClosing},m);if(-1!==s){var c=f[s];p+=h.slice(g,c.pos),g=c.pos,m=s+1}else m++}else{var l=m+1<f.length?f[m+1]:void 0;if(l){var u=l.pos,d=i+t.srcHtml.length;p+=C(h,g,u,d),g=u}m++}}};m<f.length;)e();return g<h.length&&(p+=h.slice(g)),p}(e=a.process(e),s),t)},parseTxt:l}},719:function(e,t,n){"use strict";e.exports={parse:function(e){return e&&0!==e.length?e=e.replace(/font-family:([^;]*?);/g,'font-family:$1,"PingFang SC", -apple-system, "SF UI Text",  "Lucida Grande", STheiti, "Microsoft YaHei", sans-serif;'):e}}},720:function(e,t,n){"use strict";n.r(t);var r=n(835),o=n(572);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},721:function(e,t,n){"use strict";n.r(t);var r=n(837),o=n(574);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(723);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},723:function(e,t,n){"use strict";var r=n(576);n.n(r).a},724:function(e,t,n){"use strict";n.r(t);var r=n(839),o=n(577);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(725);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},725:function(e,t,n){"use strict";var r=n(579);n.n(r).a},726:function(e,t,n){"use strict";n.r(t);var r=n(840),o=n(580);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(731);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},727:function(e,t,n){"use strict";var r=n(584);n.n(r).a},728:function(e,t,n){"use strict";var r=n(587);n.n(r).a},729:function(e,t,n){"use strict";var r=n(590);n.n(r).a},730:function(e,t,n){"use strict";var r=n(593);n.n(r).a},731:function(e,t,n){"use strict";var r=n(594);n.n(r).a},732:function(e,t,n){"use strict";n.r(t);var r=n(843),o=n(595);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(733);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},733:function(e,t,n){"use strict";var r=n(597);n.n(r).a},734:function(e,t,n){"use strict";n.r(t);var r=n(842),o=n(598);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(735);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},735:function(e,t,n){"use strict";var r=n(600);n.n(r).a},736:function(e,t,n){"use strict";n.r(t);var r=n(841),o=n(601);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(737);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},737:function(e,t,n){"use strict";var r=n(603);n.n(r).a},738:function(e,t,n){"use strict";n.r(t);var r=n(838),o=n(604);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(739);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},739:function(e,t,n){"use strict";var r=n(606);n.n(r).a},740:function(e,t,n){"use strict";n.r(t);var r=n(836),o=n(607);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(741);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},741:function(e,t,n){"use strict";var r=n(609);n.n(r).a},742:function(e,t,n){"use strict";n.r(t);var r=n(834),o=n(610);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(743);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},743:function(e,t,n){"use strict";var r=n(612);n.n(r).a},744:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(26)),o=i(n(745));function i(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var t=new(r.default.extend(o.default))({});r.default.prototype.$footerNote=t,r.default.prototype.$showFooterNote=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};t.$el&&t.$el.parentNode||(t.$mount(document.createElement("div")),document.body.appendChild(t.$el)),t.show(e)}}},745:function(e,t,n){"use strict";n.r(t);var r=n(847),o=n(613);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(746);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},746:function(e,t,n){"use strict";var r=n(615);n.n(r).a},747:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(26)),o=i(n(748));function i(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var t=new(r.default.extend(o.default))({});r.default.prototype.$showReceiveMCardSuccessDialog=function(e){t.$el&&t.$el.parentNode||(t.$mount(document.createElement("div")),document.body.appendChild(t.$el)),t.showDialog(e),t.beginToLoadQrCode()}}},748:function(e,t,n){"use strict";n.r(t);var r=n(848),o=n(616);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(749);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},749:function(e,t,n){"use strict";var r=n(618);n.n(r).a},756:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(26)),o=i(n(757));function i(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var t=new(r.default.extend(o.default))({});r.default.prototype.$showSelectionToolBar=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};t.$el||t.$mount(document.createElement("div")),t.$el.parentNode&&t.$el.parentNode!==e.parentNode&&t.$el.parentNode.removeChild(t.$el),t.$el.parentNode||e.parentNode.appendChild(t.$el),t.show(e)},r.default.prototype.$hideSelectionToolBar=function(){t.hide()}}},757:function(e,t,n){"use strict";n.r(t);var r=n(850),o=n(632);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(758);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},758:function(e,t,n){"use strict";var r=n(634);n.n(r).a},759:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(26)),o=i(n(760));function i(e){return e&&e.__esModule?e:{default:e}}t.default=function(){var t=new(r.default.extend(o.default))({});r.default.prototype.$showReviewDetailPanel=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};t.$el||t.$mount(document.createElement("div")),t.$el.parentNode&&t.$el.parentNode!==e.parentNode&&t.$el.parentNode.removeChild(t.$el),t.$el.parentNode||e.parentNode.appendChild(t.$el),t.show(e)},r.default.prototype.$hideReviewDetailPanel=function(){t.hide()},r.default.prototype.$isReviewDetailPanelShowing=function(){return t.isShowing()}}},760:function(e,t,n){"use strict";n.r(t);var r=n(851),o=n(635);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(761);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},761:function(e,t,n){"use strict";var r=n(637);n.n(r).a},762:function(e,t,n){"use strict";n.r(t);var r=n(831),o=n(638);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(763);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},763:function(e,t,n){"use strict";var r=n(640);n.n(r).a},764:function(e,t,n){"use strict";var T=r(n(765)),k=n(685),S=r(k);function r(e){return e&&e.__esModule?e:{default:e}}var d=n(9),C=n(22);function b(e){var t=e.node,n=e.nodeName;return d.inDevelopment()?!("span"!==n||!t.getAttribute("data-wr-footernote"))||("img"===n||"pre"===n||"video"===n||"audio"===n||"table"===n||"ul"===n||"ol"===n||"hr"===n):!("span"!==n||!t.getAttribute("data-wr-footernote"))||("img"===n||"pre"===n||"video"===n||"hr"===n)}function w(){return"wr"+Math.random().toString(36).slice(2)}function y(e){return window.getComputedStyle(e,null)}function E(e,t,n,r,o){var i=function(e){return{node:e,nodeName:e.nodeName.toLowerCase(),nodeType:e.nodeType}}(e);if(function(e){return"style"!==e.nodeName&&e.nodeType===Node.ELEMENT_NODE}(i)){if(0<R.length&&e.hasAttribute("id")){var a=e.getAttribute("id");-1!==R.indexOf(a)&&n.anchorsTop.push({anchor:a,offsetTop:e.offsetTop})}var s=function(e){var t=e.nodeName,n=e.node;if("style"===t||"hr"===t)return!1;if("span"===t&&"layout"===n.getAttribute("data-wr-id"))return!1;var r=n.getAttribute("id");return"preRenderContainer"!==r&&"preRenderContent"!==r}(i),c=function(e){return"div"===e.nodeName&&e.node.hasAttribute("data-wr-bd")}(i);if(s||c){var l=function(e,t,n){var r=e.node,o=y(r),i=T.default.getDecorationTagStyle(r,o);if(C.isEmpty(i)&&!t)return null;var a=new S.default(k.ObjType.decoration),s=t?r.classList.toString():"",c=i.styleText||"",l=i.className||"";n.customStyle.push(c);var u=T.default.style.getLeft(e)+T.default.style.getTop(e)+T.default.style.getWidth(e)+T.default.style.getHeight(e);if(t){var d=r.getAttribute("style");l+=" wr_readerBackground_opacity",d&&0<d.length&&(u+=d)}return u=u.replace(/"/gi,"'"),a.id=w(),a._offset=r.getAttribute("data-wr-co"),a.html='<div class="wr_decoration'+(0<s.length?" "+s:"")+(0<l.length?" "+l:"")+'" style="'+u+'"></div>',a.text="",a.rect.x=T.default.style.getNodeOffsetLeftRaw(e),a.rect.y=T.default.style.getNodeOffsetTopRaw(e),a.rect.w=T.default.style.getNodeWidthRaw(e),a.rect.h=T.default.style.getNodeHeightRaw(e),a}(i,c,n);l&&n.decoration.push(l)}if(function(e){var t=e.nodeName;return("span"===t||"a"===t)&&"layout"===e.node.getAttribute("data-wr-id")}(i)){var u=+new Date,d=function(e,t,n,r){var o=new S.default(k.ObjType.txt),i=e.node,a=i.innerText||"";o.text=a;var s=+new Date,c=void 0,l=i.outerHTML;l=l.replace(/data-wr-co="([0-9]*)"/,""),o._offset=RegExp.$1||0,D&&(c=+new Date,L["4-html.replace(data-wr-co)"]+=c-s,s=c);var u=w();if(o.id=u,D&&(c=+new Date,L["5-getRandomId"]+=c-s,s=c),o.rect.x=i.offsetLeft,o.rect.y=i.offsetTop,o.rect.w=T.default.style.getNodeWidthRaw(e),o.rect.h=T.default.style.getNodeHeightRaw(e),D&&(c=+new Date,L["7-dom.getBoundingClientRect"]+=c-s,s=c),0===o.rect.w||0===o.rect.h)return null;var d=o.rect.bottom,h=d<A.canvasMaxHeight*A.canvasMaxCount;o.type=h?k.ObjType.canvas:k.ObjType.txt;var f=function(e,t,n){if(e&&e.type===n&&e.text&&1===e.text.length&&1===t.length){var r=t.charCodeAt(0);if(19968<=r&&r<=40869){var o=e.text.charCodeAt(0);if(19968<=o&&o<=40869)return!0}}return!1}(r,a,o.type);if(h){if(f)o.font=r.font,o.colors=r.colors,D&&L["1-reuseCount"]++;else{var p=y(i);D&&(c=+new Date,L["0-dom.getComputedStyle"]+=c-s,s=c),o.font=T.default.style.getNodeFontRaw(e,p),o.colors=T.default.style.getNodeColorRaw(e,p,n),D&&(c=+new Date,L["1-styleManager.getCustomTagStyle"]+=c-s,s=c)}var g=Math.floor(d/A.canvasMaxHeight),v=t.canvasPositions[g]||{top:Number.MAX_VALUE,bottom:Number.MIN_VALUE};v.top=Math.min(o.rect.y,v.top),v.bottom=Math.max(d,v.bottom),t.canvasPositions[g]=v}else{if(f)o.className=r.className||"",D&&L["1-reuseCount"]++;else{var m=y(i);D&&(c=+new Date,L["0-dom.getComputedStyle"]+=c-s,s=c);var _=T.default.getCustomTagStyle(e,m,n);D&&(c=+new Date,L["1-styleManager.getCustomTagStyle"]+=c-s,s=c);var C=_.className||"";o.className=C;var b=_.styleText||"";0<b.length&&-1===I.indexOf(C)&&t.customStyle.push(b),0<C.length&&I.push(C),D&&(c=+new Date,L["3-customClassNames"]+=c-s,s=c)}var E=T.default.style.getLeft(e)+T.default.style.getTop(e)+T.default.style.getWidth(e);D&&(c=+new Date,L["2-styleManager.style.getLeft/getTop/getWidth"]+=c-s,s=c);var R='data-wr-id="'+u+'" class="wr_absolute'+(0<o.className.length?" "+o.className:"")+'" style="'+E+'"';l=l.replace(/data-wr-id="layout"/,R),o.html=l,D&&(c=+new Date,L["6-html.replace(data-wr-id)"]+=c-s,s=c)}return o}(i,n,r,o);if(D){var h=+new Date;N+=h-u}if(d)if(n.content.push(d),n.content.length<Math.floor(t/2))n.randomHtml.push(d.html);else{var f=Math.floor(Math.random()*n.content.length);n.randomHtml.splice(f,0,d.html)}return d}if(!b(i)&&e.childNodes)for(var p=e.childNodes||[],g=null,v=0,m=p.length;v<m;v++){g=E(p[v],t,n,r,g)}else{var _=function(e){if(b(e)){var t=new S.default(k.ObjType.other);t.text="[插图]";var n=e.node,r=T.default.getOtherTagStyle(e),o=n.outerHTML;o=o.replace(/data-wr-co="([0-9]*)"/,""),t._offset=RegExp.$1||0,t.id=w();var i=e.nodeName;"img"===i&&-1!==o.indexOf("style=")&&(o.match(/style="(.*?)"/gi),r+=RegExp.$1||"");var a=o.indexOf("<"+i),s=o.indexOf("class="),c=o.indexOf(">"),l="img"===i?"wr_absolute wr_readerImage_opacity":"wr_absolute";if("video"===i)o='<div class="wr_absolute" style="'+r+'">'+(o=o.replace(/class="([^"]+?)"/i,'class="$1" style="" data-wr-id="'+t.id+'" '))+'<span class="wr_video_playButton">点击播放</span></div>';else if(a<s&&s<c){o=o.replace(/class="([^"]+?)"/i,'class="$1 '+l+'" style="'+r+'" data-wr-id="'+t.id+'" '),RegExp.$1&&-1!==RegExp.$1.indexOf("reader_footer_note")&&(t.type=k.ObjType.img)}else{var u=new RegExp("<"+i,"i");o=o.replace(u,'$& class="'+l+'" style="'+r+'" data-wr-id="'+t.id+'" ')}t.html=o;var d=n.getBoundingClientRect();return t.rect.x=n.offsetLeft,t.rect.y=n.offsetTop,t.rect.w=d.width,t.rect.h=d.height,t}return null}(i);n&&(n.content.push(_),n.randomHtml.push(_.html))}}}var I=[],A={},R=[],D=d.inDevelopment(),N=0,L={"0-dom.getComputedStyle":0,"1-styleManager.getCustomTagStyle":0,"1-reuseCount":0,"2-styleManager.style.getLeft/getTop/getWidth":0,"3-customClassNames":0,"4-html.replace(data-wr-co)":0,"5-getRandomId":0,"6-html.replace(data-wr-id)":0,"7-dom.getBoundingClientRect":0};e.exports={collect:function(e,t,n){var r={rootHeight:0,randomHtml:[],content:[],decoration:[],customStyle:[],canvasPositions:[],anchorsTop:[]};if(!e)return r;A=t,R=n;var o=e.innerHTML||"",i=e.getBoundingClientRect()||{},a=o.match(/data-wr-id/gi),s=a?a.length:0;d.inDevelopment()&&console.log("[reader-layout] span 大概个数 =",s,"总高度 =",i.height),I=[],r.rootHeight=i.height;var c=+new Date;if(D)for(var l in N=0,L)L[l]=0;if(E(e,s,r,document.body.classList.contains("wr_whiteTheme"),null),D){var u=+new Date;console.log("[reader-layout] 渲染遍历 DOM 时间 = ",u-c,"毫秒","timeForCustomNode=",N,"ts=",L)}return r}}},765:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=o(n(62)),r=o(n(20));function o(e){return e&&e.__esModule?e:{default:e}}var f=n(22),d=n(9),p=new r.default;function h(){return"ccn-"+Math.random().toString(36).slice(2)}function i(e){if(!e||-1===e.indexOf("#")||4!==e.length&&7!==e.length)return null;var t=b[e];if(t)return t;if(4===e.length){for(var n="#",r=1;r<4;r+=1)n+=e.slice(r,r+1).concat(e.slice(r,r+1));e=n}return t={r:parseInt(e.substring(1,3),16),g:parseInt(e.substring(3,5),16),b:parseInt(e.substring(5,7),16)},b[e]=t}function g(e){var t=e.match(/\d{1,3}/g);if(!t||t.length<3)return null;var n=b[e];if(n)return n;var r=t[0]/255,o=t[1]/255,i=t[2]/255,a=Math.max(r,o,i),s=Math.min(r,o,i),c=void 0,l=void 0,u=(a+s)/2;if(a===s)c=l=0;else{var d=a-s;switch(l=.5<u?d/(2-a-s):d/(a+s),a){case r:c=(o-i)/d+(o<i?6:0);break;case o:c=(i-r)/d+2;break;case i:c=(r-o)/d+4}c/=6}return n={h:c,s:l,l:u},b[e]=n}function v(e,t,n){var r="hsl:"+e+"-"+t+"-"+n,o=b[r];if(o)return o;var i=void 0,a=void 0,s=void 0;if(0===t)i=a=s=n;else{var c=n<.5?n*(1+t):n+t-n*t,l=2*n-c;i=m(l,c,e+1/3),a=m(l,c,e),s=m(l,c,e-1/3)}return o={r:Math.floor(255*i),g:Math.floor(255*a),b:Math.floor(255*s)},b[r]=o}function m(e,t,n){return n<0&&(n+=1),1<n&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function _(e){if(!e||e.length<=0)return"";var t="inverse-color-"+e,n=b[t];if(n)return n;var r=g(e),o=r.s,i=r.h,a=r.l;return a=1-.4*a,o<=.3&&.7<a&&(a=.7),n=v(i,o,a),b[t]=n}function a(e){var t=e.boundingClientRect;return void 0===t&&(t=e.node.getBoundingClientRect(),e.boundingClientRect=t),t}var C={},b={},s=i("#D0D3D8"),c=i("#0D141E"),E="rgb("+s.r+", "+s.g+", "+s.b+")",R="rgb("+c.r+", "+c.g+", "+c.b+")",T={getNodeOffsetTopRaw:function(e){var t=e.nodeOffsetTop;void 0===t&&(t=e.node.offsetTop,e.nodeOffsetTop=t);return t},getNodeOffsetLeftRaw:function(e){var t=e.nodeOffsetLeft;void 0===t&&(t=e.node.offsetLeft,e.nodeOffsetLeft=t);return t},getNodeWidthRaw:function(e){var t=e.nodeWidth;void 0===t&&(t=a(e).width,e.nodeWidth=t);return t},getNodeHeightRaw:function(e){var t=e.nodeHeight;void 0===t&&(t=a(e).height,e.nodeHeight=t);return t},getNodeLineHeightRaw:function(e){return e.node.offsetHeight},getNodeFontRaw:function(e,t){var n="",r=t.font.replace(/"/gi,"'");if(0<r.length)n=r;else{var o=t.fontStyle,i=t.fontVariant,a=t.fontWeight,s=t.fontSize;n=o+" "+i+" "+a+" "+s+"/"+s+" "+t.fontFamily}var c=this.getNodeLineHeightRaw(e);return n=n.replace(/\/\s*[0-9.]+px/,"/"+c+"px")},getNodeColorRaw:function(e,t,n){var r={colorOnWhite:"",colorOnBlack:""},o=t.color;if(n&&o===R)r.colorOnWhite=o,r.colorOnBlack=E;else if(n||o!==E){var i=_(r.colorOnWhite=o);r.colorOnBlack="rgb("+i.r+", "+i.g+", "+i.b+")"}else r.colorOnWhite=R,r.colorOnBlack=o;return r},getTop:function(e){return"top:"+this.getNodeOffsetTopRaw(e)+"px;"},getLeft:function(e){return"left:"+this.getNodeOffsetLeftRaw(e)+"px;"},getWidth:function(e){return"width:"+this.getNodeWidthRaw(e)+"px;"},getHeight:function(e){return"height:"+this.getNodeHeightRaw(e)+"px;"},getLineHeight:function(e){return"line-height:"+this.getNodeLineHeightRaw(e)+"px;"},getComputedWidth:function(e){return"width:"+e.width+";"},getComputedHeight:function(e){return"height:"+e.height+";"},getFont:function(e){var t=e.font.replace(/"/gi,"'");if(0<t.length)return"font:"+t+";";var n=e.fontSize,r=e.fontFamily,o=e.fontWeight,i=e.fontStyle,a=[];return 0<n.length&&a.push("font-size:"+n+";"),0<r.length&&a.push("font-family:"+r+";"),0<o.length&&a.push("font-weight:"+o+";"),0<i.length&&a.push("font-style:"+i+";"),a.join("")},getBorder:function(o,e){var t=1<arguments.length&&void 0!==e&&e,n=[],r={};function i(e){return 0<e.length&&!f.startsWith(e,"0px")&&-1===e.indexOf("none")}function a(e){var t=o[e+"Width"],n=o[e+"Style"],r=o[e+"Color"];return i(t)&&i(n)&&i(r)?t+" "+n+" "+r:""}var s="Firefox"===p.getBrowser(),c=s?a("border"):o.border;if(i(c))n.push("border:"+c+";"),r.border=c;else{var l=s?a("borderTop"):o.borderTop,u=s?a("borderRight"):o.borderRight,d=s?a("borderBottom"):o.borderBottom,h=s?a("borderLeft"):o.borderLeft;i(l)&&(n.push("border-top:"+l+";"),r["border-top"]=l),i(u)&&(n.push("border-right:"+u+";"),r["border-right"]=u),i(d)&&(n.push("border-bottom:"+d+";"),r["border-bottom"]=d),i(h)&&(n.push("border-left:"+h+";"),r["border-left"]=h)}return t?r:n.join("")},getBorderWidth:function(e){var t=e.borderWidth;return 0<t.length&&"0px"!==t?t:""},getRadius:function(e,t){var n=1<arguments.length&&void 0!==t&&t,r=e.borderRadius;return 0<r.length&&"0px"!==r?n?{"border-radius":r}:"border-radius:"+r+";":""},getBackground:function(e,t){var n=1<arguments.length&&void 0!==t&&t,r=[],o={},i=e.backgroundColor;return 0<i.length&&-1===i.indexOf("rgba(0, 0, 0, 0)")&&(r.push("background-color:"+i+";"),o["background-color"]=i),n?o:r.join("")}};t.default={style:T,getCustomTagStyle:function(e,t,n){var r={};if(t){var o=[];o.push(T.getFont(t)),o.push(T.getHeight(e)),o.push(T.getLineHeight(e));var i=t.color;i=n?i!==R?(o.push("color:"+i+";"),"color:"+i+";"):"":i!==E?(o.push("color:"+i+";"),"color:"+i+";"):"";var a=o.join(""),s=C[a];if(s)return s;r.className=h();var c="";if(0<i.length){var l=_(i);c="color:rgb("+l.r+", "+l.g+", "+l.b+");"}r.styleText="\n                .readerChapterContent ."+r.className+" {\n                    "+a+"\n                    "+c+"\n                 }\n                 .wr_whiteTheme .readerChapterContent ."+r.className+" {\n                      "+i+"\n                 }",C[a]={className:r.className,styleText:r.styleText}}return r},getOtherTagStyle:function(e){var t=[],n=e.nodeName;if("img"===n);else if("pre"===n){var r=getComputedStyle(e.node),o=T.getComputedWidth(r),i=T.getComputedHeight(r);0<o.length&&t.push(o),0<i.length&&t.push(i)}else if("hr"===n){t.push("margin:0;");var a=T.getWidth(e);0<a.length&&t.push(a)}else if("span"===n){var s=T.getWidth(e),c=T.getHeight(e);0<s.length&&t.push(s),0<c.length&&t.push(c)}else if("video"===n){var l=T.getWidth(e),u=T.getHeight(e);0<l.length&&t.push(l),0<u.length&&t.push(u)}else d.inDevelopment()&&(console.log("[zhoonlog] getOtherTagStyle inValid nodeName = ",n),alert("找 zhoon 看看 - getOtherTagStyle inValid nodeName = "+n));return t.push(T.getLeft(e)),t.push(T.getTop(e)),t.join("")},getDecorationTagStyle:function(e,t){var n={};if(t){var r=T.getBorder(t,!0),o=T.getBackground(t,!0);if(f.isEmpty(r)&&f.isEmpty(o))return{};var i=[T.getBorder(t),T.getBackground(t)].join(""),a=C[i];if(a)return a;n.className=h();var s="";f.isEmpty(o)||(0,u.default)(o).forEach(function(e){var t=function(e,t){if(!e||e.length<=0||"transparent"===e)return"";var n="inverse-background-"+e,r=b[n];if(r)return r;e.match(/,[^,]?([0]?\.[0-9]+)/gi);var o=RegExp.$1,i=g(e),a=i.s;return(r=v(i.h,a,t)).alpha=o,b[n]=r}(o[e],.1),n=!!t.alpha;s+=e+(n?":rgba("+t.r+", "+t.g+", "+t.b+", "+t.alpha+");":":rgb("+t.r+", "+t.g+", "+t.b+");")});var c=T.getRadius(t)+T.getBorder(t),l=T.getBorder(t)+T.getBackground(t)+T.getRadius(t);n.styleText="\n                .readerChapterContent ."+n.className+" {\n                    "+c+"\n                    "+s+"\n                 }\n                 .wr_whiteTheme .readerChapterContent ."+n.className+" {\n                    "+l+"\n                 }",C[i]={className:n.className,styleText:n.styleText}}return n}}},766:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BookMarkTypeBookMark=0,t.BookMarkTypeUnderline=1},767:function(e,t,n){"use strict";n.r(t);var r=n(829),o=n(641);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(768);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},768:function(e,t,n){"use strict";var r=n(643);n.n(r).a},769:function(e,t,n){"use strict";n.r(t);var r=n(827),o=n(644);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n(770);var a=n(3),s=Object(a.a)(o.default,r.a,r.b,!1,null,null,null);t.default=s.exports},770:function(e,t,n){"use strict";var r=n(646);n.n(r).a},772:function(e,t,n){"use strict";var r=n(647);n.n(r).a},816:function(e,t,n){"use strict";function r(){var n=this,e=n.$createElement,r=n._self._c||e;return r("div",{staticClass:"readerContent"},[r("div",{ref:"appContent",staticClass:"app_content"},[n.isShowReaderTopBar?r("reader-top-bar",{ref:"reader_top_bar",attrs:{"book-info":n.bookInfo,"current-chapter":n.currentChapter,"current-chapter-anchor":n.currentChapterAnchor,"is-show-add-shelf":n.isShowTopBarAddShelfButton},on:{onClickItem:n.handleClickTopBarItem}}):n._e(),!n.isShowReaderTopBar||n.isFromWeReadApp?r("reader-book-info",{attrs:{"book-info":n.bookInfo,"chapter-infos":n.chapterInfos,"reading-stat":n.readingStat,"show-add-shelf-button":n.showFirstPageAddShelfButton},on:{clickStartReading:n.handleClickStartReading,clickAddShelf:n.handleClickShelfButtonInBookInfo,clickDownloadApp:n.downloadAppToRead,clickRatingButton:n.handleClickRatingButton,clickShowCatalog:n.showCatalog}}):n._e(),n.displayTopTotalReviewList&&0<n.displayTopTotalReviewList.length&&!n.isShowReaderTopBar?r("ReaderTopReviews",{staticClass:"reader_bookReviewList",attrs:{"book-id":n.bookId,"review-list":n.displayTopTotalReviewList},on:{"emit-book-review-click":n.handleTopWriteReviewClickEvent}}):n._e(),n.hasCurrentChapter?r("div",{ref:"readerChapterContent",class:["readerChapterContent","fontLevel"+n.fontSizeLevel,{navBarOffset:n.isShowReaderTopBar&&!n.isFromWeReadApp}]},[n.isShowLoading?r("div",{staticClass:"readerChapterContentLoading"},[r("loading",{attrs:{zoom:"0.3"}})],1):n._e(),n.isShowRenderTarget&&!n.isEpub?r("div",{staticClass:"chapterTitle"},[n._v("\n                "+n._s(n.chapterTitleText)+"\n            ")]):n._e(),n.isShowPreRender?r("div",{key:"preRenderContainer",ref:"preRenderContainer",staticClass:"preRenderContainer"},[n.isEpub&&n.chapterContentStyles?r("CustomStyle",[n._v("\n                    "+n._s(n.chapterContentStyles)+"\n                ")]):n._e(),r("div",{staticClass:"preRenderContent",attrs:{id:"preRenderContent"},domProps:{innerHTML:n._s(n.chapterContentForEPub)}})],1):n._e(),r("div",{key:"renderTargetContainerSibling",ref:"renderTargetContainerSibling"}),"DONE"===n.chapterContentState?r("div",{key:"renderTargetContainer",ref:"renderTargetContainer",class:["renderTargetContainer",{renderTargetContainer_needPay:n.isNeedPay,hide:n.isSoldOutForbiddenRead}]},[r("div",{key:"chapterContentHighLightBgHtml",domProps:{innerHTML:n._s(n.chapterContentHighLightBgHtml)}}),r("div",{key:"renderTargetCanvasContainer",ref:"renderTargetCanvasContainer",staticClass:"wr_canvasContainer",domProps:{innerHTML:n._s(n.chapterContentTargetCanvasHtml)}}),n.isEpub&&n.chapterContentStyles?r("CustomStyle",[n._v("\n                    "+n._s(n.chapterContentStyles)+"\n                ")]):n._e(),r("div",{ref:"renderTargetContent",staticClass:"renderTargetContent",attrs:{id:"renderTargetContent"},domProps:{innerHTML:n._s(n.chapterContentTargetHtml)}}),r("div",{key:"chapterContentSelection",domProps:{innerHTML:n._s(n.chapterContentSelectionHtml)}}),n.isNeedShowMyNote?r("div",{key:"underline"},n._l(n.underlineRenderDatas,function(t){return r("div",{key:t.key,class:t.classNames,style:t.rect.toCSSPositionString(),on:{click:function(e){return e.stopPropagation(),n.handleClickUnderline(t)}}})}),0):n._e()],1):n._e(),n.isShowError?r("div",{key:"chapterContentError",staticClass:"chapterContentError"},[n._v("\n                加载失败，请"),r("a",{attrs:{href:"javascript:window.location.reload();"}},[n._v("点击重试")])]):n._e()]):n._e(),n.hasCurrentChapter&&!n.isChapterContentDirty&&n.isShowRenderTarget?r("div",{staticClass:"readerFooter"},[n.isNeedPay&&n.isSoldOut?r("div",{staticClass:"readerFooter_desc"},[n._v("\n                本书已下架"),r("br"),n._v("部分内容不再支持购买和阅读\n            ")]):n.isSoldOutForbiddenRead?r("div",{staticClass:"readerFooter_desc"},[n._v("\n                本书已下架"),r("br"),n._v("部分内容不再支持阅读\n            ")]):n.isPhone?r("div",[n.isNeedPay?r("a",{class:["readerFooter_button","readerFooter_button_twoLines",{blue:n.payButtonDisplayInfos.isMCard}],attrs:{href:"javascript:"},on:{click:n.showPayDialog}},[r("span",{class:["line1",{withIcon:n.payButtonDisplayInfos.isMCard}],domProps:{innerHTML:n._s(n.payButtonDisplayInfos.lines[0])}}),1<n.payButtonDisplayInfos.lines.length?r("span",{staticClass:"line2",domProps:{innerHTML:n._s(n.payButtonDisplayInfos.lines[1])}}):n._e()]):n._e(),!n.isNeedPay&&n.hasNextChapter?r("a",{staticClass:"readerFooter_button",attrs:{title:"下一章",href:"javascript:"},on:{click:n.handleClickNextChapter}},[n._v("\n                    下一章\n                ")]):n._e(),r("a",{staticClass:"readerFooter_button blue",attrs:{href:"javascript:"},on:{click:n.downloadAppToRead}},[n._v("\n                    去微信读书 App 阅读本书\n                ")])]):r("div",[n.isNeedPay&&n.hasLogin&&n.canReceiveMemberCard?r("a",{staticClass:"readerFooter_button readerFooter_button_twoLines blue",attrs:{href:"javascript:"},on:{click:n.handleClickReceiveMemberCardButton}},[r("span",{staticClass:"line1 withIcon"},[n._v("送你一张无限卡 · 全场书籍免费读")])]):n._e(),n.isShowBuyMemberCardButton?r("a",{staticClass:"readerFooter_button readerFooter_button_twoLines blue",attrs:{href:"javascript:"},on:{click:n.downloadAppToMemberCard}},[r("span",{staticClass:"line1 withIcon"},[n._v(n._s(n.buyMemberCardButtonLine1))])]):n._e(),n.isNeedPay&&n.hasLogin&&!n.canReceiveMemberCard?r("a",{class:["readerFooter_button","readerFooter_button_twoLines",{blue:n.payButtonDisplayInfos.isMCard}],attrs:{href:"javascript:"},on:{click:n.showPayDialog}},[r("span",{class:["line1",{withIcon:n.payButtonDisplayInfos.isMCard}],domProps:{innerHTML:n._s(n.payButtonDisplayInfos.lines[0])}}),1<n.payButtonDisplayInfos.lines.length?r("span",{staticClass:"line2",domProps:{innerHTML:n._s(n.payButtonDisplayInfos.lines[1])}}):n._e()]):n._e(),n.isNeedShowLoginGuide?r("reader-login-guide",{ref:"readerLoginGuide",attrs:{"qr-code-img":n.loginGuideQRCodeImg,"get-uid-err":n.isLoginGetUidError,"get-info-err":n.isLoginGetInfoError,"loading-q-r-code":n.isLoginQRCodeLoading},on:{reload:n.checkIfNeedRequestLoginQRCode}}):n._e(),n.hasNextChapter?r("a",{staticClass:"readerFooter_button",attrs:{title:"下一章",href:"javascript:"},on:{click:n.handleClickNextChapter}},[n._v("\n                    下一章\n                ")]):n._e(),n.hasLogin&&!n.hasNextChapter?r("div",{staticClass:"readerFooter_ending"},[r("div",{staticClass:"line1"},[n._v(n._s(n.endingTexts[0]))]),1<n.endingTexts.length?r("div",{staticClass:"line2"},[n._v(n._s(n.endingTexts[1]))]):n._e()]):n._e()],1)]):n._e()],1),r("reader-controls",{ref:"readerControls",staticClass:"readerControls",attrs:{"disable-chapter-link":n.isBookInfoError,"is-show-search-hint":n.isShowAutoSearchHint,"search-hint-total-count":n.searchResult.totalCount||0,"disable-font-size-slider":"DONE"!==n.chapterContentState,"init-font-size-level":n.fontSizeLevel,"font-size-level-count":n.fontSizeLevelCount},on:{onClickItem:n.handleClickControls,fontSizeLevelChange:n.changeFontSize}}),r("reader-bottom-bar",{class:n.isPhoneBottomBarActive?"active":"",attrs:{"show-shadow":!n.isShowBottomSettingPanel,"show-add-shelf-button":n.showBottomBarAddShelfButton},on:{onClickItem:n.handleClickBottomBarItem}}),n.isShowBottomSettingPanel?r("reader-bottom-setting-panel",{on:{onClickItem:n.handleClickBottomSettingPanelItem}}):n._e(),r("reader-member-card-tips",{ref:"readerMemberCardTips",class:n.isPhoneBottomBarActive?"":"atBottom"}),r("reader-catalog",{ref:"readerCatalog",attrs:{"book-info":n.bookInfo,"member-card-summary":n.memberCardSummary,"chapter-infos":n.chapterInfos,"current-chapter":n.currentChapter,"current-chapter-anchor":n.currentChapterAnchor,"is-in-search-mode":n.isInSearchMode,"is-search-loading":n.isSearchLoading,"search-result":n.searchResult},on:{clickChapter:n.handleClickChapter,clickBookInfo:n.handleClickFirstChapter,search:n.doSearch,clickSearchItem:n.handleClickSearchItem,enterSearch:n.enterSearch,exitSearch:n.exitSearch}}),r("reader-note-panel",{ref:"readerNotePanel",attrs:{"book-info":n.bookInfo,"chapter-infos":n.chapterInfos,notes:n.notes},on:{clickNoteItem:n.handleClickNoteItem}}),n.isShowPayWholeDialog?r("pay-whole-book-dialog",{ref:"payWholeBookDialog",attrs:{"book-info":n.bookInfo,"member-card-summary":n.memberCardSummary,balance:n.balance},on:{doPay:n.payWholeBook}}):n._e(),n.isShowPayChapterDialog?r("pay-chapter-dialog",{ref:"payChapterDialog",attrs:{"book-info":n.bookInfo,chapters:n.chapterInfos,"member-card-summary":n.memberCardSummary,balance:n.balance},on:{doPay:n.payChapter}}):n._e()],1)}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},827:function(e,t,n){"use strict";function r(){var n=this,e=n.$createElement,r=n._self._c||e;return r("div",[r("BackgroundMask",{ref:"mask",attrs:{"needs-close-button":!1},on:{click:n.close}}),r("transition",{attrs:{name:"fade"},on:{enter:n.onShow}},[r("div",{directives:[{name:"show",rawName:"v-show",value:n.isShow,expression:"isShow"}],staticClass:"readerNotePanel"},[r("div",{staticClass:"readerNoteList"},[n._l(n.noteList,function(t){return r("reader-panel-section-list-item",{key:t.key,attrs:{"divider-left-indent":!0,"show-section-title":t.firstInChapter,"section-title":n.getNoteItemChapterTitle(t),"custom-content-class":n.getNoteItemContentClassNames(t)},on:{clickItem:function(e){return n.emitClickNoteItem(t)}}},[r("span",{staticClass:"icon"}),r("div",[t.star&&0<t.star?r("rank-bar",{attrs:{star:t.star,"custom-selector":"wr_rankBar_Small"}}):n._e(),r("div",{staticClass:"text"},[n._v(n._s(t.showText))]),t.abstract?r("div",{staticClass:"abstract"},[n._v(n._s(t.abstract))]):n._e()],1)])}),n.isLoading?r("reader-panel-list-loading-view"):n._e(),n.isLoading||0!==n.noteList.length?n._e():r("reader-panel-list-empty-view",[n._v("\n                    暂无笔记\n                ")])],2)])])],1)}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},829:function(e,t,n){"use strict";function r(){var n=this,e=n.$createElement,r=n._self._c||e;return r("div",{staticClass:"reader_topReview_contianer"},[r("div",{staticClass:"reader_topReview_header"},[r("p",{staticClass:"reader_topReview_title"},[n._v("精彩点评")]),r("ReviewStarControl",{staticClass:"reader_topReview_starControl",attrs:{title:"为此书评分","title-align":"right","init-score":0},on:{"emit-review-star-click":n.handleBookReviewClick}})],1),r("div",{staticClass:"reader_topReview_content"},n._l(n.reviewList,function(e,t){return r("div",{key:t,staticClass:"reader_topReview_item"},[r("div",{staticClass:"title"},[r("Avatar",{attrs:{clickable:!1,src:e.review.author.avatar,"custom-selector":"avatar"}}),r("span",{staticClass:"name"},[n._v(n._s(e.review.author.name))]),r("span",{staticClass:"action"},[n._v("点评")]),0<e.review.star?r("RankBar",{staticClass:"star",attrs:{star:e.review.star,"custom-selector":"wr_rankBar_Small"}}):n._e()],1),e.review.content&&0<e.review.content.length?r("p",{ref:"content",refInFor:!0,staticClass:"content content_Normal",on:{click:function(e){return n.handleContentClick(t)}}},[n._v(n._s(e.review.content))]):n._e()])}),0),r("div",{staticClass:"reader_topReview_footer"},[r("a",{staticClass:"reader_topReview_more",attrs:{href:n.bookReviewURL(n.bookId)},on:{click:function(e){return n.saveReportInfo("Reader_TopReview_MoreReviews_Clk")}}},[n._v("查看更多精彩评论")])])])}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},831:function(e,t,n){"use strict";function r(){var e=this,t=e.$createElement,n=e._self._c||t;return n("transition",{attrs:{name:"fade"},on:{enter:e.onShow}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.showing,expression:"showing"}],class:["readerMemberCardTips",e.customSelector]},[n("span",{staticClass:"icon"}),n("span",{staticClass:"text"},[e._v(e._s(e.text))])])])}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},834:function(e,t,n){"use strict";function r(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"readerLoginGuide"},[n("div",{staticClass:"readerLoginGuide_qrcode"},[e.loadingQRCode?n("div",{staticClass:"readerLoginGuide_qrcode_loading"},[n("Loading",{attrs:{zoom:"0.4"}})],1):e.getUidErr||e.getInfoErr?n("a",{staticClass:"readerLoginGuide_qrcode_retry",attrs:{href:"javascript:"},on:{click:e.emitReload}},[e._v("\n            重新加载\n        ")]):n("img",{attrs:{src:e.qrCodeImg,alt:"扫码登录",width:"100",height:"100"}})]),e._m(0)])}var o=[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"readerLoginGuide_right"},[t("div",{staticClass:"line1"},[this._v("扫码登录")]),t("div",{staticClass:"line2"},[this._v("获得更多专属福利 · 全场书籍免费读")])])}];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},835:function(e,t,n){"use strict";function r(){var e=this.$createElement;return(this._self._c||e)("style",{tag:"div"},[this._t("default")],2)}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},836:function(e,t,n){"use strict";function r(){var c=this,e=c.$createElement,t=c._self._c||e;return t("Dialog",{ref:"dialog",attrs:{"is-show-close-button":!1,"custom-selector":"payChapterDialogWrap"},on:{onShow:c.onShow}},[t("div",{staticClass:"payChapterDialog"},[t("div",{staticClass:"pcd_title"},[t("div",{staticClass:"pcd_bookTitle"},[c._v("购买章节")]),t("a",{staticClass:"pcd_selectAll",attrs:{href:"javascript:"},on:{click:c.toggleAllSelect}},[c._v(c._s(c.isSelectedAll?"取消全选":"全选"))])]),t("div",{ref:"scrollDom",staticClass:"pcd_content"},[t("ul",{staticClass:"pcd_chapter_list"},c._l(c.sections,function(s){return t("li",{key:s.key},[t("div",{class:["pcd_chapter_item",{selectable:0<s.unpaidPrice,checked:c.isTitleChecked(s)}],on:{click:function(e){return c.toggleSection(s)}}},[t("span",{class:["pcd_chapter_item_arrow",{expand:s.isExpand}],on:{click:function(e){return e.stopPropagation(),c.toggleSectionExpand(s)}}}),t("div",{staticClass:"pcd_chapter_item_content"},[t("div",{staticClass:"line1"},[c._v(c._s(s.title))]),t("div",{staticClass:"line2"},[c._v(c._s(s.isAllPaid?"已购":0<s.totalPrice?s.unpaidPrice.toFixed(2)+" 书币":"免费"))])]),0<s.unpaidPrice?t("input",{staticClass:"pcd_chapter_item_checkbox",attrs:{type:"checkbox"},domProps:{checked:c.isTitleChecked(s)},on:{change:function(e){return c.changeTitleChecked(s,e)}}}):c._e(),0<s.unpaidPrice?t("label",{staticClass:"pcd_chapter_item_checkbox_label"}):c._e()]),s.isExpand?t("ul",{staticClass:"pcd_section_content"},c._l(s.chapters,function(a){return t("li",{key:a.chapterUid,class:["pcd_chapter_item",{checked:-1!==s.selected.indexOf(a.chapterUid)}],attrs:{id:a.chapterUid===c.initSelectedChapterUid?"pcd_chapter_current":""},on:{click:function(e){return c.toggleChapter(s,a)}}},[t("div",{staticClass:"pcd_chapter_item_content"},[t("div",{staticClass:"line1"},[c._v("第"+c._s(a.chapterIdx)+"章 "+c._s(a.title))]),t("div",{staticClass:"line2"},[c._v(c._s(0<a.price?a.price.toFixed(2)+" 书币":"免费")+"\n                                ")])]),1===a.paid?t("span",[c._v("已购")]):c._e(),1!==a.paid&&0<a.price?t("input",{directives:[{name:"model",rawName:"v-model",value:s.selected,expression:"section.selected"}],staticClass:"pcd_chapter_item_checkbox",attrs:{type:"checkbox"},domProps:{value:a.chapterUid,checked:Array.isArray(s.selected)?-1<c._i(s.selected,a.chapterUid):s.selected},on:{change:function(e){var t=s.selected,n=e.target,r=!!n.checked;if(Array.isArray(t)){var o=a.chapterUid,i=c._i(t,o);n.checked?i<0&&c.$set(s,"selected",t.concat([o])):-1<i&&c.$set(s,"selected",t.slice(0,i).concat(t.slice(i+1)))}else c.$set(s,"selected",r)}}}):c._e(),1!==a.paid&&0<a.price?t("label",{staticClass:"pcd_chapter_item_checkbox_label"}):c._e()])}),0):c._e()])}),0)]),t("div",{staticClass:"pcd_actions"},[t("div",{staticClass:"pcd_actions_item",staticStyle:{"margin-top":"16px"}},[t("span",[c._v("已选")]),t("span",{staticClass:"pcd_actions_item_white"},[t("span",{staticClass:"pcd_actions_item_number"},[c._v(c._s(c.selectedChaptersSize))]),c._v("章\n                ")])]),t("div",{staticClass:"pcd_actions_item"},[t("span",[c._v(c._s(c.priceTitleWithMCardDiscount))]),t("span",[c.hasMCardDiscount&&0<c.selectedChaptersPrice?t("span",{staticClass:"pcd_actions_item_number pcd_actions_item_disabled"},[c._v("\n                        "+c._s(c.selectedChaptersPrice.toFixed(2))+"\n                    ")]):c._e(),t("span",{staticClass:"pcd_actions_item_blue pcd_actions_item_number"},[c._v("\n                        "+c._s(c.selectedChaptersPriceWithDiscount.toFixed(2))+"\n                    ")]),t("span",{staticClass:"pcd_actions_item_blue"},[c._v("书币")])])]),t("a",{class:{pcd_actions_buy:!0,disabled:!c.isValid},attrs:{href:"javascript:"},on:{click:c.emitDoPay}},[c.isNeedDeposit?t("span",{staticClass:"line1"},[c._v("去微信读书 App 充值")]):t("span",{staticClass:"line1"},[c._v("购买章节")])]),c.isNeedDeposit?t("div",{staticClass:"pcd_actions_account red"},[c._v("余额不足 · "+c._s(c.accountBalance)+" 书币")]):c.balance.hasFetched?t("div",{staticClass:"pcd_actions_account"},[c._v("余额 · "+c._s(c.accountBalance)+" 书币")]):c._e()])])])}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},837:function(e,t,n){"use strict";function r(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"readerControls"},[n("a",{class:{readerControls_item:!0,catalog:!0,disabled:t.disableChapterLink},attrs:{href:"javascript:",title:"目录"},on:{click:function(e){return t.emitClick("catalog")}}},[n("span",{staticClass:"icon"})]),n("a",{staticClass:"readerControls_item note",attrs:{href:"javascript:",title:"笔记"},on:{click:function(e){return t.emitClick("note")}}},[n("span",{staticClass:"icon"})]),n("div",{class:["readerControls_fontSize",{expand:t.isFontSizeExpand}]},[n("a",{staticClass:"fontSizeButton",attrs:{href:"javascript:",title:"字号"},on:{click:t.toggleFontSizeExpand}},[n("span",{staticClass:"fontSizeButton_bg"}),n("span",{staticClass:"icon"})]),n("div",{staticClass:"fontSizeSliderContainer"},[n("vue-slider",{ref:"fontSizeSlider",attrs:{lazy:!0,adsorb:!0,contained:!1,tooltip:"none",hideLabel:!0,duration:0,data:t.fontSizeLevels,marks:t.fontSizeLevels,disabled:t.disableFontSizeSlider,dotSize:9,processStyle:{display:"none"}},on:{change:t.emitFontSizeLevelChange},model:{value:t.fontSizeLevel,callback:function(e){t.fontSizeLevel=e},expression:"fontSizeLevel"}})],1)]),t.isFromWeReadApp?t._e():n("a",{class:["readerControls_item",{dark:t.isWhiteTheme,white:!t.isWhiteTheme}],attrs:{href:"javascript:",title:t.isWhiteTheme?"深色":"浅色"},on:{click:function(e){return t.emitClick("theme")}}},[n("span",{staticClass:"icon"})]),n("a",{staticClass:"readerControls_item download",attrs:{href:"javascript:",title:"下载App"},on:{click:function(e){return t.emitClick("download")}}},[n("span",{staticClass:"icon"})]),t.isShowSearchHint?n("a",{staticClass:"readerControls_catalog_hint",style:{minWidth:t.searchHintTotalCount?"120px":"60px"},attrs:{href:"javascript:"},on:{click:function(e){return t.emitClick("catalog")}}},[t._v("\n        "+t._s(t.searchHint)+"\n    ")]):t._e()])}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},838:function(e,t,n){"use strict";function r(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Dialog",{ref:"dialog",attrs:{"is-show-close-button":!1,"custom-selector":"payWholeBookDialogWrap"}},[n("div",{staticClass:"payDialog"},[n("div",{staticClass:"payDialog_content"},[n("div",{staticClass:"payDialog_price"},[e._v(e._s(e.payInfos.dialogPriceText))]),n("div",{class:["payDialog_account",{red:e.payInfos.isNeedDeposit}]},[e._v(e._s(e.payInfos.dialogAccountBalance))]),n("div",{staticClass:"payDialog_sectionTitle"},[e._v("书籍")]),n("div",{staticClass:"payDialog_sectionContent"},[e._v(e._s(e.bookInfo.title))]),n("div",{staticClass:"payDialog_sectionTitle"},[e._v("作者")]),n("div",{staticClass:"payDialog_sectionContent"},[e._v(e._s(e.bookInfo.author))])]),n("div",{staticClass:"payDialog_actions"},[n("a",{staticClass:"payDialog_action",attrs:{href:"javascript:"},on:{click:e.emitDoPay}},[e._v(e._s(e.payInfos.dialogBuyButtonText))])])])])}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},839:function(e,t,n){"use strict";function r(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"readerBookInfo"},[t.isEmptyBookInfo?t._e():n("div",{class:["readerBookInfo_head",{readerBookInfo_head_NoBookInfoMore:!t.showRating&&t.readingCount<=0}]},[n("book-cover",{attrs:{clickable:!0,src:t.bookInfo.cover||"","custom-selector":"bookInfo_cover","need-gradient-decor":!0},on:{click:t.emitClickStartReading}}),n("div",{staticClass:"bookInfo_right"},[n("h2",{staticClass:"bookInfo_title"},[t._v(t._s(t.bookInfo.title))]),n("div",{staticClass:"bookInfo_author_container"},[t.isSupportBook?n("a",{staticClass:"bookInfo_author link",attrs:{href:"/web/search/books?author="+encodeURIComponent(t.bookInfo.author)}},[t._v(t._s(t.bookInfo.author))]):n("span",{staticClass:"bookInfo_author"},[t._v(t._s(t.bookInfo.author))])]),t.needShowRankListImg?n("a",{class:["bookInfo_rankList",t.rankListCategoryClassName],attrs:{href:"/web/category/"+t.rankListCategoryId,target:"_blank"},on:{click:function(e){return t.saveReportInfo("ReaderInfo_Enter_Category")}}}):t._e(),0<t.introParaArray.length?n("div",{ref:"introDom",staticClass:"bookInfo_intro",on:{click:t.showIntroDialog}},[t._v("\n                "+t._s(t.introParaArray.join(" "))+"\n            ")]):t._e(),n("div",{class:{bookInfo_more:!0,bookInfo_more_2children:2===t.moreChildCount,bookInfo_more_3children:3===t.moreChildCount}},[t.showRating?n("div",{staticClass:"bookInfo_more_rating",on:{click:t.emitClickRatingButton}},[n("div",{staticClass:"bookInfo_more_line1"},[n("span",{staticClass:"bookInfo_more_line1_number"},[t._v(t._s(t.starString))]),n("rank-bar",{attrs:{star:t.bookInfo.star,"custom-selector":"bookInfo_score_rankBar"}})],1),n("div",{staticClass:"bookInfo_more_line2"},[t._v(t._s(t.ratingCountString)+"人点评")])]):t._e(),0<t.readingCount?n("div",{staticClass:"bookInfo_more_reading"},[n("div",{staticClass:"bookInfo_more_line1",domProps:{innerHTML:t._s(t.readingCountStrings[0])}}),n("div",{staticClass:"bookInfo_more_line2"},[t._v(t._s(t.readingCountStrings[1]))])]):t._e(),t.showAddShelfButton?n("a",{staticClass:"bookInfo_more_addShelf wr_btn wr_btn_Big",attrs:{href:"javascript:"},on:{click:t.emitClickAddShelf}},[t._v("加入书架")]):n("a",{staticClass:"bookInfo_more_addShelf wr_btn wr_btn_Big",attrs:{href:"javascript:"},on:{click:t.emitClickStartReading}},[t._v("开始阅读")])])])],1),t.chaptersToPreview&&0<t.chaptersToPreview.length?n("div",{staticClass:"readerBookInfo_chapterPreview"},[t._l(t.chaptersToPreview,function(e){return n("a",{staticClass:"item",attrs:{href:e.link}},[e.line1?n("div",{staticClass:"line1"},[t._v(t._s(e.line1))]):t._e(),e.line2?n("div",{class:{line2:!0,blue:e.isLine2Blue,title:e.isLine2Title}},[t._v(t._s(e.line2))]):t._e()])}),n("a",{staticClass:"item showAll",attrs:{href:"javascript:"},on:{click:t.emitClickShowCatalog}},[n("div",{staticClass:"line1"},[t._v("查看全部章节")]),n("div",{staticClass:"line2"},[t._v("共"+t._s(this.chapterInfos.length)+"章")])])],2):t._e(),t.canShowDownloadButton?n("a",{staticClass:"readerFooter_button blue",attrs:{href:"javascript:"},on:{click:t.emitDownloadApp}},[t._v("\n        去微信读书 App 阅读本书\n    ")]):t._e(),n("Dialog",{ref:"introDialog",attrs:{"custom-selector":"introDialogWrap"}},[n("div",{staticClass:"introDialog_content"},[0<t.introParaArray.length?n("h3",{staticClass:"introDialog_content_title"},[t._v("简介")]):t._e(),0<t.introParaArray.length?n("div",t._l(t.introParaArray,function(e){return n("p",{staticClass:"introDialog_content_intro_para"},[t._v(t._s(e))])}),0):t._e(),0<t.publishInfos.length?n("h3",{staticClass:"introDialog_content_title"},[t._v("版权")]):t._e(),t._l(t.publishInfos,function(e){return n("div",{class:{introDialog_content_pub_line:!0,long:t.isPublishInfoLong}},[n("span",{staticClass:"introDialog_content_pub_title"},[t._v(t._s(e.title))]),n("span",[t._v(t._s(e.content))])])})],2)])],1)}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},840:function(e,t,n){"use strict";function r(){var n=this,e=n.$createElement,r=n._self._c||e;return r("div",[r("BackgroundMask",{ref:"mask",attrs:{"needs-close-button":!1},on:{click:n.close}}),r("transition",{attrs:{name:"fade"},on:{enter:n.onShow}},[r("div",{directives:[{name:"show",rawName:"v-show",value:n.isShow,expression:"isShow"}],staticClass:"readerCatalog"},[r("div",{staticClass:"readerCatalog_searchBar"},[r("div",{staticClass:"readerCatalog_searchBar_left"},[r("input",{directives:[{name:"model",rawName:"v-model",value:n.searchKeyword,expression:"searchKeyword"}],attrs:{placeholder:"搜索",type:"text"},domProps:{value:n.searchKeyword},on:{keyup:function(e){return!e.type.indexOf("key")&&n._k(e.keyCode,"enter",13,e.key,"Enter")?null:n.debouncedDoSearch(e)},focus:n.handleInputFocused,input:function(e){e.target.composing||(n.searchKeyword=e.target.value)}}}),r("span",{staticClass:"readerCatalog_searchBar_enter",attrs:{title:"搜索"},on:{click:n.debouncedDoSearch}})]),n.isInSearchMode?r("span",{staticClass:"readerCatalog_searchCancel",on:{click:n.exitSearch}},[n._v("取消")]):n._e()]),n.isInSearchMode?r("div",{ref:"searchResultDom",staticClass:"rc_search"},[n._l(n.searchResult.resultList,function(t){return r("reader-panel-section-list-item",{key:t.searchIdx,attrs:{"show-section-title":t.firstInChapter,"section-title":n.getSearchResultChapterTitle(t),"custom-content-class":"rc_search_itemContent"},on:{clickItem:function(e){return n.emitClickSearchItem(t)}}},[r("span",{domProps:{innerHTML:n._s(n.getSearchResultChapterContent(t))}})])}),r("reader-panel-list-loading-view",{directives:[{name:"show",rawName:"v-show",value:n.isSearchLoading,expression:"isSearchLoading"}]}),!n.isSearchLoading&&n.searchResult.keyword&&0===n.searchResult.resultList.length?r("reader-panel-list-empty-view",[n._v("\n                    无结果\n                ")]):n._e()],2):n._e(),r("reader-catalog-book-info",{directives:[{name:"show",rawName:"v-show",value:!n.isInSearchMode,expression:"!isInSearchMode"}],staticClass:"readerCatalog_bookInfo",attrs:{"book-info":n.bookInfo},on:{clickBookInfo:n.handleClickBookInfo}}),r("div",{directives:[{name:"show",rawName:"v-show",value:!n.isInSearchMode,expression:"!isInSearchMode"}],staticClass:"readerCatalog_actions"},[r("div",{class:["readerCatalog_actions_inner",{empty:!n.needShowScroller}]},[n.needShowScroller?r("span",{class:{readerCatalog_scroller:!0,rotate:!this.isScrollToBottom},attrs:{"data-ignore-toolbar-update-hidden":"1"},on:{click:n.handleClickScroller}}):n._e()])]),r("ul",{directives:[{name:"show",rawName:"v-show",value:!n.isInSearchMode,expression:"!isInSearchMode"}],ref:"catalogListDom",staticClass:"readerCatalog_list"},n._l(n.chapterIndexes,function(t,e){return r("li",{key:e,class:["chapterItem",{chapterItem_current:t.isCurrent,chapterItem_disabled:n.isLock(t)}]},[r("a",{class:["chapterItem_link","chapterItem_level"+t.level],attrs:{href:"javascript:"},on:{click:function(e){return n.handleClickChapter(t)}}},[r("span",{staticClass:"chapterItem_text"},[n._v(n._s(n.getChapterTitle(t)))]),n.isLock(t)?r("span",{staticClass:"chapterItem_lock"}):n._e()])])}),0)],1)])],1)}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},841:function(e,t,n){"use strict";function r(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"readerBottomSettingPanel"},[n("div",{staticClass:"rbsp_inner"},[n("div",{staticClass:"rbsp_color"},[n("a",{class:["rbsp_color_item","white",{current:t.isWhiteTheme}],attrs:{href:"javascript:",title:"浅色模式"},on:{click:function(e){return t.emitClick("white")}}},[t._v("浅色模式")]),n("a",{class:["rbsp_color_item","dark",{current:!t.isWhiteTheme}],attrs:{href:"javascript:",title:"深色模式"},on:{click:function(e){return t.emitClick("dark")}}},[t._v("深色模式")])]),t.canShowDownload?n("a",{staticClass:"rbsp_download",attrs:{href:"javascript:"},on:{click:function(e){return t.emitClick("download")}}},[t._v("下载微信读书 App 使用更多功能")]):t._e()])])}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},842:function(e,t,n){"use strict";function r(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:["readerBottomBar",{showShadow:t.showShadow}]},[t._m(0),n("a",{staticClass:"rbb_item catalog",attrs:{title:"目录",href:"javascript:"},on:{click:function(e){return e.stopPropagation(),t.emitClick("catalog")}}},[n("span",{staticClass:"icon"}),n("span",{staticClass:"txt"},[t._v("目录")])]),n("a",{staticClass:"rbb_item setting",attrs:{title:"设置",href:"javascript:"},on:{click:function(e){return e.stopPropagation(),t.emitClick("setting")}}},[n("span",{staticClass:"icon"}),n("span",{staticClass:"txt"},[t._v("设置")])]),t.showAddShelfButton?n("a",{staticClass:"rbb_addShelf wr_btn wr_btn_Big",attrs:{href:"javascript:"},on:{click:function(e){return e.stopPropagation(),t.emitClick("shelf")}}},[n("span",{staticClass:"rbb_addShelf_icon"}),n("span",{staticStyle:{"vertical-align":"middle"}},[t._v("加入书架")])]):n("a",{staticClass:"rbb_addShelf wr_btn wr_btn_Big added",attrs:{href:"/web/shelf"},on:{click:function(e){return e.stopPropagation(),t.saveReportInfo("Reader_BottomBar")}}},[n("span",{staticClass:"rbb_addShelf_icon"}),n("span",{staticStyle:{"vertical-align":"middle"}},[t._v("去书架查看")])])])}var o=[function(){var e=this.$createElement,t=this._self._c||e;return t("a",{staticClass:"rbb_item home",attrs:{title:"书城",href:"/"}},[t("span",{staticClass:"icon"}),t("span",{staticClass:"txt"},[this._v("书城")])])}];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},843:function(e,t,n){"use strict";function r(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"readerTopBar"},[n("a",{staticClass:"readerTopBar_home",attrs:{href:"/",title:"微信读书书城"},on:{click:function(e){return t.saveReportInfo("Reader_Home")}}},[t._v("微信读书书城")]),n("span",{staticClass:"readerTopBar_title"},[n("a",{staticClass:"readerTopBar_title_link",attrs:{href:"javascript:"},on:{click:function(e){return t.emitClickItem("firstChapter")}}},[t._v(t._s(t.bookTitleString))]),n("span",{staticClass:"readerTopBar_title_chapter"},[t._v(t._s(t.chapterTitleString))])]),n("div",{staticClass:"readerTopBar_actions"},[t.isShowAddShelf?n("a",{staticClass:"actionItem addShelfItem added",attrs:{href:"javascript:"},on:{click:function(e){return t.emitClickItem("addShelf")}}},[t._v("\n            加入书架\n        ")]):n("a",{staticClass:"actionItem addShelfItem",attrs:{href:"/web/shelf"},on:{click:function(e){return t.saveReportInfo("Reader_NavBar")}}},[t._v("\n            去书架查看\n        ")])]),n("div",{staticClass:"readerTopBar_right"},[t.hasLogin?n("Menu",{ref:"topBar_avatarMenu",staticClass:"js_reader_navBarMenu",attrs:{defaultSelectedIndex:0,optionList:t.avatarOptionList,align:"right"},on:{"handle-click-menu-option":t.handleClickAvatarMenuOption}},[n("avatar",{attrs:{clickable:!0,src:t.user.avatar,"custom-selector":"readerTopBar_avatar"},on:{click:t.handleClickAvatar}})],1):t._e(),t.canShowLogin?n("a",{staticClass:"actionItem",attrs:{href:"javascript:"},on:{click:function(e){return t.emitClickItem("login")}}},[t._v("\n            登录\n        ")]):t._e()],1)])}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},847:function(e,t,n){"use strict";function r(){var e=this.$createElement,t=this._self._c||e;return this.showing?t("div",[t("div",{staticClass:"reader_footerNote_mask",on:{click:this.handleMaskClick}}),t("div",{ref:"footerNote_container",staticClass:"reader_footerNote_container",style:this.customStyle},[t("div",{ref:"footerNote_bubble",staticClass:"reader_footerNote_bubble"},[t("p",{staticClass:"reader_footerNote_text"},[this._v(this._s(this.text))])])])]):this._e()}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},848:function(e,t,n){"use strict";function r(){var e=this.$createElement,t=this._self._c||e;return t("Dialog",{ref:"dialog"},[t("div",{staticClass:"rcv_succ_dialog_content"},[t("div",{staticClass:"rcv_succ_dialog_head"},[t("span",{staticClass:"rcv_succ_dialog_img"}),t("div",{staticClass:"rcv_succ_dialog_title"},[this._v(this._s(this.titleText))])]),t("div",{staticClass:"rcv_succ_dialog_foot"},[t("img",{staticClass:"rcv_succ_dialog_foot_qrcode",attrs:{src:this.qrCodeImg,alt:"扫码下载"}}),t("div",{staticClass:"rcv_succ_dialog_foot_right"},[t("div",{staticClass:"line1"},[this._v("下载微信读书 App")]),t("div",{staticClass:"line2"},[this._v("获得更多福利· 全场书籍免费读")])])])])])}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},850:function(e,t,n){"use strict";function r(){var n=this,e=n.$createElement,r=n._self._c||e;return r("div",{directives:[{name:"show",rawName:"v-show",value:n.showing,expression:"showing"}],ref:"toolbarContainer",class:["reader_toolbar_container",{below:n.isBelow}],style:n.posStyle},[r("div",{staticClass:"reader_toolbar_content"},[r("div",{staticClass:"reader_toolbar_itemContainer"},n._l(n.showItems,function(t){return r("a",{key:t.key,class:["toolbarItem"].concat(t.classNames),attrs:{href:"javascript:"},on:{click:function(e){return e.stopPropagation(),n.handleClickItem(t)}}},[r("span",{staticClass:"icon"}),r("span",{staticClass:"text"},[n._v(n._s(t.text))])])}),0)]),r("span",{staticClass:"arrow",style:n.arrowStyle})])}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},851:function(e,t,n){"use strict";function r(){var n=this,e=n.$createElement,r=n._self._c||e;return r("transition",{attrs:{name:"fade"}},[r("div",{directives:[{name:"show",rawName:"v-show",value:n.showing,expression:"showing"}],staticClass:"readerReviewDetailPanel"},[0<n.reviewNotes.length?r("div",{staticClass:"readerReviewDetailPanel_bg",attrs:{id:"readerReviewDetailPanel"}},n._l(n.reviewNotes,function(t){return r("div",{staticClass:"readerReviewDetail_item"},[r("div",{staticClass:"title"},[r("avatar",{attrs:{clickable:!1,src:t.author.avatar,"custom-selector":"avatar"}}),r("span",{staticClass:"name"},[n._v(n._s(t.author.name))]),t.isPrivate?r("span",{staticClass:"status private"},[r("span",{staticClass:"icon"}),n._v("仅自己可见")]):t.isFriendShip?r("span",{staticClass:"status friendship"},[r("span",{staticClass:"icon"}),n._v("仅互相关注可见")]):n._e()],1),r("div",{staticClass:"content"},[n._l(n.reviewContentParagraphs(t),function(e){return[n._v(n._s(e)),r("br")]})],2),r("div",{staticClass:"actions"},[r("a",{staticClass:"actionItem",attrs:{href:"javascript:"},on:{click:function(e){return n.emitClickItem("delete",t)}}},[n._v("删除")])])])}),0):n._e()])])}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},852:function(e,t,n){"use strict";function r(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sectionListItem"},[e.showSectionTitle?n("div",{staticClass:"sectionListItem_title"},[e._v(e._s(e.sectionTitle))]):n("div",{class:["sectionListItem_divider",{leftIndent:e.dividerLeftIndent}]}),n("a",{class:["sectionListItem_content",e.customContentClass],attrs:{href:"javascript:"},on:{click:e.emitClickItem}},[e._t("default")],2)])}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},853:function(e,t,n){"use strict";function r(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a",{staticClass:"readerCatalog_bookInfo",attrs:{href:"javascript:"},on:{click:e.emitClickBookInfo}},[n("book-cover",{attrs:{"custom-selector":"readerCatalog_bookInfo_cover",src:e.bookInfo.cover||"","need-gradient-decor":!0}}),n("div",{staticClass:"readerCatalog_bookInfo_right"},[n("h2",{staticClass:"readerCatalog_bookInfo_title"},[n("span",{staticClass:"readerCatalog_bookInfo_title_txt"},[e._v(e._s(e.bookInfo.title))]),n("span",{staticClass:"readerCatalog_bookInfo_title_arrow"})]),n("div",{staticClass:"readerCatalog_bookInfo_author"},[e._v(e._s(e.bookInfo.author))]),e.updateTimeString?n("div",{staticClass:"readerCatalog_bookInfo_updateTime"},[e._v(e._s(e.updateTimeString))]):e._e()])],1)}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},854:function(e,t,n){"use strict";function r(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"panelListEmptyView"},[this._t("default")],2)}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},855:function(e,t,n){"use strict";function r(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"panelListLoadingView"},[t("Loading",{attrs:{zoom:"0.3"}})],1)}var o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})}}]);