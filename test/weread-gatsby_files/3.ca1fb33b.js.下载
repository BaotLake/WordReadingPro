(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{569:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ReviewListTypeBookTop=3,t.ReviewListTypeBookFriendTop=4,t.ReviewListTypeNote=11},570:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ReviewTypeDiscuss=1,t.ReviewTypeRecommend=4},571:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChapterIdxRecommend=t.NoteTypeReview=t.NoteTypeBookmark=t.ReviewNote=t.BookmarkNote=t.Note=void 0;var r=l(i(285)),o=l(i(286)),n=l(i(287)),a=l(i(194)),s=l(i(195)),u=l(i(677)),c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}}(i(570));function l(e){return e&&e.__esModule?e:{default:e}}var d=Number.MAX_VALUE,f=((0,s.default)(v,null,[{key:"fromBookmark",value:function(e){return new p(0,e)}},{key:"fromReview",value:function(e){return new m(1,e)}},{key:"parseRangeString",value:function(e){var t=(e||"").split("-");return new u.default(t[0]?parseInt(t[0]):-1,t[1]?parseInt(t[1]):-1)}},{key:"sortedNoteList",value:function(e,t){var i=[],n=e.map(function(e){return v.fromBookmark(e)});i=i.concat(n);var r=t.map(function(e){return v.fromReview(e)});(i=i.concat(r)).sort(function(e,t){return e.compareTo(t)});var o=null;return i.forEach(function(e){e.updateFirstInChapter(o),o=e}),i}}]),(0,s.default)(v,[{key:"compareTo",value:function(e){if(this.chapterIdx!==e.chapterIdx)return this.chapterIdx<e.chapterIdx?-1:1;var t=this.range.start,i=e.range.start;if(t!==i)return t<i?-1:1;var n=this.createTime,r=e.createTime;return n!==r?r<n?-1:1:0}},{key:"updateFirstInChapter",value:function(e){e&&this.chapterIdx===e.chapterIdx?this.firstInChapter=!1:this.firstInChapter=!0}}]),v);function v(e){(0,a.default)(this,v),this.noteType=e,this.chapterUid=-1,this.chapterIdx=-1,this.range=new u.default(-1,-1),this.firstInChapter=!1,this.key=-1,this.showText="",this.createTime=0}var h,p=(h=f,(0,n.default)(_,h),_);function _(e,t){(0,a.default)(this,_);var i=(0,o.default)(this,(_.__proto__||(0,r.default)(_)).call(this,e));return void 0===t&&console.error("Note-Bookmark-Constructor, bookmark is undefined"),i.chapterUid=t.chapterUid,i.chapterIdx=t.chapterIdx,i.range=f.parseRangeString(t.range),i.key=t.bookmarkId,i.showText=t.markText,i.createTime=t.createTime,i.style=t.style||0,i.type=t.type,i.bookmarkId=t.bookmarkId,i}var w,m=(w=f,(0,n.default)(k,w),k);function k(e,t){(0,a.default)(this,k);var i=(0,o.default)(this,(k.__proto__||(0,r.default)(k)).call(this,e)),n=t.review;return void 0===n&&console.error("Note-ReviewNote-Constructor, reviewItem is undefined"),i.chapterUid=n.chapterUid,n.type===c.ReviewTypeRecommend?i.chapterIdx=d:void 0===n.chapterIdx?i.chapterIdx=d:i.chapterIdx=n.chapterIdx,i.range=f.parseRangeString(n.range),i.key=n.reviewId,i.showText=n.content,i.createTime=n.createTime,i.type=n.type,i.reviewId=n.reviewId,i.isPrivate=1===n.isPrivate,i.isFriendShip=1===n.friendship,i.author=n.author,i.abstract=n.abstract||"",i.star=n.star||0,i}t.Note=f,t.BookmarkNote=p,t.ReviewNote=m,t.NoteTypeBookmark=0,t.NoteTypeReview=1,t.ChapterIdxRecommend=d},619:function(e,t,i){"use strict";i.r(t);var n=i(620),r=i.n(n);for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);t.default=r.a},620:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(i(684)),r=s(i(624)),o=s(i(44)),a=s(i(280));function s(e){return e&&e.__esModule?e:{default:e}}t.default={name:"WriteBookReviewDialog",components:{Dialog:o.default,WriteReviewPanel:n.default,ReviewStarControl:r.default},data:function(){return{curUser:{},bookId:"",score:0,canSubmit:!1,isSending:!1,isSendedSucc:!1,submitCallback:null,beforeSubmitCallback:null}},created:function(){(0,a.default)()},computed:{panel:function(){return this.$refs.panel},dialog:function(){return this.$refs.dialog}},mounted:function(){this.$nextTick(function(){})},methods:{showDialog:function(e,t,i){var n=0<arguments.length&&void 0!==e?e:{},r=this,o=t,a=i;o&&(this.beforeSubmitCallback=o),a&&(this.submitCallback=a),n.user&&(this.curUser=n.user),n.bookId&&(this.bookId=n.bookId),n.score&&(this.score=n.score,this.$nextTick(function(){var e=r.$refs.starControl;e&&e.updateScore(r.score)})),this.updateSubmitButtonAppearance(),this.$refs.dialog.showDialog()},closeDialog:function(){this.dialog.closeDialog()},handleDidShowDialog:function(){this.panel.focusEditor()},handleDidHideDialog:function(){if(this.isSendedSucc){this.panel&&this.panel.resetPanelData();var e=this.$refs.starControl;e&&e.updateScore(0),this.score=0,this.canSubmit=!1,this.isSending=!1,this.isSendedSucc=!1,this.updateSubmitButtonAppearance()}else this.$hideToast()},setIsSending:function(e){this.isSending=e},getIsSending:function(){return this.isSending},setIsSendedSucc:function(e){this.isSendedSucc=e},handleClickDialog:function(){this.dialog&&this.panel&&this.panel.hidePrivateMenu()},updateSubmitButtonAppearance:function(){if(0<this.score)this.canSubmit=!0;else{if(this.panel){var e=this.panel.getReviewText();if(e&&e.length)return void(this.canSubmit=!0)}this.canSubmit=!1}},handleTextAreaChange:function(){this.updateSubmitButtonAppearance()},handleSubmitEvent:function(){if(this.canSubmit){var e=this.panel.getReviewText(),t=this.panel.getReviewHtml(),i=this.panel.getPrivateState();console.log("[zhoonlog] text = "+e+" html = "+t+" private = "+i+" score = "+this.score),this.beforeSubmitCallback&&this.beforeSubmitCallback(),this.submitCallback&&(this.reportClientBusiness({itemName:"Web_WriteBookReview_Submit_"+(0===i?"Publish":1===i?"Follow":"Secret"),vid:this.curUser.vid||0}),this.submitCallback({bookId:this.bookId,content:e,star:this.score,isPrivate:i}))}},handleBookReviewClick:function(e){var t=e.score;this.score=t,this.reportClientBusiness({itemName:"Web_WriteBookReview_Select_Star",vid:this.curUser.vid||0}),this.updateSubmitButtonAppearance()},handleTextAreaFocusEvent:function(){}}}},621:function(e,t,i){"use strict";i.r(t);var n=i(622),r=i.n(n);for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);t.default=r.a},622:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(282)),r=i(64),o=a(r);function a(e){return e&&e.__esModule?e:{default:e}}var s=i(9),u=i(22),c=["公开","关注","私密"];t.default={name:"WriteReviewPanel",components:{Menu:n.default},props:{curUser:{type:Object,require:!1,default:{}},editable:{type:Boolean,require:!1,default:!0},initPrivateState:{type:Number,require:!0},placeholder:{type:String,require:!1,default:"点评这本书..."},isShowReviewIcon:{type:Boolean,default:!1},isWritingBookReview:{type:Boolean,required:!0}},created:function(){s.isEnvClient&&(this.debouncedContentChanged=u.debounce(this.emitTextAreaChangeText,200))},data:function(){return{content:"",curPrivateState:-1,privateOptions:c,debouncedContentChanged:null}},watch:{content:function(e,t){e!==t&&this.debouncedContentChanged&&this.debouncedContentChanged()}},mounted:function(){if(s.isEnvClient){var e=o.default.getLocalSettingOperator();null!==e.getValueWithType(r.LOCAL_SETTING_OBJ_KEYS.DEPRECATED_WRITE_REVIEW_PRIVATE_STATE,"number")&&(delete e.value[r.LOCAL_SETTING_OBJ_KEYS.DEPRECATED_WRITE_REVIEW_PRIVATE_STATE],e.save())}},computed:{privateText:function(){return-1===this.curPrivateState?c[this.initPrivateState]:c[this.curPrivateState]},privateIconClass:function(){function e(e){switch(e){case 0:return"writeReview_private_button_Publish";case 1:return"writeReview_private_button_Follow";case 2:return"writeReview_private_button_Private"}}return-1===this.curPrivateState?e(this.initPrivateState):e(this.curPrivateState)}},methods:{showPrivateMenu:function(){var e=this.$refs.writeReview_footer_Menu;e&&e.showMenu()},hidePrivateMenu:function(){var e=this.$refs.writeReview_footer_Menu;e&&e.hideMenu()},resetPanelData:function(){this.content="",this.curPrivateState=-1},emitSubmitEvent:function(){this.$emit("handle-submit-event")},emitTextAreaChangeText:function(){this.$emit("handle-textarea-change")},emitFocusEvent:function(){this.hidePrivateMenu(),this.$emit("handle-focus-event")},emitPrivateStateChange:function(e){this.$emit("private-state-change",e)},handlePrivateButtonClick:function(){this.reportClientBusiness({itemName:this.isWritingBookReview?"Web_WriteBookReviewPanel_Private_Clk":"Web_WriteReviewPanel_Private_Clk",vid:this.curUser.vid||0}),this.showPrivateMenu()},handleClickMenuOption:function(e){var t=e.index;if(-1!==[0,1,2].indexOf(t))switch(this.curPrivateState=t,this.emitPrivateStateChange(t),t){case 0:this.reportClientBusiness({itemName:this.isWritingBookReview?"Web_WriteBookReviewPanel_Publish_Clk":"Web_WriteReviewPanel_Publish_Clk",vid:this.curUser.vid||0});break;case 1:this.reportClientBusiness({itemName:this.isWritingBookReview?"Web_WriteBookReviewPanel_Follow_Clk":"Web_WriteReviewPanel_Follow_Clk",vid:this.curUser.vid||0});break;case 2:this.reportClientBusiness({itemName:this.isWritingBookReview?"Web_WriteBookReviewPanel_Secret_Clk":"Web_WriteReviewPanel_Secret_Clk",vid:this.curUser.vid||0})}},getReviewText:function(){var e=this.$refs.textarea;return e?e.value:""},getReviewHtml:function(){return this.getReviewText()},getPrivateState:function(){return-1===this.curPrivateState?this.initPrivateState:this.curPrivateState},focusEditor:function(){if(this.editable){var e=this.$refs.textarea;e&&e.focus&&e.focus()}}}}},623:function(e,t,i){},624:function(e,t,i){"use strict";i.r(t);var n=i(833),r=i(625);for(var o in r)"default"!==o&&function(e){i.d(t,e,function(){return r[e]})}(o);i(752);var a=i(3),s=Object(a.a)(r.default,n.a,n.b,!1,null,null,null);t.default=s.exports},625:function(e,t,i){"use strict";i.r(t);var n=i(626),r=i.n(n);for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);t.default=r.a},626:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"ReviewStarControl",props:{initScore:{type:Number,require:!1,default:0},title:{type:String,require:!1,default:""},titleAlign:{type:String,require:!1,default:"left"},canSelect:{type:Boolean,require:!1,default:!1},starSize:{type:Number,require:!1,default:24},starSpace:{type:Number,require:!1,default:4}},data:function(){return{score:-1}},computed:{normalStarCount:function(){return 5},selectedStarCount:function(){return this.canSelect?0<this.score?Math.round(this.score/20):Math.round(this.initScore/20):0},starContentStyle:function(){var e=[];return e.push("width: "+(this.starSize*this.normalStarCount+this.starSpace*(this.normalStarCount-1))+"px;"),e.push("height: "+this.starSize+"px;"),e.join("")},titleStyle:function(){var e=[];return e.push("text-align: "+this.titleAlign+";"),e.join("")}},methods:{updateScore:function(e){this.score=e},handleClickControlEvent:function(e){for(var t=e.target,i=Number(t.getAttribute("data-index")),n=document.querySelectorAll(".review_starControl_normal .normal_starItem"),r=0;r<n.length;r++){var o=n[r],a=Number(o.getAttribute("data-index"));if(o&&a===i){this.updateScore(20*a);break}}0<this.score&&this.$emit("emit-review-star-click",{score:this.score})}}}},627:function(e,t,i){},628:function(e,t,i){},629:function(e,t,i){"use strict";i.r(t);var n=i(630),r=i.n(n);for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);t.default=r.a},630:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(i(684)),r=o(i(64));function o(e){return e&&e.__esModule?e:{default:e}}t.default={name:"ReaderWriteReviewPanel",components:{WriteReviewPanel:n.default},data:function(){return{showing:!1,curUser:null,bookInfo:null,initPrivateState:0,canSubmit:!1,isSending:!1,isSendedSucc:!1,submitCallback:null,beforeSubmitCallback:null,onHide:null}},computed:{panel:function(){return this.$refs.panel}},methods:{show:function(e){this.beforeSubmitCallback=e.beforeSubmitCallback,this.submitCallback=e.submitCallback,this.onHide=e.onHide,this.curUser=e.curUser,this.bookInfo=e.bookInfo,this.initPrivateState=this.computeInitPrivateState(e.bookInfo),this.showing=!0},hide:function(){this.showing&&(this.selfOnHide(),this.showing=!1,this.onHide&&this.onHide())},isShowing:function(){return this.showing},computeInitPrivateState:function(e){var t=this.curUser?this.curUser.vid:"",i=r.default.getWriteReviewPrivateStateOperator(t);if(i.exist){var n=i.get(e.bookId);if(null!==n&&-1!==[0,1,2].indexOf(n))return n}return e&&1===e.secret?2:0},handlePrivateStateChange:function(e){var t=this.bookInfo?this.bookInfo.bookId:"",i=this.curUser?this.curUser.vid:"";if(t&&i){var n=r.default.getWriteReviewPrivateStateOperator(i);n.set(t,e),n.save()}},onShow:function(){this.panel.focusEditor()},selfOnHide:function(){this.isSendedSucc?(this.panel&&this.panel.resetPanelData(),this.canSubmit=!1,this.isSending=!1,this.isSendedSucc=!1,this.updateSubmitButtonAppearance()):this.$hideToast()},setIsSending:function(e){this.isSending=e},getIsSending:function(){return this.isSending},setIsSendedSucc:function(e){this.isSendedSucc=e},handleClickDialog:function(){this.panel.hidePrivateMenu()},updateSubmitButtonAppearance:function(){var e=this.panel.getReviewText();this.canSubmit=e&&e.length},handleTextAreaChange:function(){this.updateSubmitButtonAppearance()},handleSubmitEvent:function(){if(this.canSubmit){var e=this.panel.getReviewText(),t=this.panel.getPrivateState();this.beforeSubmitCallback&&this.beforeSubmitCallback(),this.submitCallback&&(this.reportClientBusiness({itemName:"Web_WriteReview_Submit_"+(0===t?"Publish":1===t?"Follow":"Secret"),vid:this.curUser.vid||0}),this.submitCallback({content:e,isPrivate:t}))}}}}},631:function(e,t,i){},676:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=u(i(523)),n=u(i(134)),l=u(i(132));t.default=function(){var e,t;return{state:{bookInfo:{},reviewSingle:{},topReviews:{reviewListType:v.ReviewListTypeBookTop,synckey:0,reviewList:[],totalCount:0,isFetching:!1,hasMore:!1},topFriendReviews:{reviewListType:v.ReviewListTypeBookFriendTop,synckey:0,reviewList:[],totalCount:0,isFetching:!1,hasMore:!1},noteReviews:{reviewListType:v.ReviewListTypeNote,synckey:0,reviewList:[],totalCount:0,isFetching:!1,hasMore:!1},bookmarks:{bookmarkList:[],isFetching:!1}},getters:{notes:function(e){var t=e.bookmarks,i=e.noteReviews,n=r.Note.sortedNoteList(t.bookmarkList,i.reviewList);return{isFetching:t.isFetching||i.isFetching,noteList:n,reviewSynckey:i.synckey}}},mutations:(e={},(0,n.default)(e,d.UPDATE_BOOK_REVIEW_BOOK_INFO,function(e,t){e.bookInfo=t}),(0,n.default)(e,d.UPDATE_BOOK_REVIEW_SINGLE,function(e,t){e.reviewSingle=t}),(0,n.default)(e,d.UPDATE_BOOK_REVIEW_LIST,function(e,t){var i=t.reviewListType,n=t.reviewList,r=t.removed,o=t.totalCount,a=t.hasMore,s=t.append,u=m(i);if(u&&e[u]){i!==v.ReviewListTypeBookTop&&i!==v.ReviewListTypeBookFriendTop||(n=n.filter(function(e){return void 0!==e.review&&e.review.type===h.ReviewTypeRecommend}));var c=s?e[u].reviewList:[];0!==r.length&&(c=c.filter(function(e){return-1===r.indexOf(e.reviewId)})),n.forEach(function(e){void 0!==e.review&&c.push(e)}),e[u]=(0,l.default)({},e[u],{reviewList:c,totalCount:o,hasMore:a})}}),(0,n.default)(e,d.UPDATE_BOOK_REVIEW_LIST_SYNC_KEY,function(e,t){var i=t.listType,n=t.synckey,r=m(i);r&&e[r]&&(e[r]=(0,l.default)({},e[r],{synckey:n}))}),(0,n.default)(e,d.UPDATE_BOOK_REVIEW_FETCHING,function(e,t){var i=t.listType,n=t.isFetching,r=m(i);r&&e[r]&&(e[r]=(0,l.default)({},e[r],{isFetching:n}))}),(0,n.default)(e,d.UPDATE_BOOK_BOOKMARK_LIST,function(e,t){var i=t.bookmarkList,n=t.chapters,r={};n.forEach(function(e){r[e.chapterUid]=e}),i.forEach(function(e){var t=r[e.chapterUid];e.chapterIdx=t?t.chapterIdx:-1}),e.bookmarks=(0,l.default)({},e.bookmarks,{bookmarkList:i})}),(0,n.default)(e,d.UPDATE_BOOK_BOOKMARK_LIST_FETCHING,function(e,t){var i=t.isFetching;e.bookmarks=(0,l.default)({},e.bookmarks,{isFetching:i})}),(0,n.default)(e,d.INSERT_BOOKMARK_INTO_LIST,function(e,t){var i=e.bookmarks.bookmarkList;i.push(t),e.bookmarks=(0,l.default)({},e.bookmarks,{bookmarkList:i})}),(0,n.default)(e,d.REMOVE_BOOKMARK_FROM_LIST,function(e,t){for(var i=e.bookmarks.bookmarkList,n=-1,r=0,o=i.length;r<o;r++)i[r].bookmarkId===t&&(n=r);-1!==n&&i.splice(n,1),e.bookmarks=(0,l.default)({},e.bookmarks,{bookmarkList:i})}),(0,n.default)(e,d.UPDATE_BOOKMARK_IN_LIST,function(e,t){for(var i=t.bookmarkId,n=t.style,r=e.bookmarks.bookmarkList,o=0,a=r.length;o<a;o++){var s=r[o];if(s.bookmarkId===i){s.style=n;break}}e.bookmarks=(0,l.default)({},e.bookmarks,{bookmarkList:r})}),e),actions:(t={},(0,n.default)(t,s.FETCH_BOOK_REVIEW_BOOK_INFO,function(e,t){var i=e.commit,n=e.dispatch,r=t.bookId,o=t.envConfig||{},a=t.isLogin||!1;return(!r||r.length<=0)&&(console.log("[zhoonlog] bookInfo no bookId"),_.isEnvClient&&_.inDevelopment()&&alert("bookInfo no bookId")),n(s.FETCH_BOOK_INFO,{bookId:r,isLogin:a,envConfig:o}).then(function(e){var t=e||{};i(d.UPDATE_BOOK_REVIEW_BOOK_INFO,t)}).catch(function(e){console.log("[zhoonlog] bookInfo err = "+e)})}),(0,n.default)(t,s.FETCH_BOOK_REVIEW_LIST,function(e,t){var s=e.commit,i=t.bookId,n=t.envConfig||{},u=t.append||!1;i||(console.log("[zhoonlog] review list no bookId"),_.isEnvClient&&_.inDevelopment()&&alert("review lsit no bookId"));var c={bookId:i};return c.listType=w.get(t,"listType",v.ReviewListTypeBookTop),c.maxIdx=w.get(t,"maxIdx",0),c.count=w.get(t,"count",20),c.listMode=2,c.synckey=w.get(t,"synckey",0),void 0!==t.userVid&&(c.userVid=t.userVid),void 0!==t.mine&&(c.mine=t.mine),s(d.UPDATE_BOOK_REVIEW_FETCHING,{listType:c.listType,isFetching:!0}),(0,o.default)("/web/review/list",(0,l.default)({},c,n)).then(function(e){var t=e.data,i=w.get(t,"reviews",[]),n=w.get(t,"removed",[]),r=w.get(t,"totalCount",0),o=i.length>=c.count,a=w.get(t,"synckey",0);return s(d.UPDATE_BOOK_REVIEW_LIST,{reviewListType:c.listType,reviewList:i,removed:n,totalCount:r,hasMore:o,append:u}),s(d.UPDATE_BOOK_REVIEW_FETCHING,{listType:c.listType,isFetching:!1}),s(d.UPDATE_BOOK_REVIEW_LIST_SYNC_KEY,{listType:c.listType,synckey:a}),e}).catch(function(e){return s(d.UPDATE_BOOK_REVIEW_FETCHING,{listType:c.listType,isFetching:!1}),console.log("[zhoonlog] review list err = "+e),e})}),(0,n.default)(t,s.FETCH_BOOK_REVIEW_SINGLE,function(e,t){var i=e.commit,n=t.reviewId;return n||(console.log("[zhoonlog] reviewSingle no reviewId"),_.isEnvClient&&_.inDevelopment()&&alert("reviewSingle no reviewId")),(0,o.default)("/web/review/single",{reviewId:n}).then(function(e){var t=w.get(e,"res.data.review",{});return i(d.UPDATE_BOOK_REVIEW_SINGLE,t),e}).catch(function(e){return console.log("[zhoonlog] reviewSingle err = "+e),e})}),(0,n.default)(t,s.FETCH_BOOK_REVIEW_ADD,function(e,t){(0,f.default)(e);var i={type:t.type||h.ReviewTypeRecommend,bookId:"",chapterUid:0,content:"",bookVersion:0},n=t.bookId,r=t.content,o=t.star,a=t.chapterUid,s=t.isPrivate,u=t.abstract,c=t.refReviewId,l=t.range,d=t.isLike;return!n||n.length<=0?(console.log("[zhoonlog] add review no bookId"),_.isEnvClient&&_.inDevelopment()&&alert("add review no bookId")):i.bookId=n,(!o||o<=0)&&(!r||r.length<=0)&&(console.log("[zhoonlog] add review content"),_.isEnvClient&&_.inDevelopment()&&alert("add review no content")),r&&(i.content=r),a&&(i.chapterUid=a),o&&(i.star=o),1===s&&(i.friendship=1),2===s&&(i.isPrivate=1),u&&(i.abstract=u),d&&(i.isLike=d),c&&(i.refReviewId=c),l&&(i.range=l),(0,p.default)("/web/review/add",i).then(function(e){return e}).catch(function(e){return e})}),(0,n.default)(t,s.FETCH_BOOK_REVIEW_DELETE,function(e,t){(0,f.default)(e);var i=t.reviewId;return i||(console.log("[zhoonlog] reviewDelete no reviewId"),_.isEnvClient&&_.inDevelopment()&&alert("reviewSingle no reviewId")),(0,p.default)("/web/review/delete",{reviewId:i}).then(function(e){return e}).catch(function(e){return e})}),(0,n.default)(t,s.FETCH_BOOK_BOOKMARK_LIST,function(e,t){var n=e.commit,i=t.bookId;if(i){var r={bookId:i};return t.type&&(r.type=t.type),n(d.UPDATE_BOOK_BOOKMARK_LIST_FETCHING,{isFetching:!0}),(0,o.default)("/web/book/bookmarklist",r).then(function(e){var t=w.get(e.data,"updated",[]),i=w.get(e.data,"chapters",[]);return n(d.UPDATE_BOOK_BOOKMARK_LIST,{bookmarkList:t,chapters:i}),n(d.UPDATE_BOOK_BOOKMARK_LIST_FETCHING,{isFetching:!1}),e}).catch(function(e){return n(d.UPDATE_BOOK_BOOKMARK_LIST_FETCHING,{isFetching:!1}),e})}}),(0,n.default)(t,s.ADD_BOOKMARK,function(e,o){var a=e.commit;return(0,p.default)("/web/book/addBookmark",o).then(function(e){var t=e.data,i=w.get(t,"bookmarkId"),n=i&&0<i.length;if(n){var r=(0,l.default)({},o,{bookmarkId:i});a(d.INSERT_BOOKMARK_INTO_LIST,r)}return{succ:n?1:0}}).catch(function(e){return console.error("fetchAddBookmark fail: ",o,e),{succ:0}})}),(0,n.default)(t,s.REMOVE_BOOKMARK,function(e,i){var n=e.commit;return(0,p.default)("/web/book/removeBookmark",i).then(function(e){var t=1===e.data.succ;return t&&n(d.REMOVE_BOOKMARK_FROM_LIST,i.bookmarkId),{succ:t?1:0}}).catch(function(e){return console.error("removeBookmark fail: ",i,e),{succ:0}})}),(0,n.default)(t,s.UPDATE_BOOKMARK,function(e,i){var n=e.commit;return(0,p.default)("/web/book/updateBookmark",i).then(function(e){var t=1===e.data.succ;return t&&n(d.UPDATE_BOOKMARK_IN_LIST,i),{succ:t?1:0}}).catch(function(e){return console.error("updateBookmark fail: ",i,e),{succ:0}})}),t)}};var d=a(i(61)),s=a(i(35)),v=a(i(569)),h=a(i(570)),r=i(571),o=u(i(193)),p=u(i(63));function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function u(e){return e&&e.__esModule?e:{default:e}}var _=i(9),w=i(22);function m(e){var t="";switch(e){case v.ReviewListTypeBookTop:t="topReviews";break;case v.ReviewListTypeBookFriendTop:t="topFriendReviews";break;case v.ReviewListTypeNote:t="noteReviews"}return t}},677:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(i(194));function r(e){return e&&e.__esModule?e:{default:e}}var o=((0,r(i(195)).default)(a,[{key:"splitBy",value:function(e){if(a.isIntersection(this,e)){var t=[];return this.start<e.start&&t.push(new a(this.start,e.start)),this.end>e.end&&t.push(new a(e.end,this.end)),t}return[this]}},{key:"toString",value:function(){return this.start+"-"+this.end}}],[{key:"isIntersection",value:function(e,t){return e.start<=t.end&&t.start<=e.end}},{key:"isContain",value:function(e,t){return e.start<=t.start&&e.end>=t.end}},{key:"union",value:function(){for(var t=Number.MAX_VALUE,i=Number.MIN_VALUE,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.forEach(function(e){e.start<t&&(t=e.start),e.end>i&&(i=e.end)}),new a(t,i)}}]),a);function a(e,t){(0,n.default)(this,a),this.start="number"!=typeof e||isNaN(e)?-1:e,this.end="number"!=typeof t||isNaN(t)?-1:t}t.default=o},683:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(26)),r=a(i(750)),o=a(i(754));function a(e){return e&&e.__esModule?e:{default:e}}var s=i(9),u=new(n.default.extend(r.default));function c(e,t,i){s.isEnvClient&&(u.$el&&u.$el.parentNode||(u.$mount(document.createElement("div")),document.body.appendChild(u.$el)),u.showDialog(e,t,i))}t.default=function(){n.default.prototype.$writeReviewDialog=u,n.default.prototype.$showWriteReviewDialog=c,function(){var t=new(n.default.extend(o.default))({});n.default.prototype.$readerWriteReviewPanel=t,n.default.prototype.$showReaderWriteReviewPanel=function(e){t.$el||t.$mount(document.createElement("div")),t.$el.parentNode&&t.$el.parentNode!==e.parentNode&&t.$el.parentNode.removeChild(t.$el),t.$el.parentNode||e.parentNode.appendChild(t.$el),t.show(e)},n.default.prototype.$hideReaderWriteReviewPanel=function(){t.hide()},n.default.prototype.$isReaderWriteReviewPanelShowing=function(){return t.isShowing()}}()}},684:function(e,t,i){"use strict";i.r(t);var n=i(856),r=i(621);for(var o in r)"default"!==o&&function(e){i.d(t,e,function(){return r[e]})}(o);i(751);var a=i(3),s=Object(a.a)(r.default,n.a,n.b,!1,null,null,null);t.default=s.exports},750:function(e,t,i){"use strict";i.r(t);var n=i(849),r=i(619);for(var o in r)"default"!==o&&function(e){i.d(t,e,function(){return r[e]})}(o);i(753);var a=i(3),s=Object(a.a)(r.default,n.a,n.b,!1,null,null,null);t.default=s.exports},751:function(e,t,i){"use strict";var n=i(623);i.n(n).a},752:function(e,t,i){"use strict";var n=i(627);i.n(n).a},753:function(e,t,i){"use strict";var n=i(628);i.n(n).a},754:function(e,t,i){"use strict";i.r(t);var n=i(844),r=i(629);for(var o in r)"default"!==o&&function(e){i.d(t,e,function(){return r[e]})}(o);i(755);var a=i(3),s=Object(a.a)(r.default,n.a,n.b,!1,null,null,null);t.default=s.exports},755:function(e,t,i){"use strict";var n=i(631);i.n(n).a},833:function(e,t,i){"use strict";function n(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"review_starControl_container",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleClickControlEvent(e)}}},[t.title&&0<t.title.length?i("p",{staticClass:"review_starControl_title",style:t.titleStyle},[t._v(t._s(t.title))]):t._e(),i("div",{staticClass:"review_starControl_content",style:t.starContentStyle},[i("div",{staticClass:"review_starControl_normal"},t._l(t.normalStarCount,function(e){return i("span",{key:e,staticClass:"normal_starItem",attrs:{"data-index":e}})}),0),i("div",{staticClass:"review_starControl_selected"},[t._l(t.selectedStarCount,function(e){return i("span",{key:e,staticClass:"selected_starItem",attrs:{"data-index":e}})}),t._l(t.normalStarCount-t.selectedStarCount,function(e){return i("span",{key:e+t.selectedStarCount,staticClass:"selected_starItem_Placeholder",attrs:{"data-index":e+t.selectedStarCount}})})],2)])])}var r=[];i.d(t,"a",function(){return n}),i.d(t,"b",function(){return r})},844:function(e,t,i){"use strict";function n(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"fade"},on:{enter:e.onShow}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.showing,expression:"showing"}],staticClass:"readerWriteReviewPanel",on:{click:e.handleClickDialog}},[i("div",{staticClass:"readerWriteReviewPanel_bg"},[i("a",{staticClass:"closeButton",attrs:{href:"javascript:"},on:{click:e.hide}},[e._v("关闭")]),i("write-review-panel",{ref:"panel",class:{disabled:!e.canSubmit},attrs:{"cur-user":e.curUser,placeholder:"写下这一刻的想法","is-show-review-icon":!0,"init-private-state":e.initPrivateState,"is-writing-book-review":!1},on:{"handle-textarea-change":e.handleTextAreaChange,"handle-submit-event":e.handleSubmitEvent,"private-state-change":e.handlePrivateStateChange}})],1)])])}var r=[];i.d(t,"a",function(){return n}),i.d(t,"b",function(){return r})},849:function(e,t,i){"use strict";function n(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Dialog",{ref:"dialog",attrs:{"custom-selector":"writeReview_dialog_container"},on:{onShow:e.handleDidShowDialog,onHide:e.handleDidHideDialog}},[i("div",{staticClass:"writeReview_dialog_header",on:{click:e.handleClickDialog}},[i("ReviewStarControl",{ref:"starControl",staticClass:"writeReview_dialog_starControl",attrs:{title:"评分","init-score":0,"can-select":!0},on:{"emit-review-star-click":e.handleBookReviewClick}}),i("div",{staticClass:"writeReview_dialog_clear"})],1),i("div",{class:["writeReview_dialog_content",{disabled:!e.canSubmit}],on:{click:e.handleClickDialog}},[i("WriteReviewPanel",{ref:"panel",staticClass:"writeReview_dialog_panel",attrs:{"cur-user":e.curUser,"init-private-state":0,"is-writing-book-review":!0},on:{"handle-textarea-change":e.handleTextAreaChange,"handle-focus-event":e.handleTextAreaFocusEvent,"handle-submit-event":e.handleSubmitEvent}})],1)])}var r=[];i.d(t,"a",function(){return n}),i.d(t,"b",function(){return r})},856:function(e,t,i){"use strict";function n(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"writeReview_container"},[i("div",{class:["writeReview_editor",{paddingLarge:t.isShowReviewIcon}]},[t.isShowReviewIcon?i("span",{staticClass:"writeReview_icon"}):t._e(),t.editable?i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],ref:"textarea",staticClass:"writeReview_textarea",attrs:{name:"WriteBookReview",id:"WriteBookReview",placeholder:t.placeholder},domProps:{value:t.content},on:{focus:t.emitFocusEvent,input:function(e){e.target.composing||(t.content=e.target.value)}}}):i("textarea",{staticClass:"writeReview_textarea",attrs:{name:"WriteBookReview",id:"WriteBookReviewReadOnly",readonly:""}})]),i("div",{staticClass:"writeReview_footer"},[i("div",{staticClass:"writeReview_footer_Border"},[i("Menu",{ref:"writeReview_footer_Menu",attrs:{defaultSelectedIndex:0,"list-margin-top":"-160px","list-max-height":"180px",optionList:t.privateOptions,align:"left"},on:{"handle-click-menu-option":t.handleClickMenuOption},scopedSlots:t._u([{key:"optionsItem",fn:function(e){return[i("span",{class:["writeReview_footer_Menu_Icon",0===e.index?"publish":1===e.index?"follow":"secret"]}),i("span",{staticClass:"writeReview_footer_Menu_Title"},[t._v(t._s(e.option))]),i("span",{staticClass:"writeReview_footer_Menu_Subtitle"},[t._v(t._s(0===e.index?"所有人可见":1===e.index?"仅互相关注可见":"仅自己可见"))])]}}])},[i("a",{class:["writeReview_private_button",t.privateIconClass],attrs:{href:"javascript:"},on:{click:function(e){return e.stopPropagation(),t.handlePrivateButtonClick(e)}}},[i("span",{staticClass:"button_leftIcon"}),i("span",{staticClass:"button_text"},[t._v(t._s(t.privateText))]),i("span",{staticClass:"button_rightIcon"})])]),i("a",{staticClass:"writeReview_submit_button wr_btn wr_btn_Big",attrs:{href:"javascript:"},on:{click:t.emitSubmitEvent}},[t._v("发 表")]),i("div",{staticClass:"writeReview_footer_Clear"})],1)])])}var r=[];i.d(t,"a",function(){return n}),i.d(t,"b",function(){return r})}}]);